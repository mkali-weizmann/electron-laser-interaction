#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\begin_preamble
% Necessary Commands:
\usepackage{autobreak}
\usepackage{relsize}
\usepackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{positioning}
\usepackage{listings}

% Set vertical space before and after dislpay equations to be longer for better redability:
\AtBeginDocument{\setlength\abovedisplayskip{12pt}}
\AtBeginDocument{\setlength\belowdisplayskip{12pt}}
\AtBeginDocument{\setlength\belowdisplayshortskip{12pt}}
\AtBeginDocument{\setlength\belowdisplayshortskip{12pt}}

% Set space between words to be wider:
\spaceskip=1.3\fontdimen2\font plus 1\fontdimen3\font minus 1.5\fontdimen4\font

% Convert the Lyx colors into more pleasant colors:
\usepackage{xcolor}
\definecolor{blue}{RGB}{12,97,197}
\definecolor{green}{RGB}{0,128,40}
\definecolor{red}{RGB}{235,16,16}
\definecolor{brown}{RGB}{154,58,0}
\definecolor{orange}{RGB}{231,135,26}
\definecolor{purple}{RGB}{94,53,177}

% Convert the QED Symbol at the end of proofs to a solid black square (credit: Yakir Oz):
\usepackage{amssymb}
\renewcommand{\qedsymbol}{$\blacksquare$}

% Make the layout more similar to Hebrew Article, which I am more used to:
\renewcommand*{\@seccntformat}[1]{\hspace{0.5cm}\csname the#1\endcsname\hspace{0.5cm}} 
\usepackage{titlesec}
\titleformat{\section}{\fontsize{20}{20}\bfseries}{\thesection}{10pt}{}
\titleformat{\subsection}{\fontsize{15}{15}\bfseries}{\thesubsection}{10pt}{}
\titleformat{\subsubsection}{\bfseries}{\thesubsubsection}{10pt}{}

% Create disjoint union symbols:
\makeatletter
\def\moverlay{\mathpalette\mov@rlay}
\def\mov@rlay#1#2{\leavevmode\vtop{%
   \baselineskip\z@skip \lineskiplimit-\maxdimen
   \ialign{\hfil$\m@th#1##$\hfil\cr#2\crcr}}}
\newcommand{\charfusion}[3][\mathord]{
    #1{\ifx#1\mathop\vphantom{#2}\fi
        \mathpalette\mov@rlay{#2\cr#3}
      }
    \ifx#1\mathop\expandafter\displaylimits\fi}
\makeatother
\newcommand{\cupdot}{\charfusion[\mathbin]{\cup}{\cdot}}
\newcommand{\bigcupdot}{\charfusion[\mathop]{\bigcup}{\cdot}}

\newcommand{\kaliLargeLand}{\mathop{\mathlarger{\mathlarger{\mathlarger{\land}}}}}



\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}
\end_preamble
\use_default_options true
\begin_modules
theorems-ams
\end_modules
\maintain_unincluded_children false
\begin_local_layout
Style Section
	Font
	  Series     Medium
	  Shape      Smallcaps
	  Size       Larger
	  Series     Bold
	EndFont
	TocLevel 1
End


Style Section*
	Font
	  Series     Medium
	  Shape      Smallcaps
	  Size      Larger
	  Series     Bold
	EndFont
End


Style Solution

	LabelString           "פיתרון: "
End


Style Notation

	LabelString           "סימון  \thetheorem: "
End

Style Theorem

	LabelString           "משפט \thetheorem: "
End

Style Property

	LabelString           "תזכורת: "
End
\end_local_layout
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "David"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts true
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing onehalf
\use_hyperref true
\pdf_bookmarks true
\pdf_bookmarksnumbered false
\pdf_bookmarksopen false
\pdf_bookmarksopenlevel 1
\pdf_breaklinks false
\pdf_pdfborder false
\pdf_colorlinks false
\pdf_backref false
\pdf_pdfusetitle true
\papersize default
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 1cm
\topmargin 2cm
\rightmargin 1cm
\bottommargin 3cm
\headheight 0cm
\headsep 0cm
\footskip 2cm
\secnumdepth -2
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation 0bp
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard
\begin_inset CommandInset include
LatexCommand include
filename "C:/Users/michaeka/OneDrive - weizmann.ac.il/Templates/MacrosEnglish.lyx"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Doublebox
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
\begin_inset space \space{}
\end_inset


\end_layout

\begin_layout Plain Layout
\align center

\size giant
Readme File
\end_layout

\begin_layout Plain Layout
\align center

\size larger
Michael Kali - michael.kali@weizmann.ac.il
\end_layout

\begin_layout Plain Layout
\align center
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
today
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset space \space{}
\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset VSpace bigskip
\end_inset


\end_layout

\begin_layout Standard
This file contains the derivations used in the 
\family typewriter
microscope.py
\family default
 file for simulating a microscope with 2 frequencies cavity.
 the code is available here:
\bar under
\color blue

\begin_inset CommandInset href
LatexCommand href
name "Github link"
target "https://github.com/mkali-weizmann/phase-plate"
literal "false"

\end_inset


\bar default
\color inherit
 and is based mostly on the paper from here: 
\bar under
\color blue

\begin_inset CommandInset href
LatexCommand href
name "relativistic ponderomotive potential paper"
target "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7357394/"
literal "false"

\end_inset


\bar default
\color inherit
.
\end_layout

\begin_layout Part
The code structure
\end_layout

\begin_layout Standard
The simulation is meant to take an electron wave function, and propagate
 it through the different components of the microscope.
\end_layout

\begin_layout Standard
The wave function is always represented with the 
\family typewriter
WaveFunction
\family default
 class, that contains the coordinates system on which it is evaluated, the
 values of it over all of the coordinates system's points, and it's energy:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "language=Python,style=mystyle"
inline false
status open

\begin_layout Plain Layout

class WaveFunction:
\end_layout

\begin_layout Plain Layout

    def __init__(self,
\end_layout

\begin_layout Plain Layout

                 psi: np.ndarray,  # The input wave function in one z=const
 plane
\end_layout

\begin_layout Plain Layout

                 coordinates: CoordinateSystem,  # The coordinate system
 of the input wave
\end_layout

\begin_layout Plain Layout

                 E0: float,  # Energy of the particle
\end_layout

\begin_layout Plain Layout

                 ):
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The base unit of the simulation is the 
\family typewriter
Propagator
\family default
 class, which takes a 
\family typewriter
WaveFunction
\family default
 as an input and returns a 
\family typewriter
WaveFunction
\family default
 as an output.
 Examples for such Propagators are the lens, the cavity, the sample, etc...
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "language=Python,basicstyle={\ttfamily},style=mystyle"
inline false
status open

\begin_layout Plain Layout

class Propagator:
\end_layout

\begin_layout Plain Layout

	def propagate(self, state: WaveFunction) -> WaveFunction
\end_layout

\end_inset


\end_layout

\begin_layout Standard
the main class is 
\family typewriter
Microscope
\family default
, which is defined by a list of 
\family typewriter
Propagators
\family default
, and knows how to take a 
\family typewriter
WaveFunction
\family default
 as an input, pass it through all the 
\family typewriter
Propagator
\family default
s one by one, save the results on the way, and after it finishes, it converts
 the last one to an image (by squaring and adding shot noise).
\end_layout

\begin_layout Standard
Here is a list of the current existing propagators (that, as said earlier
 - take a 
\family typewriter
WaveFunction
\family default
 as an input and returns a 
\family typewriter
WaveFunction
\family default
 as an output) followed by a detailed explanation of each one of them :
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "language=Python,style=mystyle"
inline false
status open

\begin_layout Plain Layout

class LensPropagator(Propagator):
\end_layout

\begin_layout Plain Layout

	...
\end_layout

\begin_layout Plain Layout

class SamplePropagator(Propagator):
\end_layout

\begin_layout Plain Layout

	...
\end_layout

\begin_layout Plain Layout

class AberrationsPropagator(Propagator):
\end_layout

\begin_layout Plain Layout

	...
\end_layout

\begin_layout Plain Layout

class CavityPropagator(Propagator):
\end_layout

\begin_layout Plain Layout

	...
\end_layout

\begin_layout Plain Layout

class CavityAnalyticalPropagator(CavityPropagator):
\end_layout

\begin_layout Plain Layout

	...
\end_layout

\begin_layout Plain Layout

class CavityNumericalPropagator(CavityPropagator):
\end_layout

\end_inset


\end_layout

\begin_layout Subsection

\family typewriter
SamplePropagator
\end_layout

\begin_layout Standard
This class propagates a 
\family typewriter
WaveFunction 
\family default
through a sample with a known potential 
\begin_inset Formula $V\left(x,y,z\right)$
\end_inset

.
\end_layout

\begin_layout Standard
It does so using the slice-by-slice method, as described in 
\bar under
\color blue

\begin_inset CommandInset href
LatexCommand href
name "Kirland's book"
target "https://link.springer.com/book/10.1007/978-1-4419-6533-2"
literal "false"

\end_inset


\bar default
\color inherit
 in section 
\begin_inset Formula $6.4$
\end_inset

.
\end_layout

\begin_layout Standard
Simply speaking, if we can evaluate the potential in planes 
\begin_inset Formula $z_{n}=n\cdot\Delta z$
\end_inset

, and we denote the wavefuntion in some plane 
\begin_inset Formula $z_{n}$
\end_inset

 as 
\begin_inset Formula $\psi\left(x,y,z=z_{n}\right)\equiv\psi_{n}\left(x,y\right)$
\end_inset

 , we can propagate in steps each 
\begin_inset Formula $\psi_{n}$
\end_inset

 to 
\begin_inset Formula $\psi_{n+1}$
\end_inset

 by:
\end_layout

\begin_layout Enumerate
Propagate 
\begin_inset Formula $\psi_{n}$
\end_inset

 in free space for a distance of 
\begin_inset Formula $\Delta z$
\end_inset

 using angular spectrum of plane waves propagation (done in Fourier space):
 
\begin_inset Formula $\Psi_{n}\left(k_{x},k_{y}\right)\rightarrow\Psi_{n}\left(k_{x},k_{y}\right)\cdot e^{i\sqrt{k^{2}-k_{x}^{2}-k_{y}^{2}}\cdot\Delta z}$
\end_inset

 (function 
\family typewriter
ASPW_propagation
\family default
)
\end_layout

\begin_layout Enumerate
Apply phase retardation to according to the potential 
\begin_inset Formula $V\left(x,y,z_{n}\right)$
\end_inset

 using the multiplication: 
\begin_inset Formula $\psi\left(x,y\right)\rightarrow\psi\left(x,y\right)\cdot e^{i\sigma\Delta z\cdot V\left(x,y\right)}$
\end_inset

 for 
\begin_inset Formula $\sigma=\frac{\gamma me}{\hbar^{2}k}$
\end_inset

 (Function 
\family typewriter
propagate_through_potential_slice
\family default
)
\end_layout

\begin_layout Enumerate
Iterate alternately for 
\begin_inset Formula $\left\{ z_{n}\right\} _{n=0}^{N}$
\end_inset

 until the wave comes out of the potential limits (out of the sample).
 (method 
\family typewriter
propagate
\family default
)
\end_layout

\begin_layout Standard
This class also have a useful method of loading dummy samples, such as letters
 or gaussians.
 (method 
\family typewriter
generate_dummy_potential
\family default
)
\end_layout

\begin_layout Subsection

\family typewriter
CavityPropagator
\end_layout

\begin_layout Standard
Cavity propagators are propagators that take the 
\family typewriter
WaveFunction
\family default
 in the focal plane, and change it according to the electron-laser interaction
 with the laser in the cavity.
\end_layout

\begin_layout Standard
More formally, the cavity propagators propagate a 
\family typewriter
WaveFunction
\family default
 through a cavity with two lasers, with wavelengths 
\begin_inset Formula $\lambda_{1},\lambda_{2}$
\end_inset


\family typewriter
 (
\family default
denoted in the code as 
\family typewriter
l_1, l_2)
\family default
 , with amplitudes 
\begin_inset Formula $E_{1},E_{2}$
\end_inset

 
\family typewriter
(
\family default
denoted in the code as 
\family typewriter
E_1, E_2
\family default
), numerical apertures 
\begin_inset Formula $\kaliNA_{1},\kaliNA_{2}$
\end_inset


\family typewriter
(NA_1, NA_2
\family default
), with polarization 
\begin_inset Formula $\theta$
\end_inset

 
\family typewriter
(theta_polarization)
\family default
 (which is shared for both lasers) and with tilt of the cavity of 
\family typewriter

\begin_inset Formula $\alpha$
\end_inset


\family default
 
\family typewriter
(alpha_cavity)
\family default
.
\end_layout

\begin_layout Standard
This is how 
\begin_inset Formula $\alpha$
\end_inset

 looks like in a sketch, where the 
\begin_inset Formula $z$
\end_inset

 axis is the axis of propagation on electrons:
\end_layout

\begin_layout Standard
\align center
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
tikzset{every picture/.style={line width=0.75pt}} %set default line width
 to 0.75pt        
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
\end_layout

\begin_layout Plain Layout

%uncomment if require: 
\backslash
path (0,300); %set diagram left start at 0, and has height of 300
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da3961152165062276] 
\end_layout

\begin_layout Plain Layout


\backslash
draw    (243,145) -- (386,145) ;
\end_layout

\begin_layout Plain Layout


\backslash
draw [shift={(388,145)}, rotate = 180] [color={rgb, 255:red, 0; green, 0;
 blue, 0 }  ][line width=0.75]    (10.93,-3.29) ..
 controls (6.95,-1.4) and (3.31,-0.3) ..
 (0,0) ..
 controls (3.31,0.3) and (6.95,1.4) ..
 (10.93,3.29)   ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da7170244571598983] 
\end_layout

\begin_layout Plain Layout


\backslash
draw    (243,145) -- (243,271.5) ;
\end_layout

\begin_layout Plain Layout


\backslash
draw [shift={(243,273.5)}, rotate = 270] [color={rgb, 255:red, 0; green,
 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) ..
 controls (6.95,-1.4) and (3.31,-0.3) ..
 (0,0) ..
 controls (3.31,0.3) and (6.95,1.4) ..
 (10.93,3.29)   ;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp12621156879788442] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (179.94,126.87) ..
 controls (176.86,118.18) and (177.81,108.18) ..
 (183.39,99.97) ..
 controls (187.85,93.4) and (194.45,89.16) ..
 (201.63,87.55) -- (208.21,116.81) -- cycle ; 
\backslash
draw  [color={rgb, 255:red, 47; green, 90; blue, 141 }  ,draw opacity=1
 ] (179.94,126.87) ..
 controls (176.86,118.18) and (177.81,108.18) ..
 (183.39,99.97) ..
 controls (187.85,93.4) and (194.45,89.16) ..
 (201.63,87.55) ;  
\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp7460606265751784] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (291.13,198.54) ..
 controls (298,196.8) and (304.29,192.63) ..
 (308.59,186.31) ..
 controls (313.05,179.74) and (314.55,172.04) ..
 (313.4,164.77) -- (283.77,169.46) -- cycle ; 
\backslash
draw  [color={rgb, 255:red, 47; green, 90; blue, 141 }  ,draw opacity=1
 ] (291.13,198.54) ..
 controls (298,196.8) and (304.29,192.63) ..
 (308.59,186.31) ..
 controls (313.05,179.74) and (314.55,172.04) ..
 (313.4,164.77) ;  
\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp5201771387813334] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (313.4,164.77) ..
 controls (291.75,160.76) and (270.54,152.34) ..
 (251.09,139.28) ..
 controls (230.36,125.36) and (213.77,107.58) ..
 (201.63,87.55) -- (343.83,1.22) -- cycle ; 
\backslash
draw  [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]
 (313.4,164.77) ..
 controls (291.75,160.76) and (270.54,152.34) ..
 (251.09,139.28) ..
 controls (230.36,125.36) and (213.77,107.58) ..
 (201.63,87.55) ;  
\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp4886999459939516] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (290.22,198.01) ..
 controls (278.84,181.09) and (264.13,165.99) ..
 (246.28,153.75) ..
 controls (225.69,139.62) and (203.05,130.76) ..
 (179.94,126.87) -- (152.2,290.9) -- cycle ; 
\backslash
draw  [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]
 (290.22,198.01) ..
 controls (278.84,181.09) and (264.13,165.99) ..
 (246.28,153.75) ..
 controls (225.69,139.62) and (203.05,130.76) ..
 (179.94,126.87) ;  
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da5131708779224167] 
\end_layout

\begin_layout Plain Layout


\backslash
draw    (244.51,144.93) -- (364.59,222.58) ;
\end_layout

\begin_layout Plain Layout


\backslash
draw [shift={(366.27,223.67)}, rotate = 212.89] [color={rgb, 255:red, 0; green,
 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) ..
 controls (6.95,-1.4) and (3.31,-0.3) ..
 (0,0) ..
 controls (3.31,0.3) and (6.95,1.4) ..
 (10.93,3.29)   ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da773157275916101] 
\end_layout

\begin_layout Plain Layout


\backslash
draw    (244.51,144.93) -- (175.82,251.15) ;
\end_layout

\begin_layout Plain Layout


\backslash
draw [shift={(174.73,252.83)}, rotate = 302.89] [color={rgb, 255:red, 0; green,
 0; blue, 0 }  ][line width=0.75]    (10.93,-3.29) ..
 controls (6.95,-1.4) and (3.31,-0.3) ..
 (0,0) ..
 controls (3.31,0.3) and (6.95,1.4) ..
 (10.93,3.29)   ;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp11370098385492522] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (347.82,145.38) ..
 controls (347.94,147.23) and (348,149.11) ..
 (348,151) ..
 controls (348,169.95) and (341.87,187.46) ..
 (331.49,201.67) -- (262,151) -- cycle ; 
\backslash
draw   (347.82,145.38) ..
 controls (347.94,147.23) and (348,149.11) ..
 (348,151) ..
 controls (348,169.95) and (341.87,187.46) ..
 (331.49,201.67) ;  
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (317,153.4) node [anchor=north west][inner sep=0.75pt]  [font=
\backslash
Large]  {$
\backslash
begin{smallmatrix}
\end_layout

\begin_layout Plain Layout


\backslash
alpha  & 
\backslash

\backslash

\end_layout

\begin_layout Plain Layout

 & 
\end_layout

\begin_layout Plain Layout


\backslash
end{smallmatrix}$};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (239,279.4) node [anchor=north west][inner sep=0.75pt]    {$z$};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (394,135.4) node [anchor=north west][inner sep=0.75pt]    {$x$};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (369,216.4) node [anchor=north west][inner sep=0.75pt]    {$x_{cavity}$};
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
end{tikzpicture}
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
The electron-laser interaction is derived in section 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "sec:Review-of-Osip's"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
 and for the case of a general electromagnetic field ends with equation
  
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_3"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 which expresses the total phase given to the electron:
\begin_inset Formula 
\[
\phi\left(x,y,t\right)=-\frac{1}{\hbar}\intop_{-\infty}^{\infty}\frac{e^{2}}{2m\gamma\beta c}\left({\color{green}\left(\boldsymbol{A}\left(\boldsymbol{x},T\left(z,t\right)\right)-\nabla G\left(\boldsymbol{x},T\left(z,t\right)\right)\right)^{2}}-{\color{blue}\beta^{2}\left(A_{z}\left(\boldsymbol{x},T\left(z,t\right)\right)-\partial_{z}G\left(\boldsymbol{x},T\left(z,t\right)\right)\right)^{2}}\right)dz\tag{{\color{blue}\ref{eq:e_3}}}
\]

\end_inset

Where 
\begin_inset Formula $x,y$
\end_inset

 are the center of the thin electron beam in the focal plane, 
\begin_inset Formula $t$
\end_inset

 is the time at which it crosses the focal plane, and the function 
\begin_inset Formula $G$
\end_inset

 is defined also in the same section in equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:G_def"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
:
\begin_inset Formula 
\[
G\left(\boldsymbol{x},t\right)=c\beta\intop_{-\infty}^{t}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)dt^{\prime}\tag{{\color{blue}\ref{eq:G_def}}}
\]

\end_inset


\end_layout

\begin_layout Standard
When there are two frequencies in the cavity, the intensity 
\begin_inset Formula $A^{2}$
\end_inset

 will oscillate, which will result in an oscillating phase shift (oscillating
 in time 
\begin_inset Formula $t$
\end_inset

) of the form:
\begin_inset Formula 
\[
\phi\left(x,y,t\right)=\phi_{\text{const}}\left(x,y\right)+C\cos\left(\Delta\omega t\right)\tag{{\color{blue}\ref{eq:oscillating_phase_shift}}}
\]

\end_inset

With some 
\begin_inset Formula $\phi_{\text{const}}$
\end_inset

 and oscillation frequency 
\begin_inset Formula $C$
\end_inset

.
\end_layout

\begin_layout Standard
The effect of the oscillating phase shift is described in section 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "sec:Interaction with an oscillating laser"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
 and ends with the expression:
\begin_inset Formula 
\[
\boxed{\psi_{\text{output}}\left(x,y\right)=\psi_{\text{input}}\left(x,y\right)\cdot{\color{brown}e^{i\phi_{\text{const}}\left(x,y\right)}}\cdot{\color{teal}J_{0}\left(C\right)}}\tag{{\color{blue}\ref{eq:after_energy_filter_general}}}
\]

\end_inset


\end_layout

\begin_layout Standard
There are two versions of this cavity propagator, and both inherit 
\family typewriter
CavityPropagator
\family default
: The first is 
\family typewriter
CavityAnalyticalPropagator 
\family default
which calculates the mask 
\begin_inset Formula $e^{i\phi_{\text{const}}\left(x,y\right)}\cdot J_{0}\left(C\right)$
\end_inset

 of the last equation using a closed formula (with no integrals), and uses
 some simplifying approximations which will be described in the next subsection.
 The second is 
\family typewriter
CavityNumericalPropagator
\family default
 that calculates the mask 
\begin_inset Formula $e^{i\phi_{\text{const}}\left(x,y\right)}\cdot J_{0}\left(C\right)$
\end_inset

 of the last equation directly with no simplifying assumptions (by doing
 a numeric integration of equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_3"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 that was quoted a few paragraphs before).
\end_layout

\begin_layout Standard
Both classes have the same propagate function: first calculate they the
 mask 
\begin_inset Formula ${\color{brown}e^{i\phi_{\text{const}}\left(x,y\right)}}\cdot{\color{teal}J_{0}\left(C\right)}$
\end_inset

 and then multiply the input 
\family typewriter
WaveFunction
\family default
 by the mask to get the output 
\family typewriter
WaveFunction
\end_layout

\begin_layout Standard
A few notes that are relevant for both cavity propagators (more elaborated
 explanation on each cavity class comes right afterwards):
\end_layout

\begin_layout Enumerate
The phase of the mask 
\begin_inset Formula ${\color{brown}e^{i\phi_{\text{const}}\left(x,y\right)}}$
\end_inset

 from the last equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:after_energy_filter_general"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
, is the phase the electron acquires by passing through the ponderomotive
 potential.
 The derivation for this phase is given in section 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "subsec:The cavity effect on a pencil beam"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
, and in particular is given by equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_3"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 that was quoted a few paragraphs ago.
\end_layout

\begin_layout Enumerate
The absolute value of this complex number is the attenuation factor 
\begin_inset Formula ${\color{teal}J_{0}\left(C\right)}$
\end_inset

 that is given to this beam by being modulated in frequency by the cavity,
 and later passing through an energy filter that will keep only the zero'th
 energy.
 
\end_layout

\begin_layout Enumerate
When initializing the object with 
\family typewriter
E_1=-1
\family default
 the object searches itself for the amplitude that will result in phase
 shift of 
\begin_inset Formula $\frac{\pi}{2}$
\end_inset

.
\end_layout

\begin_layout Enumerate
The ratio used in the simulation between 
\begin_inset Formula $E_{1}$
\end_inset

 and 
\begin_inset Formula $E_{2}$
\end_inset

 is derived in section 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "sec:Field Derivations"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
 and in equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:E_ratio"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
.
\end_layout

\begin_deeper
\begin_layout Enumerate
The default value of 
\family typewriter
E_2
\family default
 in the class is 
\begin_inset Formula $-1$
\end_inset

, and if this will indeed be the input, then the object will initiate 
\family typewriter
E_2
\family default
 with the appropriate value according to equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:E_ratio"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
:
\begin_inset Formula 
\[
E_{2}=E_{1}\cdot\frac{\lambda_{1}}{\lambda_{2}}\tag{{\color{blue}\ref{eq:E_ratio}}}
\]

\end_inset


\end_layout

\begin_layout Enumerate
If 
\family typewriter
E_2
\family default
 is 
\family typewriter
None
\family default
 then the cavity will have only one laser.
\end_layout

\begin_layout Enumerate
Those calculations happen in 
\family typewriter
__init__
\family default
 method.
\end_layout

\end_deeper
\begin_layout Enumerate
The ratio used in the simulation between 
\begin_inset Formula $\kaliNA_{1}$
\end_inset

 and 
\begin_inset Formula $\kaliNA_{2}$
\end_inset

 is derived in section 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "sec:NA_ratio"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
 and in equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_34"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_deeper
\begin_layout Enumerate
Also here, when initiating the object and setting the value of 
\begin_inset Formula $\kaliNA_{1}$
\end_inset

, the values 
\begin_inset Formula $-1$
\end_inset

 and 
\family typewriter
None
\family default
 behave the same wave as in 
\family typewriter
E_2
\end_layout

\begin_layout Enumerate
those calculations happen in 
\family typewriter
__init__
\family default
 method.
\end_layout

\end_deeper
\begin_layout Enumerate
The tilt of the cavity 
\begin_inset Formula $\alpha_{\text{cavity}}$
\end_inset

 used in the simulation is derived in section 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "sec:alpha_cavity_derivation"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
 and appear in equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:alpha_cavity_definitio"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
.
\end_layout

\begin_deeper
\begin_layout Enumerate
it depends on the velocity of the electron, which is not part of the object,
 but rather part of the input 
\family typewriter
WaveFunction
\family default
, and so it cannot happen in the 
\family typewriter
__init__
\family default
 function.
 instead, it happens in the 
\family typewriter
beta_electron2alpha_cavity
\family default
 function.
\end_layout

\end_deeper
\begin_layout Enumerate
The propagator can work also with a single laser, by setting 
\family typewriter
E_2=None
\family default
.
\end_layout

\begin_layout Subsection

\family typewriter
CavityAnalyticalPropagator
\end_layout

\begin_layout Standard
As said before, this 
\family typewriter
Propagator
\family default
 calculates the total phase and attenuation given to each pixel using simplifyin
g approximations.
 all approximations are done in section 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "subsec:The cavity effect on a pencil beam"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
 and end in the final equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_35"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
:
\begin_inset Formula 
\begin{align*}
\psi_{x_{0},y_{0}}\begin{pmatrix}x\\
y\\
z\\
t
\end{pmatrix} & \xrightarrow{\text{Passing through the cavity}}\psi_{x_{0},y_{0}}\begin{pmatrix}x\\
y\\
z\\
t
\end{pmatrix}\cdot{\color{brown}e^{i\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\left(2+{\color{gray}\underset{\text{Not in ring cavity}}{\underbrace{{\normalcolor {\color{brown}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}+\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}}}}}\right)}}\cdot{\color{teal}J_{0}\left(\rho\left(\theta,\beta_{e}^{\prime}\right)\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\right)}\tag{{\color{blue}\ref{eq:e_35}}}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
For:
\end_layout

\begin_layout Enumerate
\begin_inset Formula $J_{0}$
\end_inset

 is the Bessel function of first kind, 
\begin_inset Formula $\theta$
\end_inset

 is the polarization of light, 
\begin_inset Formula $x_{0},y_{0}$
\end_inset

 is the location of the pixel in the focal plane (corresponding to the original
 transverse frequency), 
\begin_inset Formula $\alpha$
\end_inset

 is the tilt angle of the cavity
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\beta_{e}^{\prime}$
\end_inset

 is defined to be
\begin_inset Formula 
\[
\beta_{e}^{\prime}=\frac{\frac{1}{\gamma_{c}}\beta_{e}\cos\alpha}{1-\beta_{e}\sin\alpha\cdot\beta_{c}}\tag{{\color{blue}\ref{eq:beta_e_moving_frame}}}
\]

\end_inset

Where 
\begin_inset Formula $\beta_{e}$
\end_inset

 is the velocity of the electron in the lab's frame and 
\begin_inset Formula $\beta_{c}$
\end_inset

 is the velocity of the standing wave created by the two laser frequency,
 which is given by:
\begin_inset Formula 
\[
\beta_{\text{c}}=\frac{\lambda_{1}-\lambda_{2}}{\lambda_{1}+\lambda_{2}}\tag{{\color{blue}\ref{eq:beta_lattice}}}
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $\phi_{0}$
\end_inset

 defined in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi_0_first_time"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
:
\begin_inset Formula 
\[
\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)=\frac{e^{2}}{4\hbar mc\beta_{e}^{\prime}\gamma_{e}^{\prime}\omega^{2}}\sqrt{\frac{\pi}{2}}\frac{w_{0}^{2}E_{0}^{2}}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}e^{-\frac{2y_{0}^{2}}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}}\tag{{\color{blue}\ref{eq:phi_0_first_time}}}
\]

\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
Note that two running waves in opposite directions 
\begin_inset Formula $E_{0}e^{-i\omega t+kx},E_{0}e^{-i\omega t-kx}$
\end_inset

 will sum to a standing wave with a 
\begin_inset Formula ${\color{green}2}$
\end_inset

 factor before it, and a factor of 
\begin_inset Formula ${\color{green}4}$
\end_inset

 for the intensity:
\begin_inset Formula 
\begin{align*}
E & =E_{0}e^{-i\omega t+kx}+E_{0}e^{-i\omega t-kx}={\color{green}2}\cos\left(kx\right)e^{-i\omega t}\\
I & ={\color{green}4}\cos^{2}\left(kx\right)
\end{align*}

\end_inset

In the original paper This 
\begin_inset Formula ${\color{green}4}$
\end_inset

 factor appears as part of 
\begin_inset Formula $\phi_{0}$
\end_inset

 in the original paper 
\bar under
\color blue

\begin_inset CommandInset href
LatexCommand href
name "relativistic ponderomotive potential paper"
target "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7357394/"
literal "false"

\end_inset


\bar default
\color inherit
 but here because there are multiple waves that are not all standing, I
 took this 
\begin_inset Formula ${\color{green}4}$
\end_inset

 factor out of the definition of 
\begin_inset Formula $\phi_{0}$
\end_inset

.
\end_layout

\end_deeper
\begin_layout Enumerate
\begin_inset Formula $\Gamma_{\pm}$
\end_inset

 is defined in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:capital_gamma_def"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
:
\begin_inset Formula 
\[
\gamma\left(1\mp\beta_{c}\right)=\frac{\left(1\mp\beta_{c}\right)}{\sqrt{1-\beta_{c}^{2}}}=\frac{\left(1\mp\beta_{c}\right)}{\sqrt{\left(1-\beta_{c}\right)\left(1+\beta_{c}\right)}}=\sqrt{\frac{1\mp\beta_{c}}{1\pm\beta_{c}}}\equiv\Gamma_{\mp}\tag{{\color{blue}\ref{eq:capital_gamma_def}}}
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $\rho\left(\theta,\beta\right)$
\end_inset

 is defined in equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:rho_def"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
:
\begin_inset Formula 
\[
\rho\left(\theta,\beta\right)=1-2\beta^{2}\cos^{2}\left(\theta\right)\tag{{\color{blue}\ref{eq:rho_def}}}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
Here is a pseudo code of the propagation process, done in the method 
\family typewriter
propagate
\family default
:
\end_layout

\begin_layout Itemize
Create the total phase and amplitude mask which is the right hand side in
 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_35"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 in method 
\family typewriter
phase_and_amplitude_mask
\family default
:
\end_layout

\begin_deeper
\begin_layout Itemize
First, 
\begin_inset Formula $\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)$
\end_inset

 is calculated in the method 
\family typewriter
phi_0
\family default
.
\end_layout

\begin_layout Itemize
Then, the total 
\color brown
brown
\color inherit
 term in the exponent 
\begin_inset Formula ${\color{brown}\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\left(2+{\color{gray}\underset{\text{Not in ring cavity}}{\underbrace{{\normalcolor {\color{brown}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}+\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}}}}}\right)}$
\end_inset

 is calculated in the method 
\family typewriter
phase_shift
\family default
.
\end_layout

\begin_layout Itemize
Then, the teal attenuation factor 
\begin_inset Formula ${\color{teal}J_{0}\left(\rho\left(\theta,\beta_{e}\right)\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\right)}$
\end_inset

 is calculated in 
\family typewriter
attenuation_factor
\family default
.
\end_layout

\begin_layout Itemize
multiply the terms from 
\begin_inset Formula $\left(b\right)$
\end_inset

 and 
\begin_inset Formula $\left(c\right)$
\end_inset

 to get the total phase masks.
\end_layout

\end_deeper
\begin_layout Itemize
Multiply the input 
\family typewriter
WaveFunction 
\family default
and the 
\family typewriter
phase_and_amplitude_mask
\family default
 to get the output 
\family typewriter
WaveFunction
\family default
.
\end_layout

\begin_layout Subsection

\family typewriter
CavityNumericalPropagator
\end_layout

\begin_layout Standard
This class does the same manipulation on a 
\family typewriter
WaveFunction
\family default
 as 
\family typewriter
CavityAnalyticalPropagator
\family default
 but instead of using the final expression for the phase shift in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_35"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
, it does the integral in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_3"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 directly.
 The analytical expression in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_35"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 that is used by the analytical propagator is the result of this integral
 after some approximation.
\end_layout

\begin_layout Standard
Here is the original equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_3"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 for your comfort:
\begin_inset Formula 
\[
\phi\left(x,y,t\right)=-\frac{1}{\hbar}\intop_{-\infty}^{\infty}\frac{e^{2}}{2m\gamma\beta c}\left({\color{green}\left(\boldsymbol{A}\left(\boldsymbol{x},T\left(z,t\right)\right)-\nabla G\left(\boldsymbol{x},T\left(z,t\right)\right)\right)^{2}}-{\color{blue}\beta^{2}\left(A_{z}\left(\boldsymbol{x},T\left(z,t\right)\right)-\partial_{z}G\left(\boldsymbol{x},T\left(z,t\right)\right)\right)^{2}}\right)dz\tag{{\color{blue}\ref{eq:e_3}}}
\]

\end_inset


\end_layout

\begin_layout Standard
Note that this integral is very heavy computationally, and this problem
 is addressed in 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "subsec:Addressing the complexity problem"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
.
 besides the numerical optimizations, the class knows to take the integral
 in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_3"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 which needs to be done for every 
\begin_inset Formula $x,y,t$
\end_inset

 triplets, and to divide it into segments such that no segments exceeds
 some arbitrary memory limit.
\end_layout

\begin_layout Standard
Also, once it computed the phase shift and amplitude attenuation for every
 pixel, it saves the result in a unique name, and then if the same setup
 is used again (frequencies, NA, amplitudes, polarization, resolution, etc...)
 then it just loads the result from the previously saved array.
\end_layout

\begin_layout Standard
A few notes:
\end_layout

\begin_layout Standard
Here is a pseudo code of the way the 
\family typewriter
propagate
\family default
 method of this class calculates the 
\family typewriter
phase_and_amplitude_mask
\family default
 (which later multiplies each pixel):
\end_layout

\begin_layout Standard
\begin_inset space \space{}
\end_inset


\end_layout

\begin_layout Standard
First check if the phase and amplitude mask was calculated for this set
 up in the past.
 if yes, load the results.
 if not - calculate proceed to calculate it for the first time
\end_layout

\begin_layout Standard
Suppose not - calculate 
\begin_inset Formula $\phi\left(x,y,t\right)$
\end_inset

 with the method 
\family typewriter
phi
\family default
:
\end_layout

\begin_layout Itemize
if the number of points in time for evaluation of 
\begin_inset Formula $\phi$
\end_inset

 is 
\begin_inset Formula $3$
\end_inset

 (which is the default, and is stored as 
\family typewriter
self.n_t
\family default
), then set the 
\family typewriter
t
\family default
 values on which 
\begin_inset Formula $\phi$
\end_inset

 will be evaluated to be 
\begin_inset Formula $t_{0},t_{1},t_{2}=0,\frac{\pi}{2\Delta\omega},\frac{\pi}{\Delta\omega}$
\end_inset

, from section 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "subsec:Calculating-the-zero'th energy amplitude"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
.
\end_layout

\begin_layout Itemize
else, initiate a vector of evenly space 
\begin_inset Formula $t$
\end_inset

's with the number specified in 
\family typewriter
self.n_t
\family default
.
\end_layout

\begin_layout Itemize
evaluate 
\begin_inset Formula $\phi$
\end_inset

 on the 
\begin_inset Formula $x,y,t$
\end_inset

 grids in batches using the method 
\family typewriter
phi_single_batch
\family default
 (division to batches is done so that memory limit is not being exceeded)
\end_layout

\begin_layout Itemize
for every batch evaluated in 
\family typewriter
phi_single_batch:
\end_layout

\begin_deeper
\begin_layout Itemize
evaluate the integrand 
\begin_inset Formula ${\color{green}\left(\boldsymbol{A}\left(\boldsymbol{x},T\left(z,t\right)\right)-\nabla G\left(\boldsymbol{x},T\left(z,t\right)\right)\right)^{2}}-{\color{blue}\beta^{2}\left(A_{z}\left(\boldsymbol{x},T\left(z,t\right)\right)-\partial_{z}G\left(\boldsymbol{x},T\left(z,t\right)\right)\right)^{2}}$
\end_inset

 using the function 
\family typewriter
phi_integrand
\family default
:
\end_layout

\begin_deeper
\begin_layout Itemize
initiate lattices 
\family typewriter
X, Y, Z, T
\family default
 of size 
\begin_inset Formula $n_{x}\times n_{y}\times n_{z}\times n_{t}$
\end_inset

 using the 
\family typewriter
generate_coordinates_lattice 
\family default
method.
 (
\color red
Here you can see it take a lot of memory - for an integration of 
\begin_inset Formula $800$
\end_inset

 
\begin_inset Formula $z$
\end_inset

 points, for 
\begin_inset Formula $3$
\end_inset

 points in time and for an image of 128X128 pixels
\color inherit
, each of those lattices and 
\begin_inset Formula $A$
\end_inset

 itself will have 
\begin_inset Formula $4\cdot10^{7}$
\end_inset

 elements)
\end_layout

\begin_deeper
\begin_layout Itemize
\begin_inset space \space{}
\end_inset

explanation on the way they are initiated is in section 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "subsec:Addressing the complexity problem"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
 but in a nutshell:
\end_layout

\begin_layout Itemize
\begin_inset space \qquad{}
\end_inset

the 
\family typewriter
Z 
\family default
array is shifted such that for every 
\begin_inset Formula $x$
\end_inset

, the values of 
\begin_inset Formula $z$
\end_inset

 in that 
\begin_inset Formula $x$
\end_inset

 are centered around the optical axis of the cavity.
\end_layout

\begin_layout Itemize
\begin_inset space \qquad{}
\end_inset

the 
\family typewriter
Z
\family default
 axis is scaled so that for every 
\begin_inset Formula $x$
\end_inset

, the values of 
\begin_inset Formula $z$
\end_inset

 range between 
\begin_inset Formula $-5w\left(x\right)$
\end_inset

 to 
\begin_inset Formula $5w\left(x\right)$
\end_inset

.
\end_layout

\begin_layout Itemize
\begin_inset space \qquad{}
\end_inset

The 
\family typewriter
T
\family default
 array is shifted according to 
\begin_inset Formula $z$
\end_inset

 to make it 
\begin_inset Formula $T\left(z,t\right)=t+\frac{z}{\beta c}$
\end_inset

.
\end_layout

\end_deeper
\begin_layout Itemize
Calculate 
\begin_inset Formula $A\left(x,y,z,t\left(z\right)\right)$
\end_inset

 on the lattices using the method 
\family typewriter
rotated_gaussian_beam_A
\family default
.
 this method uses equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_37"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 for the evaluation of 
\begin_inset Formula $A$
\end_inset

.
\end_layout

\begin_layout Itemize
Using the values calculated for 
\begin_inset Formula $A$
\end_inset

, calculate 
\begin_inset Formula $\nabla G$
\end_inset

 in the method 
\family typewriter
grad_G:
\end_layout

\begin_deeper
\begin_layout Itemize
Recall that 
\begin_inset Formula $G$
\end_inset

 is defined to be:
\begin_inset Formula 
\[
G\left(x,y,z,t\right)=\intop_{Z}A_{z}\left(x,y,Z,t-\frac{z-Z}{\beta c}\right)dZ
\]

\end_inset


\end_layout

\begin_layout Itemize
The 
\begin_inset Formula $x$
\end_inset

 component of 
\begin_inset Formula $\nabla G$
\end_inset

 is given (by just substituting into the definition) by:
\begin_inset Formula 
\[
\frac{G\left(x+dx,y,z,t\right)-G\left(x,y,z,t\right)}{dx}=\frac{1}{dx}\cdot\left[\intop_{Z}A_{z}\left(x+dx,y,Z,t-\frac{z-Z}{\beta c}\right)dZ-\intop_{Z}A_{z}\left(x,y,Z,t-\frac{z-Z}{\beta c}\right)dZ\right]
\]

\end_inset


\end_layout

\begin_layout Itemize
Same goes for the 
\begin_inset Formula $y$
\end_inset

 component of 
\begin_inset Formula $\nabla G$
\end_inset


\end_layout

\begin_layout Itemize
But the 
\begin_inset Formula $z$
\end_inset

 component of 
\begin_inset Formula $G$
\end_inset

 has this form, that is derived in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_39"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
:
\begin_inset Formula 
\[
\frac{\partial G}{\partial z}=-\frac{1}{\beta c}\frac{\partial G}{\partial t}+A_{z}\left(z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)\right)\tag{{\color{blue}\ref{eq:e_39}}}
\]

\end_inset

Because of those we calculate 
\begin_inset Formula $A$
\end_inset

 again (
\series bold
\color red
Here is the heavy calculation!
\series default
\color inherit
) in small shifts in 
\begin_inset Formula $dx$
\end_inset

, 
\begin_inset Formula $dy$
\end_inset

, 
\begin_inset Formula $dt$
\end_inset

 (
\color red
and not 
\begin_inset Formula $dz!$
\end_inset


\color inherit
).
\end_layout

\begin_layout Itemize
Calculate 
\begin_inset Formula $G$
\end_inset

 again on those shifted 
\begin_inset Formula $A$
\end_inset

's
\end_layout

\begin_layout Itemize
Numerically evaluate 
\begin_inset Formula $\nabla G$
\end_inset

 using the values of the shifted 
\begin_inset Formula $G$
\end_inset

's.
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize
sum the values of 
\begin_inset Formula $\boldsymbol{A}\left(\boldsymbol{x},T\left(z,t\right)\right)$
\end_inset

 and 
\begin_inset Formula $\nabla G$
\end_inset

 according to how they appear in the integrand above.
\end_layout

\end_deeper
\begin_layout Itemize
integrate the values of 
\family typewriter
phi_integrand
\family default
 to get 
\begin_inset Formula $\phi$
\end_inset

.
\end_layout

\begin_layout Standard
using the resulted values of 
\begin_inset Formula $\phi$
\end_inset

, calculate the amplitude attenuation factor using the method 
\family typewriter
extract_0th_energy_level_amplitude
\family default
:
\end_layout

\begin_layout Itemize
if 
\begin_inset Formula $\phi$
\end_inset

 was evaluated on 
\begin_inset Formula $3$
\end_inset

 time points:
\end_layout

\begin_deeper
\begin_layout Itemize
then extract the values of the constant phase shift and the amplitude of
 the oscillating part using the derivation in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Calculating-the-zero'th energy amplitude"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
:
\begin_inset Formula 
\begin{align*}
{\color{brown}\phi_{\text{const}}} & =\frac{\phi\left(t_{0}\right)+\phi\left(t_{2}\right)}{2}\\
\varphi & \equiv\tan^{-1}\left(\frac{\phi\left(t_{0}\right)-\phi_{\text{const}}}{\phi\left(t_{1}\right)-\phi_{\text{const}}}\right)\\
{\color{teal}C_{\text{amplitude of oscilating phase}}} & =\frac{\phi\left(t_{1}\right)-\phi_{\text{const}}}{\cos\left(\varphi\right)}=\frac{\phi\left(t_{0}\right)-\phi_{\text{const}}}{\sin\left(\varphi\right)}
\end{align*}

\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
The phase mask is then given by the expression 
\begin_inset Formula ${\color{brown}e^{i\phi_{\text{const}}}}\cdot{\color{teal}J_{0}\left(C_{\text{amplitude of oscilating phase}}\right)}$
\end_inset

, as derived in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:after_energy_filter_general"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 (and mentioned in the beginning of this document).
\end_layout

\end_deeper
\begin_layout Itemize
If there are more then 
\begin_inset Formula $3$
\end_inset

 points in time for the evaluated 
\begin_inset Formula $\phi$
\end_inset

:
\end_layout

\begin_deeper
\begin_layout Itemize
evaluate the amplitude of the middle band using 
\family typewriter
np.fft.fft
\family default
.
\end_layout

\end_deeper
\end_deeper
\begin_layout Standard
Finally, multiply the resulted phase mask with the input wave to get the
 output wave
\end_layout

\begin_layout Subsection

\family typewriter
AberrationsPropagator
\end_layout

\begin_layout Standard
This object adds the aberrations to the picture, and is meant to be used
 as a final 
\family typewriter
Propagator
\family default
.
\end_layout

\begin_layout Standard
It does so by multiplying the image in Fourier space by the factors:
\begin_inset Formula 
\begin{align*}
\Psi\left(k_{x},k_{y}\right) & \rightarrow\Psi\left(k_{x},k_{y}\right)\cdot e^{\frac{1}{2}\left[C_{s}\lambda_{e}^{3}\cdot k^{2}-f\left(k\right)k^{2}\right]}\\
k^{2} & =k_{x}^{2}+k_{y}^{2}\\
f\left(k\right) & =f_{0}+f_{a}\cos\left(2\left(\varphi_{k}-\varphi_{0}\right)\right)\\
\varphi_{k} & =\tan^{-1}\left(\frac{k_{y}}{k_{x}}\right)
\end{align*}

\end_inset

Where 
\begin_inset Formula $C_{s}$
\end_inset

 is the spherical aberrations coefficient, 
\begin_inset Formula $\lambda_{e}$
\end_inset

 is the wavelength of the electron, 
\begin_inset Formula $f_{0}$
\end_inset

 is the defocusing parameter, 
\begin_inset Formula $f_{a}$
\end_inset

 is the astigmatism coefficient and 
\begin_inset Formula $\varphi_{0}$
\end_inset

 is the astigmatism orientation.
\end_layout

\begin_layout Standard
This formula is based on Berkleys notes in "Berkleys_Files
\backslash
Simulator_Documentation.pdf" in this Git project.
\end_layout

\begin_layout Subsection
Example code:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "language=Python,basicstyle={\ttfamily},style=mystyle"
inline false
status open

\begin_layout Plain Layout

from microscope import *
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

l_1 = 1064e-9
\end_layout

\begin_layout Plain Layout

l_2 = 532e-9
\end_layout

\begin_layout Plain Layout

NA_1 = 0.05
\end_layout

\begin_layout Plain Layout

N_POINTS = 128  # Resolution of image
\end_layout

\begin_layout Plain Layout

pixel_size = 1e-10
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

input_coordinate_system = CoordinateSystem(dxdydz=(pixel_size, pixel_size),
 n_points=(N_POINTS, N_POINTS))
\end_layout

\begin_layout Plain Layout

first_wave = WaveFunction(psi=np.ones((N_POINTS, N_POINTS)),
\end_layout

\begin_layout Plain Layout

                          coordinates=input_coordinate_system,
\end_layout

\begin_layout Plain Layout

                          E0=Joules_of_keV(300))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

dummy_sample = SamplePropagator(dummy_potential=f'letters_{N_POINTS}',
\end_layout

\begin_layout Plain Layout

                                coordinates_for_dummy_potential=CoordinateSystem
(axes=(input_coordinate_system.x_axis,
\end_layout

\begin_layout Plain Layout

                                                                       
                input_coordinate_system.y_axis,
\end_layout

\begin_layout Plain Layout

                                                                       
                np.linspace(-5e-10, 5e-10, 2)
\end_layout

\begin_layout Plain Layout

                                                                       
                )))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

first_lens = LensPropagator(focal_length=3.3e-3, fft_shift=True)
\end_layout

\begin_layout Plain Layout

second_lens = LensPropagator(focal_length=3.3e-3, fft_shift=False)
\end_layout

\begin_layout Plain Layout

cavity_2f_analytical = CavityAnalyticalPropagator(l_1=l_1, l_2=l_2, E_1=-1,
 NA_1=NA_1, ring_cavity=False,
\end_layout

\begin_layout Plain Layout

                                                  starting_E_in_auto_E_search=1e
6)
\end_layout

\begin_layout Plain Layout

aberration_propagator = AberrationsPropagator(Cs=1e-8, defocus=1e-10, astigmatis
m_parameter=0,
\end_layout

\begin_layout Plain Layout

                                              astigmatism_orientation=0)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

M = Microscope([dummy_sample, first_lens, cavity_2f_analytical, second_lens,
 aberration_propagator],
\end_layout

\begin_layout Plain Layout

               print_progress=True,
\end_layout

\begin_layout Plain Layout

               n_electrons_per_square_angstrom=50)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

pic = M.take_a_picture(first_wave)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

plt.imshow(pic.values)
\end_layout

\begin_layout Plain Layout

plt.title('image')
\end_layout

\begin_layout Plain Layout

plt.show()
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Part
Analytical derivations
\end_layout

\begin_layout Section
Review of Osip's paper 
\begin_inset CommandInset label
LatexCommand label
name "sec:Review-of-Osip's"

\end_inset


\end_layout

\begin_layout Standard
In this section I re-derive in a more elaborated way the same calculations
 already done in 
\bar under
\color blue

\begin_inset CommandInset href
LatexCommand href
name "relativistic ponderomotive potential paper"
target "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7357394/"
literal "false"

\end_inset


\bar default
\color inherit
.
\end_layout

\begin_layout Subsubsection
Find the phase shift using the field in the electron's rest frame 
\begin_inset Formula $S^{\prime}$
\end_inset


\end_layout

\begin_layout Standard
Start with the Schrodinger equation:
\begin_inset Formula 
\[
\frac{d}{dt}\psi\stackrel{\text{Schrodinger Eq.}}{=}\frac{i}{\hbar}\kaliHemiltonian{\color{lightgray}\ \backslash\intop dt}
\]

\end_inset


\begin_inset Formula 
\[
\psi\left(t\right)\stackrel{\text{Schrodinger Eq.}}{=}e^{\frac{i}{\hbar}\intop\kaliHemiltonian dt^{\prime}}\psi\left(0\right)=e^{\frac{i}{\hbar}\intop\left[\frac{1}{2}mv^{\prime2}-e\boldsymbol{A}^{\prime}\left(\boldsymbol{x}^{\prime}\left(t^{\prime}\right),t^{\prime}\right)\cdot\boldsymbol{v}^{\prime}\left(t^{\prime}\right)\right]dt^{\prime}}\psi\left(0\right)
\]

\end_inset

And so the total phase acquired is:
\begin_inset Formula 
\begin{equation}
\phi\left(t\right)=\frac{1}{\hbar}\intop\left[\frac{1}{2}mv^{\prime2}-e\boldsymbol{A}^{\prime}\left(\boldsymbol{x}^{\prime}\left(t^{\prime}\right),t^{\prime}\right)\cdot\boldsymbol{v}^{\prime}\left(t^{\prime}\right)\right]dt^{\prime}\label{eq:e_13}
\end{equation}

\end_inset

Since we are in Gibbs gauge, and 
\begin_inset Formula $A_{0}=0$
\end_inset

, the electric field is:
\end_layout

\begin_layout Standard
To first order the location of the electron in this frame is 
\begin_inset Formula $\boldsymbol{x}^{\prime}\left(t^{\prime}\right)=\boldsymbol{x}_{0}$
\end_inset

 (the initial position at rest) and so:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\boldsymbol{E}^{\prime}\left(\boldsymbol{x}_{0}^{\prime}\left(t^{\prime}\right),t^{\prime}\right)\approx\boldsymbol{E}^{\prime}\left(\boldsymbol{x}_{0}^{\prime},t^{\prime}\right)=-\frac{\partial}{\partial t^{\prime}}\boldsymbol{A}^{\prime}\left(\boldsymbol{x}_{0}^{\prime},t^{\prime}\right)
\]

\end_inset

And the force:
\begin_inset Formula 
\[
\boldsymbol{F}^{\prime}\left(t^{\prime}\right)=-e\boldsymbol{E}^{\prime}\left(\boldsymbol{x}_{0}^{\prime},t^{\prime}\right)=e\frac{\partial}{\partial t}\boldsymbol{A}^{\prime}\left(\boldsymbol{x}_{0}^{\prime},t^{\prime}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
And so 
\begin_inset Formula 
\[
\Delta\boldsymbol{p}\left(t^{\prime}\right)=\intop_{0}^{t^{\prime}}F^{\prime}\left(t^{\prime\prime}\right)dt^{\prime\prime}=e\intop_{0}^{t^{\prime}}\frac{\partial}{\partial t}\boldsymbol{A}^{\prime}\left(\boldsymbol{x}_{0}^{\prime},t^{\prime\prime}\right)dt^{\prime\prime}=e\boldsymbol{A^{\prime}}\left(\boldsymbol{x}_{0}^{\prime},t^{\prime}\right)
\]

\end_inset

And the velocity:
\begin_inset Formula 
\[
\boldsymbol{v}\left(t^{\prime}\right)=\frac{\Delta\boldsymbol{p}}{m}=\frac{e}{m}\boldsymbol{A}^{\prime}\left(\boldsymbol{x}_{0}^{\prime},t^{\prime}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
Plugging this velocity into 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_13"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
, we get:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align}
\phi\left(\boldsymbol{x}_{0}^{\prime},t\right) & =\frac{1}{\hbar}\intop_{0}^{t}\left[\frac{1}{2}m{\color{brown}v^{\prime2}}-e\boldsymbol{A}^{\prime}\left(\boldsymbol{x}^{\prime}\left(t^{\prime}\right),t^{\prime}\right)\cdot{\color{brown}\boldsymbol{v}^{\prime}\left(t^{\prime}\right)}\right]dt^{\prime}\nonumber \\
 & =\frac{1}{\hbar}\intop_{0}^{t}\left[\frac{1}{2}m\left({\color{brown}\frac{e}{m}A^{\prime}\left(\boldsymbol{x}_{0},t^{\prime}\right)}\right)^{2}-e\boldsymbol{A}^{\prime}\left(\boldsymbol{x}_{0},t^{\prime}\right)\cdot\left({\color{brown}\frac{e}{m}A^{\prime}\left(\boldsymbol{x}_{0},t^{\prime}\right)}\right)\right]dt^{\prime}\nonumber \\
 & =\frac{1}{\hbar}\intop_{0}^{t}\left[\frac{1}{2}{\color{brown}\frac{e^{2}}{m}A^{2}\left(\boldsymbol{x}_{0},t^{\prime}\right)}-\frac{e^{2}}{m}\boldsymbol{A}^{\prime2}\left(\boldsymbol{x}_{0},t^{\prime}\right)\cdot\right]dt^{\prime}\nonumber \\
 & =-\frac{1}{\hbar}\intop_{0}^{t}\frac{e^{2}}{2m}\boldsymbol{A}^{\prime2}\left(\boldsymbol{x}_{0},t^{\prime}\right)dt^{\prime}\label{eq:e_15}
\end{align}

\end_inset


\end_layout

\begin_layout Subsubsection
Convert 
\begin_inset Formula $\boldsymbol{A}^{\prime}$
\end_inset

 from electron's frame to 
\begin_inset Formula $\boldsymbol{A}$
\end_inset

 in lab's frame preserving Gibbs gauge:
\end_layout

\begin_layout Standard
Let us denote the field in coulomb gauge in the electron's frame with 
\begin_inset Formula $A^{\prime}$
\end_inset

, the field in the lab frame after Lorentz transformation from the electron's
 frame with 
\begin_inset Formula $\tilde{A}$
\end_inset

, the field in the lab's frame and in coulomb gauge with 
\begin_inset Formula $A$
\end_inset

.
\end_layout

\begin_layout Standard
Since 
\begin_inset Formula $A^{\prime}$
\end_inset

 and 
\begin_inset Formula $A$
\end_inset

 are in coulomb gauge (Gibbs gauge, in particular), we have: 
\begin_inset Formula $A_{0}=0=\tilde{A}_{0}$
\end_inset

.
\end_layout

\begin_layout Standard
Let us express everything in terms of 
\begin_inset Formula $\left(\tilde{A}_{0},\tilde{A}\right)$
\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align}
\Phi^{\prime}=0 & =\frac{\gamma}{c}\tilde{A_{0}}-\gamma\beta\tilde{A}_{z}\label{eq:S_1}\\
\boldsymbol{A}_{\perp}^{\prime} & =\tilde{\boldsymbol{A}}_{\perp}\nonumber \\
A_{z}^{\prime} & =-\frac{\gamma}{c}\beta\tilde{A_{0}}+\gamma\tilde{A}_{z}=-\frac{\gamma}{\cancel{c}}\beta^{2}\cancel{c}\tilde{A}_{z}+\gamma\tilde{A}_{z}=\gamma\left(1-\beta^{2}\right)\tilde{A}_{z}=\frac{\left(1-\beta^{2}\right)}{\sqrt{1-\beta^{2}}}\tilde{A}_{z}=\sqrt{1-\beta^{2}}\tilde{A}_{z}=\frac{1}{\gamma}\tilde{A}_{z}\label{eq:e_14}\\
\boldsymbol{A} & =\tilde{\boldsymbol{A}}+\nabla G\Rightarrow\nonumber \\
{\color{gray}A_{z}} & {\color{gray}=\tilde{A}_{z}+\partial_{z}G}\label{eq:S_4}\\
{\color{gray}A_{x}} & {\color{gray}=\tilde{A}_{x}+\partial_{x}G}\nonumber \\
{\color{gray}A_{y}} & {\color{gray}=\tilde{A}_{y}+\partial_{y}G}\nonumber \\
A_{0} & =\tilde{A}_{0}-\partial_{t}G=0\label{eq:S_5}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
Given an electromagnetic vector potential:
\begin_inset Formula 
\[
\left(\tilde{A}_{0},\boldsymbol{\tilde{A}}\right)
\]

\end_inset

Any gauge will be of the form:
\begin_inset Formula 
\begin{align*}
\tilde{\boldsymbol{A}} & \rightarrow\boldsymbol{A}=\tilde{\boldsymbol{A}}+\nabla G\\
\tilde{A}_{0} & \rightarrow A_{0}=\tilde{A}_{0}-\partial_{t}G
\end{align*}

\end_inset

If we want to make 
\begin_inset Formula $\tilde{A_{0}}$
\end_inset

 vanish then we get an equation on 
\begin_inset Formula $G$
\end_inset

:
\begin_inset Formula 
\begin{equation}
\partial_{t}G\stackrel{\left({\color{blue}\ref{eq:S_5}}\right)}{=}\tilde{A}_{0}\tag{S5}\label{eq:e_22}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
If 
\begin_inset Formula $\left(\tilde{A}_{0},\tilde{\boldsymbol{A}}\right)$
\end_inset

 was itself achieved by Lorentz transforming a coulomb gauged vector potential:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\tilde{A}_{0}\stackrel{\left({\color{blue}\ref{eq:S_1}}\right)}{=}\beta c\tilde{A}_{z}\tag{S1}\label{eq:e_23}
\end{equation}

\end_inset

Substituting the result from 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_22"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 to 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_23"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit

\begin_inset Formula 
\[
A_{z}\stackrel{\left({\color{blue}\ref{eq:S_4}}\right)}{=}\partial_{z}G+\tilde{A}_{z}{\color{lightgray}\ \backslash-\partial_{z}G}
\]

\end_inset


\begin_inset Formula 
\[
\left(A_{z}-\partial_{z}G\right)\stackrel{\left({\color{blue}\ref{eq:S_4}}\right)}{=}\tilde{A}_{z}
\]

\end_inset


\begin_inset Formula 
\[
\partial_{t}G\stackrel{\left(S5\right)}{=}\tilde{A_{0}}\stackrel{\left(S1\right)}{=}\beta c\tilde{A}_{z}\stackrel{\left(S4\right)}{=}\beta c\left(A_{z}-\partial_{z}G\right){\color{lightgray}\ \backslash+\beta c\partial_{z}G}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\left[\partial_{t}+\beta c\partial_{z}\right]G=\beta cA_{z}\kaliV\label{eq:e_12}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Guess solution of the form:
\begin_inset Formula 
\begin{equation}
G\left(\boldsymbol{x},t\right)=c\beta\intop_{-\infty}^{t}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)dt^{\prime}\label{eq:G_def}
\end{equation}

\end_inset


\end_layout

\begin_layout Paragraph
Let's verify that this solution works:
\end_layout

\begin_layout Standard
Define:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
f_{t}\left(t^{\prime}\right)=A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)
\]

\end_inset

And get:
\begin_inset Formula 
\begin{align}
{\color{teal}\frac{\partial}{\partial t}\left(c\beta\intop_{-\infty}^{t}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)dt^{\prime}\right)}=\nonumber \\
= & \frac{\partial}{\partial t}\left(c\beta\intop_{-\infty}^{t}f_{t}\left(t^{\prime}\right)dt^{\prime}\right)\nonumber \\
= & c\beta\frac{\partial}{\partial t}\left(\intop_{-\infty}^{t}f_{t}\left(t^{\prime}\right)dt^{\prime}\right)\nonumber \\
= & c\beta\lim_{dt\rightarrow0}\left(\intop_{-\infty}^{t+dt}f_{t+dt}\left(t^{\prime}\right)dt^{\prime}-\intop_{-\infty}^{t}f_{t}\left(t^{\prime}\right)dt^{\prime}\right):dt\nonumber \\
= & c\beta\lim_{dt\rightarrow0}\left({\color{red}\intop_{t}^{t+dt}f_{t+dt}\left(t^{\prime}\right)dt^{\prime}}+{\color{green}\intop_{-\infty}^{t}f_{t+dt}\left(t^{\prime}\right)dt^{\prime}}-{\color{blue}\intop_{-\infty}^{t}f_{t}\left(t^{\prime}\right)dt^{\prime}}\right):dt\nonumber \\
= & c\beta\lim_{dt\rightarrow0}\left({\color{gray}\underset{f_{t+dt}\left(t^{\prime}\right)\cdot dt}{\underbrace{{\normalcolor {\color{red}\intop_{t}^{t+dt}f_{t+dt}\left(t^{\prime}\right)dt^{\prime}}}}}}+\intop_{-\infty}^{t}{\color{gray}\underset{\frac{d}{dt}f_{t}\left(t^{\prime}\right)\cdot dt}{\underbrace{{\normalcolor \left({\color{green}f_{t+dt}\left(t^{\prime}\right)}-{\color{blue}f_{t}\left(t^{\prime}\right)}\right)}}}}dt^{\prime}\right):dt\nonumber \\
= & c\beta\lim_{dt\rightarrow0}\left({\color{red}f_{t+dt}\left(t\right)\cdot\cancel{dt}}+\intop_{-\infty}^{t}\frac{d}{dt}f_{t}\left(t^{\prime}\right)\cdot\cancel{dt}dt^{\prime}\right):\cancel{dt}\nonumber \\
= & c\beta\lim_{dt\rightarrow0}\left(f_{t+\cancel{dt}}\left(t\right)+\intop_{-\infty}^{t}\frac{d}{dt}f_{t}\left(t^{\prime}\right)dt^{\prime}\right)\nonumber \\
= & c\beta\lim_{dt\rightarrow0}\left(f_{t}\left(t\right)+\intop_{-\infty}^{t}\frac{d}{dt}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)dt^{\prime}\right)\nonumber \\
= & c\beta\left(A_{z}\left(z,t\right)+\intop_{-\infty}^{t}\frac{\partial}{\partial z}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)\cdot{\color{gray}\underset{-c\beta}{\underbrace{{\normalcolor \frac{d}{dt}\left(z-c\beta\left(t-t^{\prime}\right)\right)}}}}dt^{\prime}\right)\nonumber \\
= & c\beta\left(A_{z}\left(z,t\right)+\intop_{-\infty}^{t}\frac{\partial}{\partial z}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)\left(-c\beta\right)dt^{\prime}\right)\nonumber \\
= & {\color{teal}c\beta\left(A_{z}\left(z,t\right)-\beta c\intop_{-\infty}^{t}\frac{\partial}{\partial z}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)dt^{\prime}\right)}\label{eq:infi_proof}
\end{align}

\end_inset


\begin_inset Formula 
\[
{\color{brown}\frac{\partial}{\partial z}G}=\frac{\partial}{\partial z}\left(c\beta\intop_{-\infty}^{t}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)dt^{\prime}\right)={\color{brown}c\beta\intop_{-\infty}^{t}\frac{\partial}{\partial z}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)dt^{\prime}}
\]

\end_inset


\end_layout

\begin_layout Standard
Plugging in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_12"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
, we see indeed that:
\begin_inset Formula 
\[
{\color{teal}\partial_{t}G}+{\color{brown}\beta c\frac{\partial}{\partial z}G}={\color{teal}c\beta\left(A_{z}\left(z,t\right)-\cancel{\beta c\intop_{-\infty}^{t}\frac{\partial}{\partial z}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)dt^{\prime}}\right)}+\cancel{{\color{brown}\left(c\beta\right)^{2}\intop_{-\infty}^{t}\frac{\partial}{\partial z}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)dt^{\prime}}}=
\]

\end_inset


\begin_inset Formula 
\[
{\color{teal}\partial_{t}G}+{\color{brown}\beta c\frac{\partial}{\partial z}G}=c\beta A_{z}\left(z,t\right)\kaliV
\]

\end_inset


\end_layout

\begin_layout Paragraph
Proof's of Osip's approximation for 
\begin_inset Formula $G$
\end_inset

:
\end_layout

\begin_layout Standard
First, let us rewrite the the integral of 
\begin_inset Formula $G$
\end_inset

 as such:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\nicefrac{G}{\beta c}=\intop_{-\infty}^{t}A_{z}\left(z-\beta c\left(t-T\right),T\right)dT
\]

\end_inset

Define:
\begin_inset Formula 
\begin{align}
Z & =z-\beta c\left(t-T\right) & \frac{1}{\beta c}dZ & =dT & T=t & \iff Z=z\label{eq:e_24}\\
T & =\frac{Z-z}{\beta c}+t\nonumber 
\end{align}

\end_inset


\begin_inset Formula 
\[
\nicefrac{G}{\beta c}=\intop_{-\infty}^{t}A_{z}\left(z-\beta c\left(t-T\right),T\right)dT=\frac{1}{\beta c}\intop_{-\infty}^{z}A_{z}\left(Z,\frac{Z-z}{\beta c}+t\right)dZ
\]

\end_inset

With the frequency:
\begin_inset Formula 
\begin{align*}
\cos\left(\omega T\right) & =\cos\left(\omega\left(\frac{Z-z}{\beta c}+t\right)\right)\Rightarrow & \tilde{k} & =\frac{\omega}{\beta c}=\frac{k_{L}}{\beta} & \varphi_{z,t} & =\omega\left(t-\frac{z}{\beta c}\right)
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
Now, let us show that 
\begin_inset Formula $G\approx\beta c\intop_{0}^{t}A\left(z,t^{\prime}\right)dt^{\prime}=A_{\text{envelope}}\left(z\right)\cdot\sin\left(\omega t\right)$
\end_inset

.
\end_layout

\begin_layout Standard
We will show it by looking at 
\begin_inset Formula $\frac{\partial\nicefrac{G}{\beta c}}{\partial t}$
\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\frac{\partial\nicefrac{G}{\beta c}}{\partial t}\stackrel{{\color{blue}\eqref{eq:infi_proof}}}{=}A_{z}\left(z,t\right)-\beta c\intop_{-\infty}^{t}\frac{\partial}{\partial z}A_{z}\left(z-c\beta\left(t-t^{\prime}\right),t^{\prime}\right)dt^{\prime}=A_{z}\left(z,t\right)-\beta c\intop_{-\infty}^{t}A^{\prime}\left(z-\beta c\left(t-t^{\prime}\right)\right)\cos\left(\omega t^{\prime}\right)dt^{\prime}=
\]

\end_inset


\begin_inset Formula 
\[
={\color{green}A_{z}\left(z,t\right)}-\cancel{\frac{\beta c}{\beta c}}{\color{red}\intop_{-\infty}^{z}A^{\prime}\left(Z\right)\cos\left(\frac{k}{\beta}\left(Z-z\right)+\omega t\right)dZ}=
\]

\end_inset


\end_layout

\begin_layout Standard
And so since 
\begin_inset Formula $G\left(z,t\right)=\intop_{-\infty}^{t}\frac{\partial}{\partial t^{\prime}}G\left(z,t^{\prime}\right)dt^{\prime}$
\end_inset

, we want to show that just the second term is much smaller than the first
 term:
\begin_inset Formula 
\[
G\left(z,t\right)=\intop_{-\infty}^{t}\frac{\partial}{\partial t^{\prime}}G\left(z,t^{\prime}\right)dt^{\prime}=\overset{\kaliV}{{\color{green}\intop_{-\infty}^{t}A_{z}\left(z,t^{\prime}\right)dt^{\prime}}}-{\color{red}\intop_{0}^{t}\intop_{-\infty}^{z}A^{\prime}\left(Z\right)\cos\left(\frac{k}{\beta}\left(Z-z\right)+\omega t^{\prime}\right)dZdt^{\prime}}=
\]

\end_inset

Continuing only with the second element:
\begin_inset Formula 
\[
=-{\color{red}\intop_{-\infty}^{z}A^{\prime}\left(Z\right)\intop_{0}^{t}\cos\left(\frac{k}{\beta}\left(Z-z\right)+\omega t^{\prime}\right)dt^{\prime}dZ}
\]

\end_inset


\begin_inset Formula 
\[
=-\frac{1}{\omega}\intop_{-\infty}^{z}{\color{gray}\underset{=\frac{Z}{\sigma^{2}}A\left(Z\right)}{\underbrace{{\normalcolor A^{\prime}\left(Z\right)}}}}\sin\left(\frac{k}{\beta}Z-\frac{k}{\beta}z+t\right)dZ
\]

\end_inset


\begin_inset Formula 
\[
=-\frac{1}{\omega}\intop_{-\infty}^{z}\frac{{\color{gray}\overset{\approx\cancel{w}}{\overbrace{{\normalcolor Z}}}}}{w^{\cancel{2}}}A\left(Z\right)\sin\left(\frac{k}{\beta}Z-\frac{k}{\beta}z+t\right)dZ
\]

\end_inset


\begin_inset Formula 
\[
\approx-\frac{1}{\omega w}{\color{gray}\underset{}{\underbrace{{\normalcolor \intop_{-\infty}^{z}A\left(Z\right)\sin\left(\frac{k}{\beta}Z-\frac{k}{\beta}z+t\right)dZ}}}}
\]

\end_inset


\begin_inset Formula 
\[
\beta\cancel{c}\stackrel{?}{\ll}-\omega w=\cancel{c}kw
\]

\end_inset


\begin_inset Formula 
\[
\beta\stackrel{?}{\ll}kw=\frac{2\cancel{k}}{\cancel{k}\kaliNA}=\frac{2}{\kaliNA}\kaliV
\]

\end_inset


\end_layout

\begin_layout Paragraph
Coming back to the main discussion:
\end_layout

\begin_layout Standard
The field in the laboratory frame before gauging it back is:
\begin_inset Formula 
\begin{alignat*}{3}
\boldsymbol{A}_{\perp}^{\prime}\left(\boldsymbol{x}^{\prime},t^{\prime}\right) & = & \begin{pmatrix}A_{x}^{\prime}\\
A_{y}^{\prime}
\end{pmatrix}\left(\boldsymbol{x}^{\prime},t^{\prime}\right) & = & \begin{pmatrix}\tilde{A}_{x}\\
\tilde{A}_{y}
\end{pmatrix}\left(\boldsymbol{x},t\right) & =\tilde{\boldsymbol{A}}_{\perp}\left(\boldsymbol{x},t\right)\\
A_{\parallel}^{\prime}\left(\boldsymbol{x}^{\prime},t^{\prime}\right) & = & A_{z}^{\prime}\left(\boldsymbol{x}^{\prime},t^{\prime}\right) & = & \frac{1}{\gamma}\tilde{A}_{z}\left(\boldsymbol{x},t\right) & =\frac{1}{\gamma}\tilde{A}_{\parallel}\left(\boldsymbol{x},t\right)\\
0 & = & A_{0}^{\prime} & = & \frac{\gamma}{c}\tilde{\Phi}\left(\boldsymbol{x},t\right) & -\gamma\beta\tilde{A}_{z}
\end{alignat*}

\end_inset

And
\begin_inset Formula 
\begin{align*}
\boldsymbol{A} & =\tilde{\boldsymbol{A}}+\nabla G\\
\Phi & =\tilde{\Phi}-\partial_{t}G
\end{align*}

\end_inset

So we get:
\begin_inset Formula 
\begin{align}
\boldsymbol{A}^{\prime2} & =A_{x}^{\prime2}+A_{z}^{\prime2}+A_{z}^{\prime2}\nonumber \\
 & =\tilde{A}_{x}^{2}+\tilde{A}_{z}^{2}+\frac{1}{\gamma^{2}}\tilde{A}_{z}^{2}\nonumber \\
 & ={\color{green}\tilde{A}_{x}^{2}+\tilde{A}_{z}^{2}+\tilde{A}_{z}^{2}}+\left(\frac{1}{\gamma^{2}}-1\right)\tilde{A}_{z}^{2}\nonumber \\
 & ={\color{green}\tilde{A}^{2}}+\left(\left(\cancel{1}-{\color{blue}\beta^{2}}\right)-\cancel{1}\right)\tilde{A}_{z}^{2}\nonumber \\
 & ={\color{green}\tilde{A}^{2}}-{\color{blue}\beta^{2}\tilde{A}_{z}^{2}}\nonumber \\
\boldsymbol{A}^{\prime2} & ={\color{green}\left(\boldsymbol{A}-\nabla G\right)^{2}}-{\color{blue}\beta^{2}\left(A_{z}-\partial_{z}G\right)^{2}}\label{eq:e_16}
\end{align}

\end_inset

And so substituting 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_15"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 into 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_16"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 we get:
\begin_inset Formula 
\begin{align*}
\phi\left(\boldsymbol{x}_{0}^{\prime},t\right) & \stackrel{{\color{blue}\eqref{eq:e_15}}}{=}-\frac{1}{\hbar}\intop_{-\infty}^{t}\frac{e^{2}}{2m}\boldsymbol{A}^{\prime2}\left(\boldsymbol{x}_{0}^{\prime},t^{\prime}\right)dt^{\prime}
\end{align*}

\end_inset

In the lab's frame 
\begin_inset Formula $\left(\boldsymbol{x}_{0}^{\prime},t^{\prime}\right)$
\end_inset

 become 
\begin_inset Formula $\left(x_{0},y_{0},z_{0}+\beta cT,T\right)=\left(x,y,z\left(T\right),T\right)$
\end_inset

 and 
\begin_inset Formula $dt^{\prime}$
\end_inset

 becomes 
\begin_inset Formula $\frac{1}{\gamma}dT$
\end_inset

 and so we get: 
\begin_inset Formula 
\[
\phi\left(x_{0},y_{0},z_{0},t\right)=-\frac{1}{\hbar}\intop_{-\infty}^{t}\frac{e^{2}}{2m}\left({\color{green}\left(\boldsymbol{A}\left(x_{0},y_{0},z\left(T\right),T\right)-\nabla G\right)^{2}}-{\color{blue}\beta^{2}\left(A_{z}-\partial_{z}G\right)^{2}}\right){\color{gray}\underset{dt^{\prime}}{\underbrace{{\normalcolor \left(\frac{1}{\gamma}dT\right)}}}}
\]

\end_inset

(Also 
\begin_inset Formula $\nabla G,A_{z},\partial_{z}G$
\end_inset

 are evaluated at 
\begin_inset Formula $\left(x_{0},y_{0},z\left(T\right),T\right)$
\end_inset

)
\end_layout

\begin_layout Standard
changing variables for comfort:
\begin_inset Formula 
\begin{align*}
z & =z_{0}+\beta cT\Rightarrow & T\left(z,t_{0}\right) & =t_{0}+\frac{1}{\beta c}z & dT & =\frac{1}{\beta c}dz
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
we get:
\begin_inset Formula 
\[
\phi\left(z,t_{0}\right)=-\frac{1}{\hbar}\intop_{-\infty}^{z}\frac{e^{2}}{2m\gamma\beta c}\left({\color{green}\left(\boldsymbol{A}\left(x,y,z,T\left(z,t_{0}\right)\right)-\nabla G\left(\boldsymbol{x},T\left(z,t_{0}\right)\right)\right)^{2}}-{\color{blue}\beta^{2}\left(A_{z}\left(\boldsymbol{x},T\left(z,t_{0}\right)\right)-\partial_{z}G\left(\boldsymbol{x},T\left(z,t_{0}\right)\right)\right)^{2}}\right)dz
\]

\end_inset

And in total after passing through the whole potential (taking 
\begin_inset Formula $z\rightarrow\infty$
\end_inset

) we get:
\begin_inset Formula 
\begin{align}
\phi\left(t_{0}\right) & =-\frac{1}{\hbar}\intop_{-\infty}^{\infty}\frac{e^{2}}{2m\gamma\beta c}\left({\color{green}\left(\boldsymbol{A}\left(\boldsymbol{x},T\left(z,t_{0}\right)\right)-\nabla G\left(\boldsymbol{x},T\left(z,t_{0}\right)\right)\right)^{2}}-{\color{blue}\beta^{2}\left(A_{z}\left(\boldsymbol{x},T\left(z,t_{0}\right)\right)-\partial_{z}G\left(\boldsymbol{x},T\left(z,t_{0}\right)\right)\right)^{2}}\right)dz\tag{e\_3}\label{eq:e_3}\\
 & =-\frac{1}{\hbar}\intop_{-\infty}^{\infty}\frac{e^{2}}{2m\gamma\beta c}\left[{\color{green}\left(A_{x}-\partial_{x}G\right)^{2}}+{\color{green}\left(A_{y}-\partial_{y}G\right)^{2}}+\left({\color{green}1}-{\color{blue}\beta^{2}}\right)\left(A_{z}-\partial_{z}G\right)^{2}\right]dz\\
\\
T\left(z,t_{0}\right) & =t_{0}+\frac{1}{\beta c}z\nonumber 
\end{align}

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
For a wave that propagates mostly in the 
\begin_inset Formula $x$
\end_inset

 direction, we can denote it's field as:
\begin_inset Formula 
\[
\boldsymbol{A}\left(x,y,z,t\right)=A_{0}\left(x,y,z,t\right)\cdot\begin{pmatrix}0\\
\sin\theta\\
\cos\theta
\end{pmatrix}
\]

\end_inset

And if we denote:
\begin_inset Formula 
\begin{align*}
G_{0}\left(x,y,z,t\right) & =\intop_{-\infty}^{z}A_{0}\left(x,y,Z,t-\frac{z-Z}{\beta c}\right)dZ
\end{align*}

\end_inset

The we can write:
\begin_inset Formula 
\[
G=G_{0}\cos\theta
\]

\end_inset


\end_layout

\begin_layout Plain Layout
And get:
\begin_inset Formula 
\begin{align*}
\phi\left(t_{0}\right) & =-\frac{1}{\hbar}\intop_{-\infty}^{\infty}\frac{e^{2}}{2m\gamma\beta c}\left[{\color{green}\left(\partial_{x}\cos\theta G_{0}\right)^{2}}+{\color{green}\left(A_{0}\sin\theta-\partial_{y}G_{0}\cos\theta\right)^{2}}+\left({\color{green}1}-{\color{blue}\beta^{2}}\right)\left(A_{0}\cos\theta-\partial_{z}G_{0}\cos\theta\right)^{2}\right]dz\\
 & =-\frac{1}{\hbar}\intop_{-\infty}^{\infty}\frac{e^{2}}{2m\gamma\beta c}\left[\cos^{2}\theta\left(\partial_{x}G_{0}\right)^{2}+A_{0}^{2}\sin^{2}\theta-2\sin\theta\cos\theta A_{0}\cdot\partial_{y}G_{0}+\cos^{2}\theta\left(\partial_{y}G_{0}\right)^{2}+\cos^{2}\theta\left({\color{green}1}-{\color{blue}\beta^{2}}\right)\left(A_{0}^{2}+2A_{0}\partial_{z}G_{0}+\left(\partial_{z}G_{0}\right)^{2}\right)\right]dz\\
 & =-\frac{1}{\hbar}\intop_{-\infty}^{\infty}\frac{e^{2}}{2m\gamma\beta c}\left[\cos^{2}\theta\left[\left(\partial_{x}G_{0}\right)^{2}+\left(\partial_{y}G_{0}\right)^{2}+\left(\partial_{z}G_{0}\right)^{2}\right]+A_{0}^{2}\left(\cos^{2}\left(\theta\right)\left(1-\beta^{2}\right)+\sin^{2}\left(\theta\right)\right)-2\sin\theta\cos\theta A_{0}\cdot\partial_{y}G_{0}+2\cos^{2}\theta\left(1-\beta^{2}\right)A_{0}G_{0}-\cos^{2}\theta\beta^{2}\left(\partial_{z}G_{0}\right)\right]dz\\
 & =-\frac{1}{\hbar}\intop_{-\infty}^{\infty}\frac{e^{2}}{2m\gamma\beta c}\left[\cos^{2}\theta\left(\nabla G_{0}\right)^{2}+A_{0}^{2}\left(1-\cos^{2}\theta\beta^{2}\right)-2\sin\theta\cos\theta A_{0}\cdot\partial_{y}G_{0}+2\cos^{2}\theta\left(1-\beta^{2}\right)A_{0}G_{0}-\cos^{2}\theta\beta^{2}G_{0}^{2}\right]dz
\end{align*}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\[
\phi\left(\omega\right)=-\frac{1}{\hbar}\intop_{z_{0}}^{z_{1}}\frac{e^{2}}{2m\gamma\beta c}\kaliFourier_{t_{0}}\left[{\color{green}\left(\left[\boldsymbol{A}\left(\boldsymbol{x},t\left(z,t_{0}\right)\right)\right]-\nabla G\left(\boldsymbol{x},t\left(z,t_{0}\right)\right)\right)^{2}}-{\color{blue}\beta^{2}\left(A_{z}\left(\boldsymbol{x},t\left(z,t_{0}\right)\right)-\partial_{z}G\left(\boldsymbol{x},t\left(z,t_{0}\right)\right)\right)^{2}}\right]\left(\omega\right)dz
\]

\end_inset


\begin_inset Formula 
\begin{align*}
A\left(x,y,z,\omega\right) & =\delta\left(\omega-\omega_{0}\right)\cdot\text{Envelope}\left(x,y,z\right)\\
A\left(x,y,z,t\right) & =e^{i\omega_{0}t}\cdot\text{Envelope}\left(x,y,z\right)
\end{align*}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
And for the special case of 
\begin_inset Formula $G$
\end_inset

 with gradient only in the 
\begin_inset Formula $\hat{x}$
\end_inset

 direction (which we will later find out is the case) and for 
\begin_inset Formula $A_{x}=0$
\end_inset

:
\begin_inset Formula 
\begin{align}
\phi\left(t\right) & =-\frac{1}{\hbar}\intop_{z}\frac{e^{2}}{2m\gamma\beta c}\left({\color{green}\cancel{A_{x}^{2}}+\cancel{2A_{x}\partial_{x}G}+\left(\partial_{x}G\right)^{2}+A_{y}^{2}+A_{z}^{2}}-{\color{blue}\beta^{2}A_{z}^{2}+\cancel{\beta^{2}2A_{z}\partial_{z}G}-\cancel{\beta^{2}\left(\partial_{z}G\right)^{2}}}\right)dz\nonumber \\
 & =-\frac{1}{\hbar}\intop_{z}\frac{e^{2}}{2m\gamma\beta c}\left(A_{y}^{2}+\left(1-{\color{blue}\beta^{2}}\right)A_{z}^{2}+\left(\partial_{x}G\right)^{2}\right)dz\nonumber \\
 & =-\frac{1}{\hbar}\intop_{z}\frac{e^{2}}{2m\gamma\beta c}\left(A_{y}^{2}\left(\boldsymbol{x},t\left(z\right)\right)+\left(1-{\color{blue}\beta^{2}}\right)A_{z}^{2}\left(\boldsymbol{x},t\left(z\right)\right)+\left(\partial_{x}G\left(\boldsymbol{x},t\left(z\right)\right)\right)^{2}\right)dz\label{eq:e_18}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
Fitting a vector potential 
\begin_inset Formula $\boldsymbol{A}$
\end_inset

 in the lab frame to the Gaussian beam standing wave:
\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\[
\boldsymbol{A}=A\left(y,z\right)e^{i\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)-\omega t\right)}\begin{pmatrix}0\\
0\\
\sin\theta e^{-i\varepsilon}\\
\cos\theta
\end{pmatrix}
\]

\end_inset

Deriving it by time, we get:
\begin_inset Formula 
\begin{align*}
\boldsymbol{E}=-\frac{\partial}{\partial t}\boldsymbol{A} & =A\left(y,z\right)e^{i\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)-\omega t\right)}\cdot\begin{pmatrix}0\\
\sin\theta e^{-i\varepsilon}\\
\cos\theta
\end{pmatrix}\\
\boldsymbol{E} & =\omega A\left(y,z\right)e^{i\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)-\omega t\right)}\cdot\begin{pmatrix}0\\
\sin\theta e^{-i\varepsilon}\\
\cos\theta
\end{pmatrix}
\end{align*}

\end_inset

And so we see that setting 
\begin_inset Formula $A\left(y,z\right)=\frac{1}{\omega}A\frac{w_{0}}{w\left(x\right)}e^{-\frac{\left(y^{2}+z^{2}\right)}{\sigma^{2}}}$
\end_inset

 will result in the correct field.
\begin_inset Formula 
\[
\boldsymbol{E}=A\frac{w_{0}}{w\left(x\right)}e^{-\frac{\left(y^{2}+z^{2}\right)}{\sigma^{2}}}e^{i\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)-\omega t\right)}\begin{pmatrix}0\\
\sin\theta e^{-i\varepsilon}\\
\cos\theta
\end{pmatrix}\kaliV
\]

\end_inset


\end_layout

\begin_layout Plain Layout
It satisfies the gibbs condition of 
\begin_inset Formula $A_{0}=0$
\end_inset

 by definition.
\end_layout

\begin_layout Plain Layout
And the divergence:
\begin_inset Formula 
\begin{align*}
\nabla\cdot\boldsymbol{A} & =\begin{pmatrix}\frac{\partial}{\partial x}\\
\frac{\partial}{\partial y}\\
\frac{\partial}{\partial z}
\end{pmatrix}\begin{pmatrix}0\\
A\frac{w_{0}}{w\left(x\right)}e^{-\frac{\left(y^{2}+z^{2}\right)}{\sigma^{2}}}e^{i\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)-\omega t\right)}\cdot\sin\theta e^{-i\varepsilon}\\
A\left(y,z\right)e^{i\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)-\omega t\right)}\cdot\cos\theta
\end{pmatrix}=\\
 & =\left[\partial_{y}A\left(y,z\right)\right]\cdot e^{i\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)-\omega t\right)}\cdot\sin\theta e^{-i\varepsilon}+\left[\partial_{z}A\left(y,z\right)\right]\left(y,z\right)e^{i\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)-\omega t\right)}\cdot\cos\theta\ll\boldsymbol{B}
\end{align*}

\end_inset


\end_layout

\begin_layout Plain Layout
we can't say about anything which is not dimensionless that it is close
 to 
\begin_inset Formula $0$
\end_inset

, but we can say that it is much closer to 
\begin_inset Formula $0$
\end_inset

 comparing to another physical value with the same dimensions.
\end_layout

\begin_layout Plain Layout
Since the sizes of the terms are in the order of magnitude of 
\begin_inset Formula $\partial_{y}A\left(y,z\right)$
\end_inset

 which is much smaller then 
\begin_inset Formula ${\color{brown}k_{l}\cdot A\left(y,z\right)}$
\end_inset

 (the derivative with respect to 
\begin_inset Formula $x$
\end_inset

), we get that this divergence is much smaller then 
\begin_inset Formula $B$
\end_inset

 (which has the same units), and therefore close to 
\begin_inset Formula $0$
\end_inset

.
 (because 
\begin_inset Formula $B_{z}$
\end_inset

, for example, has the term 
\begin_inset Formula $\partial_{x}A\left(y,z\right)\cdot e^{\ldots}={\color{brown}ik_{l}A\left(y,z\right)}e^{\ldots}$
\end_inset

)
\end_layout

\begin_layout Plain Layout
Given this 
\begin_inset Formula $A$
\end_inset

, the 
\begin_inset Formula $G$
\end_inset

 function will be:
\begin_inset Formula 
\begin{align*}
G & =c\beta\intop_{-\infty}^{t}A_{z}\left(\boldsymbol{x}-\beta c\left(t-T\right)\hat{z},T\right)dT\\
 & =c\beta\intop_{-\infty}^{t}\left[{\color{gray}\underset{^{\text{amplitude only}}}{\underbrace{{\normalcolor A}}}}\left(x,y,z-\beta c\left(t-T\right)\right)e^{i\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)-\omega T\right)}\cdot\cos\theta\right]dT\\
 & =A\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}}{\sigma^{2}\left(x\right)}}\frac{1}{\omega}c\beta e^{i\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)}\cdot\cos\theta\cdot{\color{gray}\underset{I\left(x,y,z,t\right)}{\underbrace{{\normalcolor \intop_{-\infty}^{t}\left[e^{-\frac{\left(z-\beta c\left(t-T\right)\right)^{2}}{\sigma^{2}\left(x\right)}}\cos\left(\omega T\right)\right]dT}}}}\\
 & =A\frac{w_{0}}{w\left(x\right)}\frac{1}{\omega}c\beta\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}+\psi\left(x\right)\right)\cdot I\left(x,y,z,t\right)\cdot\cos\theta
\end{align*}

\end_inset


\end_layout

\end_inset


\begin_inset Formula 
\begin{equation}
\boldsymbol{A}={\color{gray}\underset{A_{\text{envelope}\left(x,y,z\right)}}{\underbrace{{\normalcolor A\frac{w_{0}}{w\left(x\right)}e^{-\frac{\left(y^{2}+z^{2}\right)}{w^{2}\left(x\right)}}\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)}}}}\cdot\begin{pmatrix}0\\
0\\
\sin\theta\cos\left(\omega t-\varepsilon\right)\\
\cos\theta\cos\left(\omega t\right)
\end{pmatrix}\label{eq:A_envelope}
\end{equation}

\end_inset

Let's make sure that this potential produces the electric field of a gaussian
 beam: differentiate it by time, we get:
\begin_inset Formula 
\[
\boldsymbol{E}=-\frac{\partial}{\partial t}\boldsymbol{A}=
\]

\end_inset


\begin_inset Formula 
\[
\boldsymbol{E}=\omega A\frac{w_{0}}{w\left(x\right)}e^{-\frac{\left(y^{2}+z^{2}\right)}{w^{2}\left(x\right)}}\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot\begin{pmatrix}0\\
\sin\theta\sin\left(\omega t-\varepsilon\right)\\
\cos\theta\sin\left(\omega t\right)
\end{pmatrix}\kaliV
\]

\end_inset


\end_layout

\begin_layout Paragraph
Does it satisfies the gibbs gauge conditions?
\end_layout

\begin_layout Standard
It satisfies the gibbs condition of 
\begin_inset Formula $A_{0}=0$
\end_inset

 by definition.
\end_layout

\begin_layout Standard
And the divergence:
\begin_inset Formula 
\begin{align*}
\nabla\cdot\boldsymbol{A} & =\begin{pmatrix}\frac{\partial}{\partial x}\\
\frac{\partial}{\partial y}\\
\frac{\partial}{\partial z}
\end{pmatrix}\begin{pmatrix}0\\
A\left(y,z\right)\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot\sin\theta\cos\left(\omega t-\varepsilon\right)\\
A\left(y,z\right)\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot\cos\theta\cos\left(\omega t\right)
\end{pmatrix}=\\
 & =\left[\partial_{y}A\left(y,z\right)\right]\cdot\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot\sin\theta\cos\left(\omega t-\varepsilon\right)+\left[\partial_{z}A\left(y,z\right)\right]\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot\cos\theta\cos\left(\omega t\right)\ll\boldsymbol{B}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
we can't say about anything which is not dimensionless that it is close
 to 
\begin_inset Formula $0$
\end_inset

, but we can say that it is much closer to 
\begin_inset Formula $0$
\end_inset

 comparing to another physical value with the same dimensions.
\end_layout

\begin_layout Standard
Since the sizes of the terms are in the order of magnitude of 
\begin_inset Formula $\partial_{y}A\left(y,z\right)$
\end_inset

 which is much smaller then 
\begin_inset Formula ${\color{brown}k_{l}\cdot A\left(y,z\right)}$
\end_inset

 (the derivative with respect to 
\begin_inset Formula $x$
\end_inset

), we get that this divergence is much smaller
\end_layout

\begin_layout Standard
then 
\begin_inset Formula $B$
\end_inset

 (which has the same units), and therefore close to 
\begin_inset Formula $0$
\end_inset

.
 (because 
\begin_inset Formula $B_{z}$
\end_inset

, for example, has the term 
\begin_inset Formula $\partial_{x}A\left(y,z\right)\cdot\cos\ldots={\color{brown}k_{l}A\left(y,z\right)}\sin\ldots$
\end_inset

)
\end_layout

\begin_layout Paragraph
Going back to the main discussion:
\end_layout

\begin_layout Standard
Given this 
\begin_inset Formula $A$
\end_inset

, the 
\begin_inset Formula $G$
\end_inset

 function will be:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
G & \equiv\beta c\intop_{-\infty}^{t}A_{z}\left(\boldsymbol{x}-\beta c\left(t-T\right)\hat{z},T\right)dT\\
 & =\beta c\intop_{-\infty}^{t}\left[{\color{gray}\underset{^{\text{amplitude}}}{\underbrace{{\normalcolor A}}}}\left(x,y,z-\beta c\left(t-T\right)\right)\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot\cos\theta\cos\left(\omega T\right)\right]dT\\
 & =A\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}}{w^{2}\left(x\right)}}\frac{1}{\omega}c\beta\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot\cos\theta\cdot{\color{gray}\underset{I\left(x,y,z,t\right)}{\underbrace{{\normalcolor \intop_{-\infty}^{t}\left[e^{-\frac{\left(z-\beta c\left(t-T\right)\right)^{2}}{w^{2}\left(x\right)}}\cos\left(\omega T\right)\right]dT}}}}\\
\text{Set}: & Z=\beta cT+z-\beta ct\iff T=\frac{Z-z}{\beta c}+t\Rightarrow\frac{1}{\beta c}dZ=dT,T=t\iff Z=z\\
 & =A\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}}{w^{2}\left(x\right)}}\frac{1}{\omega}c\beta\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot\cos\theta\cdot\intop_{-\infty}^{z}\left[e^{-\frac{Z^{2}}{w^{2}\left(x\right)}}\cos\left(\omega\left(\frac{Z-z}{\beta c}+t\right)\right)\right]\frac{1}{\beta c}dZ\\
 & =A\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}}{w^{2}\left(x\right)}}\frac{1}{\omega}c\beta\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot\cos\theta\cdot\intop_{-\infty}^{z}\left[e^{-\frac{Z^{2}}{w^{2}\left(x\right)}}\cos\left(\frac{\omega}{\beta c}Z+t-\frac{z}{\beta c}\right)\right]\frac{1}{\beta c}dZ\\
 & =A\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}}{w^{2}\left(x\right)}}\frac{1}{\omega}c\beta\cos\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot I\left(x,y,z,t\right)\cdot\cos\theta
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
And the gradient (
\series bold
\color red
Make sure the derivative with respect to z is negligible - remember that
 due to the fact that we integrate over z,t(z), there would be also a fast
 oscillating pattern in z
\series default
\color inherit
)
\size small

\begin_inset Formula 
\[
\nabla G\approx\hat{x}\cdot A\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}}{w^{2}\left(x\right)}}\frac{1}{\omega}c\beta\sin\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot I\left(x,y,z,t\right)\cdot\cos\theta\cdot\left(k_{l}+k_{l}\frac{y^{2}+z^{2}}{2}{\color{gray}\underset{\frac{d}{dx}\frac{1}{R\left(x\right)}=\frac{d}{dx}\left(\frac{x}{x^{2}+x_{R}^{2}}\right)}{\underbrace{{\normalcolor \frac{x_{R}^{2}-x^{2}}{\left(x^{2}+x_{R}^{2}\right)^{2}}}}}}+{\color{gray}\underset{\frac{d}{dx}\psi\left(x\right)}{\underbrace{{\normalcolor \frac{\frac{1}{x_{R}}}{1+\left(\frac{x}{x_{R}}\right)^{2}}}}}}\right)
\]

\end_inset


\size default
(Also for a moving wave the result will be the same, as the 
\begin_inset Formula $\cos$
\end_inset

 will be replaced with complex exponent)
\size footnotesize

\begin_inset Formula 
\[
=\hat{x}\cdot A\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}}{w^{2}\left(x\right)}}\cancel{{\color{purple}\frac{1}{\omega}c}}\beta\sin\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot I\left(x,y,z,t\right)\cdot\cos\theta\cdot{\color{gray}\underset{\text{Same but with }\lambda\text{ only and no }k_{l},x_{R}}{\underbrace{{\normalcolor \left(\cancel{{\color{purple}\frac{2\pi}{\lambda}}}+{\color{purple}\cancel{\frac{2\pi}{\lambda}}}\frac{y^{2}+z^{2}}{2}\cdot\frac{\left(\frac{\lambda}{\pi\cdot\left(\kaliNA\right)^{2}}\right)^{2}-x^{2}}{\left(x^{2}+\left(\frac{\lambda}{\pi\cdot\left(\kaliNA\right)^{2}}\right)^{2}\right)^{2}}+\frac{\frac{\cancel{{\color{purple}2\pi}}\cdot\left(\kaliNA\right)^{2}}{2\cancel{{\color{purple}\lambda}}}}{1+\left(\frac{\pi\cdot\left(\kaliNA\right)^{2}}{\lambda}\cdot x\right)^{2}}\right)}}}}
\]

\end_inset


\size default
Recalling that 
\begin_inset Formula $\frac{2\pi}{\lambda}=\frac{1}{\nicefrac{c}{\omega}}$
\end_inset

, we can write:
\size footnotesize

\begin_inset Formula 
\[
=\hat{x}\cdot\beta A\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}}{w^{2}\left(x\right)}}\sin\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot I\left(x,y,z,t\right)\cdot\cos\theta\cdot\left({\color{purple}1}+{\color{purple}1}\cdot{\color{gray}\underset{\text{small correction}}{\underbrace{{\normalcolor \frac{y^{2}+z^{2}}{2\lambda^{2}}}}}}\cdot\frac{\left(\frac{1}{\pi\cdot\left(\kaliNA\right)^{2}}\right)^{2}-\left(\frac{x}{\lambda}\right)^{2}}{\left(\frac{x^{2}}{\lambda^{2}}+\frac{1}{\left(\pi\cdot\left(\kaliNA\right)^{2}\right)^{2}}\right)^{2}}+{\color{gray}\underset{<6\%\text{ for \kaliNA}=0.3}{\underbrace{{\normalcolor \frac{2\left(\kaliNA\right)^{2}}{1+\left(\pi\cdot\left(\kaliNA\right)^{2}\cdot\frac{x}{\lambda}\right)^{2}}}}}}\right)\approx
\]

\end_inset


\size default

\begin_inset Formula 
\[
\approx\hat{x}\cdot\beta A\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}}{w^{2}\left(x\right)}}\sin\left(k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\right)\cdot I\left(x,y,z,t\right)\cdot\cos\theta
\]

\end_inset


\end_layout

\begin_layout Standard
Substituting all in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_18"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 we get:
\begin_inset Formula 
\begin{align*}
\phi\left(x,y\right)\stackrel{\left({\color{blue}\eqref{eq:e_18}}\right)}{=} & -\frac{1}{\hbar}\intop_{z}\frac{e^{2}}{2m\gamma\beta c}\left({\color{gray}\underset{y}{\underbrace{{\normalcolor {\color{red}A_{y}^{2}\left(\boldsymbol{x},t\left(z\right)\right)}}}}}+{\color{gray}\underset{z}{\underbrace{{\normalcolor {\color{blue}\left(1-\beta^{2}\right)A_{z}^{2}\left(\boldsymbol{x},t\left(z\right)\right)}}}}}+{\color{gray}\underset{x}{\underbrace{{\normalcolor {\color{green}\left(\partial_{x}G\left(\boldsymbol{x},t\left(z\right)\right)\right)^{2}}}}}}\right)dz
\end{align*}

\end_inset

defining:
\begin_inset Formula 
\begin{equation}
\varphi\left(x\right)=k_{l}x+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\label{eq:gaussian_beam_phase_def}
\end{equation}

\end_inset

Plugging in the wave of the form 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:A_envelope"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 we get:
\begin_inset Formula 
\begin{align}
\phi\left(x,y\right)=-\frac{e^{2}}{2m\gamma\beta c\hbar}\intop_{z} & \left[{\color{gray}\overset{y}{\overbrace{{\normalcolor {\color{red}\left(A_{\text{envelope}}^{2}\left(x,y,z\right)\cos^{2}\left(\varphi\left(x\right)\right)\cdot\sin^{2}\left(\theta\right)\cos^{2}\left(\omega t\left(z\right)-\varepsilon\right)\right)}}}}}\right.\nonumber \\
 & +{\color{gray}\overset{z}{\overbrace{{\normalcolor {\color{blue}\left(1-\beta^{2}\right)\cdot A_{\text{envelope}}^{2}\left(x,y,z\right)\cos^{2}\left(\varphi\left(x\right)\right)\cdot\cos^{2}\theta\cos^{2}\left(\omega t\left(z\right)\right)}}}}}\nonumber \\
 & +{\color{gray}\underset{x}{\underbrace{{\normalcolor \left.{\color{green}\beta^{2}A_{\text{envelope}}^{2}\left(x,y,z\right)\sin^{2}\left(\varphi\left(x\right)\right)\cdot\cos^{2}\left(\theta\right)\sin^{2}\left(\omega t\left(z\right)\right)}\right]}}}}dz\label{eq:e_100}
\end{align}

\end_inset


\begin_inset Formula 
\begin{align}
=-\frac{e^{2}}{2m\gamma\beta c\hbar}\intop_{z} & A_{\text{envelope}}^{2}\left(x,y,z\right)\left[{\color{red}\left(\cos^{2}\left(\varphi\left(x\right)\right)\cdot\sin^{2}\left(\theta\right)\cos^{2}\left(\omega t\left(z\right)-\varepsilon\right)\right)}\right.\nonumber \\
 & +\cos^{2}\left(\theta\right)\left[\left({\color{blue}\cos^{2}\left(\varphi\left(x\right)\right)\cos^{2}\left(\omega t\left(z\right)\right)}\right)+\beta^{2}\left[-{\color{blue}\cos^{2}\left(\varphi\left(x\right)\right)\cos^{2}\left(\omega t\left(z\right)\right)}+{\color{green}\sin^{2}\left(\varphi\left(x\right)\right)\sin^{2}\left(\omega t\left(z\right)\right)}\right]\right]dz\label{eq:e_101}
\end{align}

\end_inset

The integragtion over 
\begin_inset Formula $\cos^{2}\left(\omega t\left(z\right)\right),\sin^{2}\left(\omega t\left(z\right)\right),\cos^{2}\left(\omega t\left(z\right)-\varepsilon\right)$
\end_inset

 will just add a 
\color brown
half
\color inherit
 factor and we get:
\begin_inset Formula 
\begin{align}
=-\frac{e^{2}}{2m\gamma\beta c\hbar}\intop_{z} & {\color{brown}\frac{1}{2}}A_{\text{envelope}}^{2}\left(x,y,z\right)\left[{\color{red}\left(\cos^{2}\left(\varphi\left(x\right)\right)\cdot\sin^{2}\left(\theta\right)\right)}\right.\nonumber \\
 & +\cos^{2}\left(\theta\right)\left[\left({\color{blue}\cos^{2}\left(\varphi\left(x\right)\right)}\right)+\beta^{2}\left[-{\color{blue}\cos^{2}\left(\varphi\left(x\right)\right)}+{\color{green}\sin^{2}\left(\varphi\left(x\right)\right)}\right]\right]dz\label{eq:e_102}
\end{align}

\end_inset

The red and the first blue parts are simply 
\begin_inset Formula $\cos^{2}\left(\varphi\left(x\right)\right)$
\end_inset

 (because it is 
\begin_inset Formula $\sin^{2}\left(\theta\right)+\cos^{2}\left(\theta\right)$
\end_inset

, and the second blue part and the green part will be 
\begin_inset Formula $-{\color{blue}\cos^{2}\left(\varphi\left(x\right)\right)}+{\color{green}\sin^{2}\left(\varphi\left(x\right)\right)}=-\cos\left(2\varphi\left(x\right)\right)$
\end_inset

):
\begin_inset Formula 
\begin{equation}
=-\frac{e^{2}}{{\color{brown}4}m\gamma\beta c\hbar}\intop_{z}A_{\text{envelope}}^{2}\left(x,y,z\right)\left[{\color{red}\left(\cos^{2}\left(\varphi\left(x\right)\right)\right)}-\cos^{2}\left(\theta\right)\beta^{2}\cos\left(2\varphi\left(x\right)\right)\right]dz\label{eq:e_103}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
=-\frac{e^{2}}{{\color{brown}4}m\gamma\beta c\hbar}\intop_{z}A_{\text{envelope}}^{2}\left(x,y,z\right)\left[{\color{red}\frac{1}{2}+\frac{1}{2}\cos\left(2\varphi\left(x\right)\right)}-\cos^{2}\left(\theta\right)\beta^{2}\cos\left(2\varphi\left(x\right)\right)\right]dz\label{eq:e_104}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
=-\frac{e^{2}}{4m\gamma\beta c\hbar}\intop_{z}A_{\text{envelope}}^{2}\left(x,y,z\right){\color{red}\frac{1}{2}}\left[{\color{red}1}+\left({\color{red}1}-2\cos^{2}\left(\theta\right)\beta^{2}\right)\cos\left(2\varphi\left(x\right)\right)\right]dz\label{eq:ponderomotive_integral_final_result_standing_wave}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
If we ignore the fact that 
\begin_inset Formula $\varphi\left(x\right)$
\end_inset

 is 
\begin_inset Formula $z$
\end_inset

-dependent due to the curvature term, we can write:
\begin_inset Formula 
\begin{align*}
\phi & =-{\color{gray}\overset{\phi_{0}\left(x,y\right)}{\overbrace{{\normalcolor \frac{e^{2}}{4m\gamma\beta c\hbar}\intop_{z}A_{\text{envelope}}^{2}\left(x,y,z\right)dz}}}}\cdot\frac{1}{2}\biggl[1+{\color{gray}\overset{\rho\left(\theta,\beta\right)}{\overbrace{{\normalcolor \left(1-2\cos^{2}\left(\theta\right)\beta^{2}\right)}}}}\cos\left(2\varphi\left(x\right)\right)\biggr]\\
 & =-\phi_{0}\left(x,y\right)\cdot\frac{1}{2}\left[1+\rho\left(\theta,\beta\right)\cos\left(2\varphi\left(x\right)\right)\right]
\end{align*}

\end_inset

Where we defined:
\begin_inset Formula 
\begin{align}
\phi_{0} & =\frac{e^{2}}{4m\gamma\beta c\hbar}\intop_{z}A_{\text{envelope}}^{2}\left(x,y,z\right)dz\label{eq:phi_0_def}\\
\rho\left(\theta,\beta\right) & =1-2\cos^{2}\left(\theta\right)\beta^{2}\label{eq:rho_def}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
And for a moving wave (that does not have the 
\begin_inset Formula $\cos\left(\varphi\left(x\right)\right)$
\end_inset

 grating in it, but only the slowly varying envelope):
\begin_inset Formula 
\begin{align}
\phi_{\text{running wave}}\left(x,y\right)\stackrel{\left({\color{blue}\eqref{eq:e_18}}\right)}{=} & -\frac{1}{\hbar}\intop_{z}\frac{e^{2}}{2m\gamma\beta c}\left({\color{red}A_{y}^{2}\left(\boldsymbol{x},t\left(z\right)\right)}+{\color{blue}\left(1-\beta^{2}\right)A_{z}^{2}\left(\boldsymbol{x},t\left(z\right)\right)}+{\color{green}\left(\partial_{x}G\left(\boldsymbol{x},t\left(z\right)\right)\right)^{2}}\right)dz\nonumber \\
= & -\frac{1}{\hbar}\intop_{z}\frac{e^{2}A_{\text{envelope}}^{2}\left(x,y,z\right)}{2m\gamma\beta c}\left({\color{red}\sin^{2}\theta\cancel{\cos^{2}\left(\omega t\left(z\right)-\varepsilon\right)}}+{\color{blue}\left(1-\beta^{2}\right)\cdot\left(\cdot\cos\theta\cancel{\cos\left(\omega t\left(z\right)\right)}\right)^{2}}+{\color{green}\left(\beta^{2}\cos^{2}\left(\theta\right)\cancel{\sin^{2}\left(\omega t\left(z\right)\right)}\right)}\right)dz\nonumber \\
= & -\frac{1}{\hbar}\intop_{z}\frac{e^{2}A_{\text{envelope}}^{2}\left(x,y,z\right)}{4m\gamma\beta c}\left({\color{gray}\underset{=1}{\underbrace{{\normalcolor {\color{red}\sin^{2}\left(\theta\right)}+{\color{blue}\cos^{2}\left(\theta\right)}}}}}-\cancel{{\color{blue}\beta^{2}\cos^{2}\left(\theta\right)}+{\color{green}\left(\beta^{2}\cdot\cos^{2}\left(\theta\right)\right)}}\right)dz\nonumber \\
= & -\frac{1}{\hbar}\intop_{z}\frac{e^{2}A_{\text{envelope}}^{2}\left(x,y,z\right)}{4m\gamma\beta c}dz\label{eq:ponderomotive_integral_final_result_moving_wave}
\end{align}

\end_inset


\begin_inset Formula 
\[
\phi_{\text{running wave}}=-\phi_{0}\left(x,y\right)
\]

\end_inset


\end_layout

\begin_layout Section
Interaction with an oscillating laser
\begin_inset CommandInset label
LatexCommand label
name "sec:Interaction with an oscillating laser"

\end_inset


\end_layout

\begin_layout Standard
Let us review the case where the intensity of 
\begin_inset Formula $A^{2}$
\end_inset

 oscillates as a function of time.
 since we are going to deal with the case of exactly two monochromatic laser
 beams, we can already now denote the oscillations frequency as 
\begin_inset Formula $\Delta\omega$
\end_inset

.
\end_layout

\begin_layout Standard
Since the laser intensity is oscillating 
\begin_inset Formula $\phi\left(x,y,t\right)$
\end_inset

 will have the form 
\begin_inset Formula 
\begin{equation}
\phi\left(x,y,t\right)=\phi_{\text{const}}\left(x,y\right)+C\cos\left(\Delta\omega t\right)\label{eq:oscillating_phase_shift}
\end{equation}

\end_inset

Therefore, the output wave as a function of frequency will look like so:
\begin_inset Formula 
\[
\psi_{\text{output}}=\psi_{\text{input}}\cdot e^{i\phi\left(x,y,t\right)}=\psi_{\text{input}}\cdot e^{i\phi_{\text{const}}\left(x,y\right)+C\cos\left(\Delta\omega t\right)}=\psi_{\text{input}}\cdot e^{i\phi_{\text{const}}\left(x,y\right)}\cdot\sum_{q\in\kaliInteger}J_{q}\left(C\right)\cdot e^{iq\Delta\omega t}
\]

\end_inset

Adding an energy filter to filter out all the frequencies that are not the
 
\begin_inset Formula $q=0$
\end_inset

 frequency, we get:
\begin_inset Formula 
\begin{align}
\psi_{\text{output of energy filter}} & =\psi_{\text{input}}\cdot e^{i\phi_{\text{const}}\left(x,y\right)}\cdot J_{0}\left(C\right)+{\color{gray}\underset{\text{Filtered out}}{\underbrace{{\normalcolor \cancel{{\color{gray}\sum_{q\in\kaliInteger\setminus\left\{ 1\right\} }J_{q}\left(C\right)\cdot e^{iq\Delta\omega t}}}}}}}\nonumber \\
 & =\psi_{\text{input}}\cdot e^{i\phi_{\text{const}}\left(x,y\right)}\cdot J_{0}\left(C\right)\label{eq:after_energy_filter_general}
\end{align}

\end_inset

In practice, in the electron microscope, the energy filter does not sit
 in the focal plane but rather further down the microscope, but we can considere
d the filtered electrons as if as they were filtered on spot in the focal
 plane.
\end_layout

\begin_layout Section
Calculate the envelope 
\begin_inset Formula $A_{\text{envelope}}\left(x,y,z\right)$
\end_inset

 for two gaussian beams in the moving frame: 
\begin_inset CommandInset label
LatexCommand label
name "sec:Field Derivations"

\end_inset


\end_layout

\begin_layout Subsection
Introduction
\end_layout

\begin_layout Standard
In the focal plane of the microscope we set a cavity there are two lasers
 with two different frequencies.
 This cavity is designed to interact with the passing electron through the
 ponderomotive potential.
\end_layout

\begin_layout Standard
There exists a moving reference frame where the blue-shifted red frequency
 and the red-shifted blue frequency become the same frequency.
 as we will see the problem is easier to describe in the reference frame.
 Here we will show how to find the amplitudes, the frequency, and the intensity
 in this frame, and this will later be used in the next section where we
 describe it's effect on the electrons.
\end_layout

\begin_layout Subsection
Lorentz transform the field
\end_layout

\begin_layout Standard
Let's assume the laser propagates in the 
\begin_inset Formula $\hat{x}$
\end_inset

 direction.
\end_layout

\begin_layout Standard
The original electric and magnetic fields are:
\begin_inset Formula 
\[
\boldsymbol{E}\left(\boldsymbol{x},t\right)=\left[E_{1}e^{i\left(\omega_{1}t-\frac{\omega_{1}}{c}x\right)}+E_{1}e^{i\left(\omega_{1}t+\frac{\omega_{1}}{c}x\right)}+E_{2}e^{i\left(\omega_{2}t-\frac{\omega_{2}}{c}x\right)}+E_{2}e^{i\left(\omega_{2}t+\frac{\omega_{2}}{c}x\right)}\right]\begin{pmatrix}0\\
\cos\left(\theta\right)\\
\sin\left(\theta\right)
\end{pmatrix}
\]

\end_inset

The 
\begin_inset Formula $\boldsymbol{B}$
\end_inset

 vector depends on the direction of propagation:
\begin_inset Formula 
\begin{align*}
\boldsymbol{B}\left(\boldsymbol{x},t\right) & =\frac{1}{c}{\color{gray}\overset{=\hat{\pm x}}{\overbrace{{\normalcolor \hat{k}}}}}\times{\color{gray}\overset{\boldsymbol{E}}{\overbrace{{\normalcolor \left[E_{1}e^{i\left(\omega_{1}t-\frac{\omega_{1}}{c}x\right)}+E_{1}e^{i\left(\omega_{1}t+\frac{\omega_{1}}{c}x\right)}+E_{2}e^{i\left(\omega_{2}t-\frac{\omega_{2}}{c}x\right)}+E_{2}e^{i\left(\omega_{2}t+\frac{\omega_{2}}{c}x\right)}\right]\begin{pmatrix}0\\
\cos\left(\theta\right)\\
\sin\left(\theta\right)
\end{pmatrix}}}}}=\\
 & =\pm\frac{1}{c}\left[E_{1}e^{i\left(\omega_{1}t-\frac{\omega_{1}}{c}x\right)}+E_{1}e^{i\left(\omega_{1}t+\frac{\omega_{1}}{c}x\right)}+E_{2}e^{i\left(\omega_{2}t-\frac{\omega_{2}}{c}x\right)}+E_{2}e^{i\left(\omega_{2}t+\frac{\omega_{2}}{c}x\right)}\right]\begin{pmatrix}0\\
-\sin\theta\\
\cos\theta
\end{pmatrix}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
The field at point 
\begin_inset Formula $\boldsymbol{E}^{\prime}\left(\boldsymbol{x}^{\prime},t^{\prime}\right)$
\end_inset

 will be:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\boldsymbol{E}^{\prime}\left(\boldsymbol{x}^{\prime},t^{\prime}\right) & =\begin{pmatrix}E_{x}^{\prime}\\
E_{y}^{\prime}\\
E_{z}^{\prime}
\end{pmatrix}\left(\boldsymbol{x}^{\prime},ct^{\prime}\right)\\
 & =\begin{pmatrix}\cancel{E_{x}}\\
\gamma\left(E_{y}-vB_{z}\right)\\
\gamma\left(E_{z}+vB_{y}\right)
\end{pmatrix}\left(\Lambda^{-1}\left(\boldsymbol{x}^{\prime},ct^{\prime}\right)\right)
\end{align*}

\end_inset

and for a general linear polarization orientation (in lab's frame) 
\begin_inset Formula $\boldsymbol{E}\left(x,y\right)=E_{0}\left(x,y\right)\begin{pmatrix}0\\
\cos\theta\\
\sin\theta
\end{pmatrix},\boldsymbol{B}\left(x,y\right)=\pm\frac{E_{0}\left(x,y\right)}{c}\begin{pmatrix}0\\
-\sin\theta\\
\cos\theta
\end{pmatrix}$
\end_inset

 (the 
\begin_inset Formula $+$
\end_inset

 sign is for a wave propagating in the 
\begin_inset Formula $+\hat{x}$
\end_inset

 direction and the 
\begin_inset Formula $-$
\end_inset

 sign is for a field propagating in the 
\begin_inset Formula $-\hat{x}$
\end_inset

 direction) we get:
\begin_inset Formula 
\begin{align*}
\boldsymbol{E}^{\prime}\left(\boldsymbol{x}^{\prime},t^{\prime}\right) & =\begin{pmatrix}0\\
\gamma\left({\color{gray}\overset{E_{y}}{\overbrace{{\normalcolor E_{0}\left(\Lambda^{-1}\left(\boldsymbol{x}^{\prime},ct^{\prime}\right)\right)\cos\theta}}}}{\color{gray}\overset{-B_{z}}{\overbrace{{\normalcolor \mp v\frac{E_{0}\left(\Lambda^{-1}\left(\boldsymbol{x}^{\prime},ct^{\prime}\right)\right)\cos\left(\theta\right)}{c}}}}}\right)\\
\gamma\left({\color{gray}\underset{E_{z}}{\underbrace{{\normalcolor E_{0}\left(\Lambda^{-1}\left(\boldsymbol{x}^{\prime},ct^{\prime}\right)\right)\sin\theta}}}}{\color{gray}\underset{+B_{y}}{\underbrace{{\normalcolor \mp v\frac{E_{0}\left(\Lambda^{-1}\left(\boldsymbol{x}^{\prime},ct^{\prime}\right)\right)\sin\left(\theta\right)}{c}}}}}\right)
\end{pmatrix}\\
 & =\begin{pmatrix}0\\
\cos\theta\gamma\left(1\mp\frac{v}{c}\right)\\
\sin\theta\gamma\left(1\mp\frac{v}{c}\right)
\end{pmatrix}E_{0}\left(\Lambda^{-1}\left(\boldsymbol{x}^{\prime},ct^{\prime}\right)\right)\\
 & =\begin{pmatrix}0\\
\cos\theta\\
\sin\theta
\end{pmatrix}\gamma\left(1\mp\frac{v}{c}\right)E_{0}\left(\Lambda^{-1}\left(\boldsymbol{x}^{\prime},ct^{\prime}\right)\right)
\end{align*}

\end_inset

Denote:
\begin_inset Formula 
\begin{equation}
\gamma\left(1\mp\beta\right)=\frac{\left(1\mp\beta\right)}{\sqrt{1-\beta^{2}}}=\frac{\left(1\mp\beta\right)}{\sqrt{\left(1-\beta\right)\left(1+\beta\right)}}=\sqrt{\frac{1\mp\beta}{1\pm\beta}}\equiv\Gamma_{\mp}\label{eq:capital_gamma_def}
\end{equation}

\end_inset

And get:
\begin_inset Formula 
\begin{align*}
\boldsymbol{E}^{\prime}\left(\boldsymbol{x}^{\prime},t^{\prime}\right) & =\Gamma_{\mp}{\color{gray}\underset{\text{Scalar}}{\underbrace{{\normalcolor E_{0}\left(\Lambda^{-1}\left(\boldsymbol{x}^{\prime},ct^{\prime}\right)\right)}}}}\begin{pmatrix}0\\
\cos\theta\\
\sin\theta
\end{pmatrix}
\end{align*}

\end_inset

Looking at a coordinate 
\begin_inset Formula $\left(\boldsymbol{x}^{\prime},t^{\prime}\right)$
\end_inset

, the corresponding space-time point will be:
\begin_inset Formula 
\[
\begin{pmatrix}x\\
y\\
z\\
t
\end{pmatrix}=\Lambda^{-1}\begin{pmatrix}x^{\prime}\\
y^{\prime}\\
z^{\prime}\\
t^{\prime}
\end{pmatrix}=\begin{pmatrix}\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\\
y\\
z\\
\gamma\left(t^{\prime}+\frac{\beta x^{\prime}}{c}\right)
\end{pmatrix}
\]

\end_inset


\begin_inset Formula 
\[
\boldsymbol{E}^{\prime}\left(\boldsymbol{x}^{\prime},t^{\prime}\right)=\Gamma_{\mp}\boldsymbol{E}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right),0,0,\gamma\left(t+\frac{\beta x^{\prime}}{c}\right)\right)
\]

\end_inset


\end_layout

\begin_layout Standard
And get, after substituting for the relevant waves (before substituting
 
\begin_inset Formula $x\rightarrow\gamma\left(x^{\prime}+\beta ct^{\prime}\right)$
\end_inset

 and 
\begin_inset Formula $t\rightarrow\gamma\left(t+\frac{\beta x^{\prime}}{c}\right)$
\end_inset

):
\begin_inset Formula 
\begin{equation}
=\left[\Gamma_{-}E_{1}e^{i\left(\omega_{1}t-\frac{\omega_{1}}{c}x\right)}+\Gamma_{+}E_{1}e^{i\left(\omega_{1}t+\frac{\omega_{1}}{c}x\right)}+\Gamma_{-}E_{2}e^{i\left(\omega_{2}t-\frac{\omega_{2}}{c}x\right)}+E_{2}\Gamma_{+}e^{i\left(\omega_{2}t+\frac{\omega_{2}}{c}x\right)}\right]_{\left(x,t\right)=\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right),\gamma\left(t^{\prime}+\frac{\beta x^{\prime}}{c}\right)\right)}\label{eq:e_5}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Performing the coordinates substitution, the argument in the exponent changes
 like
\begin_inset Formula 
\begin{align*}
\omega_{i}t\mp\frac{\omega_{i}}{c}x & \rightarrow\omega_{i}\gamma\left(t^{\prime}+\frac{\beta x^{\prime}}{c}\right)\mp\frac{\omega_{i}}{c}\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\\
 & =\omega_{i}\gamma t^{\prime}+\omega_{i}\gamma\frac{\beta x^{\prime}}{c}\mp\frac{\omega_{i}}{c}\gamma x^{\prime}\mp\frac{\omega_{i}}{\cancel{c}}\gamma\beta\cancel{c}t^{\prime}\\
 & =\omega_{i}\left(1\mp\beta\right)\gamma t^{\prime}\mp\left(1\mp\beta\right)\gamma\frac{\omega_{i}}{c}x^{\prime}\\
 & =\sqrt{\frac{1\mp\beta}{1\pm\beta}}\omega_{i}t^{\prime}\mp\sqrt{\frac{1\mp\beta}{1\pm\beta}}\frac{\omega_{i}}{c}x^{\prime}\\
 & =\Gamma_{\mp}\omega_{i}t^{\prime}\mp\Gamma_{\mp}\frac{\omega_{i}}{c}x^{\prime}\\
 & =\Gamma_{\mp}\left(\omega_{i}t^{\prime}\mp\frac{\omega_{i}}{c}x^{\prime}\right)
\end{align*}

\end_inset


\end_layout

\begin_layout Standard

\color gray
And if it is not a plane wave but a gaussian beam with also gouy phase
\begin_inset Formula 
\begin{align}
\omega_{i}t\mp\frac{\omega_{i}}{c}x\mp k_{i}\frac{y^{2}+z^{2}}{R\left(x\right)}\pm\psi_{i}\left(x\right) & \rightarrow\omega_{i}\gamma\left(t^{\prime}+\frac{\beta x^{\prime}}{c}\right)\mp\frac{\omega_{i}}{c}\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\mp k_{i}\frac{y^{\prime2}+z^{\prime2}}{R_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)}\pm\psi_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)\nonumber \\
 & =\omega_{i}\gamma t^{\prime}+\omega_{i}\gamma\frac{\beta x^{\prime}}{c}\mp\frac{\omega_{i}}{c}\gamma x^{\prime}\mp\frac{\omega_{i}}{\cancel{c}}\gamma\beta\cancel{c}t^{\prime}\mp k_{i}\frac{y^{\prime2}+z^{\prime2}}{R_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)}\pm\psi_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)\nonumber \\
 & =\omega_{i}\left(1\mp\beta\right)\gamma t^{\prime}\mp\left(1\mp\beta\right)\gamma\frac{\omega_{i}}{c}x^{\prime}\mp k_{i}\frac{y^{\prime2}+z^{\prime2}}{R_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)}\pm\psi_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)\nonumber \\
 & =\sqrt{\frac{1\mp\beta}{1\pm\beta}}\omega_{i}t^{\prime}\mp\sqrt{\frac{1\mp\beta}{1\pm\beta}}\frac{\omega_{i}}{c}x^{\prime}\mp k_{i}\frac{y^{\prime2}+z^{\prime2}}{R_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)}\pm\psi_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)\nonumber \\
 & =\Gamma_{\mp}\omega_{i}t^{\prime}\mp\Gamma_{\mp}\frac{\omega_{i}}{c}x^{\prime}\mp k_{i}\frac{y^{\prime2}+z^{\prime2}}{R_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)}\pm\psi_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)\nonumber \\
 & =\Gamma_{\mp}\left(\omega_{i}t^{\prime}\mp\frac{\omega_{i}}{c}x^{\prime}\right)\mp{\color{gray}\underset{\Psi_{i}\left(\gamma\left(x^{\prime}+\beta ct\right),y,z\right)}{\underbrace{k_{i}\frac{y^{\prime2}+z^{\prime2}}{R_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)}\pm\psi_{i}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)}}}\label{eq:gouy_phase_lorentz_transform}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
Plugging it into the wave 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_5"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
, we get:
\begin_inset Formula 
\[
E_{y}\left(\boldsymbol{x}^{\prime},t^{\prime}\right)=\Gamma_{-}E_{1}e^{i\Gamma_{-}\left(\omega_{1}t^{\prime}-\frac{\omega_{1}}{c}x^{\prime}\right)}+\Gamma_{+}E_{1}e^{\Gamma_{+}i\left(\omega_{1}t^{\prime}+\frac{\omega_{1}}{c}x^{\prime}\right)}+\Gamma_{-}E_{2}e^{\Gamma_{-}i\left(\omega_{2}t^{\prime}-\frac{\omega_{2}}{c}x^{\prime}\right)}+\Gamma_{+}E_{2}e^{\Gamma_{+}i\left(\omega_{2}t^{\prime}+\frac{\omega_{2}}{c}x^{\prime}\right)}
\]

\end_inset


\color gray

\begin_inset Formula 
\begin{align*}
E_{y}\left(\boldsymbol{x}^{\prime},t^{\prime}\right) & =\Gamma_{-}E_{1}e^{i\Gamma_{-}\left(\omega_{1}t^{\prime}-\frac{\omega_{1}}{c}x^{\prime}\right)-\Psi_{1}\left(\gamma\left(x^{\prime}+\beta ct\right),y,z\right)}+\Gamma_{+}E_{1}e^{\Gamma_{+}i\left(\omega_{1}t^{\prime}+\frac{\omega_{1}}{c}x^{\prime}\right)+\Psi_{1}\left(\gamma\left(x^{\prime}+\beta ct\right),y,z\right)}\\
 & +\Gamma_{-}E_{2}e^{\Gamma_{-}i\left(\omega_{2}t^{\prime}-\frac{\omega_{2}}{c}x^{\prime}\right)-\Psi_{2}\left(\gamma\left(x^{\prime}+\beta ct\right),y,z\right)}+\Gamma_{+}E_{2}e^{\Gamma_{+}i\left(\omega_{2}t^{\prime}+\frac{\omega_{2}}{c}x^{\prime}\right)+\Psi_{2}\left(\gamma\left(x^{\prime}+\beta ct\right),y,z\right)}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard

\color gray
And so we see that if in one reference frame the gouy phases of the two
 laser will not match - then in no reference frame they will not match.
 this is reasonable because phase is Lorentz invariant.
\end_layout

\begin_layout Subsection
Find the 
\begin_inset Formula $\beta_{\text{lattice}},E_{1},E_{2}$
\end_inset

 such that we have a standing wave 
\begin_inset CommandInset label
LatexCommand label
name "subsec:beta for standing wave"

\end_inset

:
\end_layout

\begin_layout Remark
In this subsection 
\begin_inset Formula $\beta_{\text{lattice}}$
\end_inset

 and 
\begin_inset Formula $\beta$
\end_inset

 represent both the velocity of the moving frame in which the blue-shifted
 red beam and the red-shifted blue beam have the same frequency and not
 the velocity of the electron.
\end_layout

\begin_layout Standard
Choose 
\begin_inset Formula $\beta_{\text{lattice}}$
\end_inset

 such that 
\begin_inset Formula 
\[
\Gamma_{+}\omega_{1}=\Gamma_{-}\omega_{2}{\color{lightgray}\ \backslash:\Gamma_{+}\omega_{2}}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\frac{\omega_{1}}{\omega_{2}}=\frac{\Gamma_{-}}{\Gamma_{+}}{\color{lightgray}\ \backslash\text{Substitute }\Gamma_{\pm}}\label{eq:e_6}
\end{equation}

\end_inset


\begin_inset Formula 
\[
\frac{\omega_{1}}{\omega_{2}}=\frac{\sqrt{\frac{1-\beta}{1+\beta}}}{\sqrt{\frac{1+\beta}{1-\beta}}}=\frac{1-\beta}{1+\beta}{\color{lightgray}\ \backslash\left(1+\beta\right)}
\]

\end_inset


\begin_inset Formula 
\[
\frac{\omega_{1}}{\omega_{2}}\left(1+\beta\right)=1-\beta{\color{lightgray}\ \backslash+\beta-\frac{\omega_{1}}{\omega_{2}}}
\]

\end_inset


\begin_inset Formula 
\[
\frac{\omega_{1}}{\omega_{2}}\beta+\beta=1-\frac{\omega_{1}}{\omega_{2}}
\]

\end_inset


\begin_inset Formula 
\[
\left(1+\frac{\omega_{1}}{\omega_{2}}\right)\beta=1-\frac{\omega_{1}}{\omega_{2}}{\color{lightgray}\ \backslash:\left(1+\frac{\omega_{1}}{\omega_{2}}\right)}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\boxed{\beta_{\text{lattice}}=\frac{1-\frac{\omega_{1}}{\omega_{2}}}{1+\frac{\omega_{1}}{\omega_{2}}}=\frac{1-\frac{\lambda_{2}}{\lambda_{1}}}{1+\frac{\lambda_{2}}{\lambda_{1}}}=\frac{\lambda_{1}-\lambda_{2}}{\lambda_{1}+\lambda_{2}}}\label{eq:beta_lattice}
\end{equation}

\end_inset

Under 
\begin_inset Formula $\beta_{\text{lattice}}$
\end_inset

, we can denote:
\begin_inset Formula 
\begin{align}
\Gamma_{+}\omega_{1} & =\Gamma_{-}\omega_{2}\equiv\omega\nonumber \\
\Gamma_{-}\omega_{1} & \equiv\omega_{-}\nonumber \\
\Gamma_{+}\omega_{2} & \equiv\omega_{+}\label{eq:omega_def}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
And get:
\begin_inset Formula 
\begin{equation}
E_{y}\left(\boldsymbol{x}^{\prime},t^{\prime}\right)=\Gamma_{-}E_{1}e^{i\left(\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x\right)}+{\color{teal}\Gamma_{+}E_{1}}e^{i\left(\omega t^{\prime}+\frac{\omega}{c}x\right)}+{\color{teal}\Gamma_{-}E_{2}}e^{i\left(\omega t^{\prime}-\frac{\omega}{c}x\right)}+\Gamma_{+}E_{2}e^{i\left(\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x\right)}\label{eq:e_7}
\end{equation}

\end_inset

Choosing equal amplitudes::
\begin_inset Formula 
\[
{\color{teal}\Gamma_{+}E_{1}}={\color{teal}\Gamma_{-}E_{2}}{\color{lightgray}\ \backslash:\Gamma_{+}E_{2}}
\]

\end_inset


\begin_inset Formula 
\[
\frac{E_{1}}{E_{2}}=\frac{\Gamma_{-}}{\Gamma_{+}}=\frac{1-\beta}{1+\beta}\stackrel{{\color{blue}\eqref{eq:e_6}}}{=}\frac{\omega_{1}}{\omega_{2}}=
\]

\end_inset


\begin_inset Formula 
\[
\frac{E_{1}}{E_{2}}=\frac{\omega_{1}}{\omega_{2}}=\frac{\lambda_{2}}{\lambda_{1}}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\boxed{E_{2}=E_{1}\cdot\frac{\lambda_{1}}{\lambda_{2}}}\tag{Amplitudes Ratio}\label{eq:E_ratio}
\end{equation}

\end_inset

And for the intensity and the power:
\begin_inset Formula 
\[
P_{2}\propto I_{2}=I_{1}\cdot\left(\frac{\lambda_{1}}{\lambda_{2}}\right)^{2}
\]

\end_inset


\end_layout

\begin_layout Standard
Denoting 
\begin_inset Formula 
\begin{equation}
\Gamma_{+}E_{1}=\Gamma_{-}E_{2}={\color{teal}E_{0}}\label{eq:E_0_def}
\end{equation}

\end_inset

and substituting again in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_7"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
, we get:
\begin_inset Formula 
\begin{align}
E_{y}\left(\boldsymbol{x}^{\prime},t^{\prime}\right) & =\frac{\Gamma_{-}}{\Gamma_{+}}{\color{teal}E_{0}}e^{i\left(\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}\right)}+{\color{teal}E_{0}}e^{i\left(\omega t^{\prime}+\frac{\omega}{c}x^{\prime}\right)}+{\color{teal}E_{0}}e^{i\left(\omega t^{\prime}-\frac{\omega}{c}x^{\prime}\right)}+\frac{\Gamma_{+}}{\Gamma_{-}}{\color{teal}E_{0}}e^{i\left(\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}\right)}\nonumber \\
 & ={\color{teal}E_{0}}\left[\frac{\Gamma_{-}}{\Gamma_{+}}e^{i\left(\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}\right)}+e^{i\omega t^{\prime}}\left[e^{i\frac{\omega}{c}x^{\prime}}+e^{-i\frac{\omega}{c}x^{\prime}}\right]+\frac{\Gamma_{+}}{\Gamma_{-}}e^{i\left(\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}\right)}\right]\nonumber \\
 & ={\color{teal}E_{0}}\left[\frac{\Gamma_{-}}{\Gamma_{+}}e^{i\left(\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}\right)}+2e^{i\omega t^{\prime}}\cos\left(\frac{\omega}{c}x^{\prime}\right)+\frac{\Gamma_{+}}{\Gamma_{-}}e^{i\left(\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}\right)}\right]\label{eq:wave_in_moving_frame}
\end{align}

\end_inset

And if instead of a plane wave we had also the other factors of a gaussian
 beam 
\begin_inset Formula $\varphi\left(x\right)=kx+k\frac{y^{2}+z^{2}}{R\left(x\right)}-\psi\left(x\right)$
\end_inset

 then according to 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gouy_phase_lorentz_transform"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 we would have here:
\begin_inset Formula 
\[
E_{y,\text{gaussian beam}}={\color{teal}E_{0}}\left[\frac{\Gamma_{-}}{\Gamma_{+}}e^{i\left(\omega_{-}t^{\prime}+\varphi_{-}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)\right)}+2e^{i\omega t^{\prime}}\cos\left(\varphi\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)\right)+\frac{\Gamma_{+}}{\Gamma_{-}}e^{i\left(\omega_{+}t^{\prime}+\varphi_{+}\left(\gamma\left(x^{\prime}+\beta ct^{\prime}\right)\right)\right)}\right]
\]

\end_inset


\end_layout

\begin_layout Subsection
Calculate the resulted intensity of the field
\end_layout

\begin_layout Standard
And the intensity:
\begin_inset Formula 
\begin{align*}
E^{2}\left(\boldsymbol{x}^{\prime},t^{\prime}\right) & ={\color{teal}E_{0}^{2}}\left|{\color{red}\frac{\Gamma_{-}}{\Gamma_{+}}e^{i\left(\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}\right)}}+{\color{green}2e^{i\omega t^{\prime}}\cos\left(\frac{\omega}{c}x^{\prime}\right)}+{\color{blue}\frac{\Gamma_{+}}{\Gamma_{-}}e^{i\left(\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}\right)}}\right|^{2}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
={\color{teal}E_{0}^{2}}\cdot & \left[{\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}+{\color{green}4\cos^{2}\left(\frac{\omega}{c}x^{\prime}\right)}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}+{\color{red}\cancel{\frac{\Gamma_{-}}{\Gamma_{+}}}e^{-i\left(\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}\right)}}{\color{blue}\cancel{\frac{\Gamma_{+}}{\Gamma_{-}}}e^{i\left(\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}\right)}}+{\color{red}\cancel{\frac{\Gamma_{-}}{\Gamma_{+}}}e^{i\left(\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}\right)}}{\color{blue}\cancel{\frac{\Gamma_{+}}{\Gamma_{-}}}e^{-i\left(\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}\right)}}+\right.\\
+ & {\color{red}\frac{\Gamma_{-}}{\Gamma_{+}}e^{-i\left(\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}\right)}}{\color{green}2e^{i\omega t^{\prime}}\cos\left(\frac{\omega}{c}x^{\prime}\right)}+{\color{red}\frac{\Gamma_{-}}{\Gamma_{+}}e^{i\left(\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}\right)}}{\color{green}2e^{-i\omega t^{\prime}}\cos\left(\frac{\omega}{c}x^{\prime}\right)}\\
+ & \left.{\color{blue}\frac{\Gamma_{+}}{\Gamma_{-}}e^{-i\left(\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}\right)}}{\color{green}2e^{i\omega t^{\prime}}\cos\left(\frac{\omega}{c}x^{\prime}\right)}+{\color{blue}\frac{\Gamma_{+}}{\Gamma_{-}}e^{i\left(\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}\right)}}{\color{green}2e^{-i\omega t^{\prime}}\cos\left(\frac{\omega}{c}x^{\prime}\right)}\right]
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
={\color{teal}E_{0}^{2}} & \left[{\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}+{\color{green}4\cos^{2}\left(\frac{\omega}{c}x^{\prime}\right)}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}+e^{i\left({\color{red}-\omega_{-}t^{\prime}+\frac{\omega_{-}}{c}x^{\prime}}+{\color{blue}\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}}\right)}+e^{-i\left({\color{red}-\omega_{-}t^{\prime}+\frac{\omega_{-}}{c}x^{\prime}}+{\color{blue}\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}}\right)}+\right.\\
+2 & \frac{\Gamma_{-}}{\Gamma_{+}}\left(e^{-i\left({\color{red}\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}}-{\color{green}\omega t^{\prime}}\right)}+e^{i\left({\color{red}\omega_{-}t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}}-{\color{green}\omega t^{\prime}}\right)}\right)\cos\left(\frac{\omega}{c}x^{\prime}\right)\\
+ & \left.2\frac{\Gamma_{+}}{\Gamma_{-}}\left(e^{-i\left({\color{blue}\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}}-{\color{green}\omega t^{\prime}}\right)}+e^{i\left({\color{blue}\omega_{+}t^{\prime}+\frac{\omega_{+}}{c}x^{\prime}}-{\color{green}\omega t^{\prime}}\right)}\right)\cos\left(\frac{\omega}{c}x^{\prime}\right)\right]
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
={\color{teal}E_{0}^{2}} & \left[{\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}+{\color{green}4\cos^{2}\left(\frac{\omega}{c}x^{\prime}\right)}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}+{\color{gray}\underset{\text{Averages over time to }0}{\underbrace{{\normalcolor 2\cos\left(\left(\omega_{+}-\omega_{-}\right)t^{\prime}+\frac{\omega_{-}+\omega_{+}}{c}x^{\prime}\right)}}}}\right.\\
 & \left.{\color{gray}\underset{\text{Averages over time to }0}{\underbrace{{\normalcolor +4\cos\left(\frac{\omega}{c}x^{\prime}\right)\left(\frac{\Gamma_{-}}{\Gamma_{+}}\cos\left(\left(\omega_{-}-\omega\right)t^{\prime}-\frac{\omega_{-}}{c}x^{\prime}\right)+\frac{\Gamma_{+}}{\Gamma_{-}}\cos\left(\frac{\omega}{c}x^{\prime}\right)\cos\left(\left(\omega_{+}-\omega\right)t^{\prime}+\frac{\omega_{-}}{c}x^{\prime}\right)\right)}}}}\right]
\end{align*}

\end_inset

And the ponderomotive potential over one period (by definition we have 
\begin_inset Formula $\omega_{-}<\omega<\omega_{+}$
\end_inset

, so the frequency of the intensity oscillations will always be non 
\begin_inset Formula $0$
\end_inset

):
\begin_inset Formula 
\begin{equation}
\left\langle I\right\rangle ={\color{teal}E_{0}^{2}}\left({\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}+{\color{green}4\cos^{2}\left(\frac{\omega}{c}x^{\prime}\right)}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}\right)=\tag{e\_10}\label{eq:e_10}
\end{equation}

\end_inset

Recalling the definition of 
\begin_inset Formula $\Gamma_{\mp}$
\end_inset

:
\begin_inset Formula 
\[
\left\langle I\right\rangle ={\color{teal}E_{0}^{2}}\left({\color{red}\frac{\left(1-\beta\right)^{2}}{\left(1+\beta\right)^{2}}}+{\color{blue}\frac{\left(1+\beta\right)^{2}}{\left(1-\beta\right)^{2}}}+{\color{green}2}+{\color{green}2\cos\left(2kx^{\prime}\right)}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
And So we see that the intensity is a sum of constant terms (
\begin_inset Formula ${\color{red}\frac{\left(1-\beta\right)^{2}}{\left(1+\beta\right)^{2}}}+{\color{blue}\frac{\left(1+\beta\right)^{2}}{\left(1-\beta\right)^{2}}}+{\color{green}2}$
\end_inset

) and an oscillating term (
\begin_inset Formula ${\color{green}2\cos\left(2kx^{\prime}\right)}$
\end_inset

).
\end_layout

\begin_layout Standard
And for some gaussian envelope 
\begin_inset Formula $E_{0}\left(x,y,z\right)$
\end_inset

 (neglecting the fact that near the reighley range different wavelengths
 have different spot-size): 
\series bold
\color red
Is it a reasonable assumption at all? I mean, in the waist where it is the
 most interesting their spots sizes differ by 
\begin_inset Formula $1:2$
\end_inset

!
\series default
\color inherit

\begin_inset Formula 
\begin{equation}
\left\langle I\right\rangle \left(x^{\prime},y^{\prime},z^{\prime}\right)={\color{teal}E_{0}^{2}\left(\gamma x^{\prime}+\gamma\beta ct,y^{\prime},z^{\prime}\right)}\left({\color{red}\frac{\left(1-\beta\right)^{2}}{\left(1+\beta\right)^{2}}}+{\color{blue}\frac{\left(1+\beta\right)^{2}}{\left(1-\beta\right)^{2}}}+{\color{green}2}+{\color{green}2\cos\left(2\varphi\left(x^{\prime},t^{\prime}\right)\right)}\right)\label{eq:moving_intensity}
\end{equation}

\end_inset

for 
\begin_inset Formula $\varphi\left(x^{\prime}\right)$
\end_inset

 defined in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gaussian_beam_phase_def"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 as :
\begin_inset Formula 
\[
\varphi\left(x^{\prime}\right)=k_{l}x^{\prime}+k_{l}\frac{y^{2}+z^{2}}{2R\left(x\right)}-\psi\left(x\right)\tag{{\color{blue}\ref{eq:gaussian_beam_phase_def}}}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Adding the gaussian envelope 
\begin_inset Formula $A_{0}^{2}=E_{0}^{2}e^{-r^{2}}$
\end_inset

, and the other coefficients, we have (according to 
\bar under
\color blue

\begin_inset CommandInset href
LatexCommand href
name "Osips paper"
target "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7357394/"
literal "false"

\end_inset


\bar default
\color inherit
):
\begin_inset Formula 
\[
V_{\text{ponderomotive}}=\left\langle I\right\rangle =\frac{e^{2}A_{0}^{2}}{4m\gamma}\frac{1}{2}\left({\color{red}\frac{\left(1-\beta\right)^{2}}{\left(1+\beta\right)^{2}}}+{\color{green}4\cos^{2}\left(\frac{\omega}{c}x^{\prime}\right)}+{\color{blue}\frac{\left(1+\beta\right)^{2}}{\left(1-\beta\right)^{2}}}\right)
\]

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
The cavity effect on one pencil beam centered at 
\begin_inset Formula $\left(x_{0},y_{0}\right)$
\end_inset

 
\begin_inset CommandInset label
LatexCommand label
name "subsec:The cavity effect on a pencil beam"

\end_inset


\end_layout

\begin_layout Standard
Assume we turn on the microscope and electrons are propagating through it.
 After passing through the sample, the electron wave will scatter, and each
 Fourier component of it will be concentrated to a thin column wave at some
 
\begin_inset Formula $x_{0},y_{0}$
\end_inset

 in the Fourier plane.
 we call such a thin columated wave a pencil beam.
\end_layout

\begin_layout Standard
We wish to find an expression for the effect of the cavity with two lasers
 on such a pencil beam.
\end_layout

\begin_layout Standard
Let 
\begin_inset Formula $\psi_{x_{0},y_{0}}\left(x,y,z,ct\right)$
\end_inset

 be the wave function of the electron in the lab's frame, for a pencil beam
 centered around 
\begin_inset Formula $x_{0},y_{0}$
\end_inset

.
\end_layout

\begin_layout Subsection
Linear transformation of rotation and then lorentz transformation (required
 for the next stage):
\end_layout

\begin_layout Standard
In the previous section 
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "sec:Field Derivations"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 we found there is a moving reference frame where the laser intensity is
 composed of one standing wave and two constant terms.
 let us approach the problem from this reference frame.
\end_layout

\begin_layout Standard
Since this frame is moving with respect to some tilted axis (the cavity
 is tilted, according to 
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "sec:alpha_cavity_derivation"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
), transforming the coordinates to this reference frame involve both rotation
 and Lorentz transform.
\end_layout

\begin_layout Standard
Let us denote with 
\begin_inset Formula $r$
\end_inset

 the coordinates in the microscope's frame, with 
\begin_inset Formula $\tilde{r}$
\end_inset

 the coordinates in the rotated frame and with 
\begin_inset Formula $r^{\prime}$
\end_inset

 the coordinates in the rotated and moving frame.
 
\begin_inset Formula $\beta$
\end_inset

 and 
\begin_inset Formula $\gamma$
\end_inset

 are the velocity and Lorentz factor of the moving frame.
 later the velocity and the lorentz factor of the electron will be denoted
 as 
\begin_inset Formula $\beta_{e},\gamma_{e}$
\end_inset

.
\end_layout

\begin_layout Subsubsection
The transformation:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\begin{pmatrix}\tilde{x}\\
\tilde{y}\\
\tilde{z}\\
c\tilde{t}
\end{pmatrix}={\color{gray}\underset{R}{\underbrace{{\normalcolor \begin{pmatrix}\cos\alpha & 0 & \sin\alpha & 0\\
0 & 1 & 0 & 0\\
-\sin\alpha & 0 & \cos\alpha & 0\\
0 & 0 & 0 & 1
\end{pmatrix}}}}}\begin{pmatrix}x\\
y\\
z\\
ct
\end{pmatrix}
\]

\end_inset


\begin_inset Formula 
\[
\begin{pmatrix}x^{\prime}\\
y^{\prime}\\
z^{\prime}\\
ct^{\prime}
\end{pmatrix}={\color{gray}\underset{L}{\underbrace{{\normalcolor \begin{pmatrix}\gamma & 0 & 0 & -\gamma\beta\\
0 & 1 & 0 & 0\\
0 & 0 & 1 & 0\\
-\gamma\beta & 0 & 0 & 1
\end{pmatrix}}}}}\begin{pmatrix}\tilde{x}\\
\tilde{y}\\
\tilde{z}\\
c\tilde{t}
\end{pmatrix}
\]

\end_inset

And in total:
\begin_inset Formula 
\begin{align*}
\begin{pmatrix}x^{\prime}\\
y^{\prime}\\
z^{\prime}\\
ct^{\prime}
\end{pmatrix} & ={\color{gray}\underset{R}{\underbrace{{\normalcolor \begin{pmatrix}\gamma & 0 & 0 & -\gamma\beta\\
0 & 1 & 0 & 0\\
0 & 0 & 1 & 0\\
-\gamma\beta & 0 & 0 & 1
\end{pmatrix}}}}}{\color{gray}\underset{L}{\underbrace{{\normalcolor \begin{pmatrix}\cos\alpha & 0 & \sin\alpha & 0\\
0 & 1 & 0 & 0\\
-\sin\alpha & 0 & \cos\alpha & 0\\
0 & 0 & 0 & 1
\end{pmatrix}}}}}\begin{pmatrix}x\\
y\\
z\\
ct
\end{pmatrix}={\color{gray}\underset{T}{\underbrace{{\normalcolor \begin{pmatrix}\gamma\cos\alpha & 0 & \gamma\sin\alpha & -\gamma\beta\\
0 & 1 & 0 & 0\\
-\sin\alpha & 0 & \cos\alpha & 0\\
-\gamma\beta\cos\alpha & 0 & -\gamma\beta\sin\alpha & \gamma
\end{pmatrix}}}}}\begin{pmatrix}x\\
y\\
z\\
ct
\end{pmatrix}=\\
 & =\begin{pmatrix}\gamma\left(x\cos\alpha+z\sin\alpha\right)-\gamma\beta ct\\
y\\
-\sin\alpha x+\cos\alpha z\\
-\gamma\beta\left(x\cos\alpha+z\sin\alpha\right)+\gamma ct
\end{pmatrix}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsubsection
The inverse transformation:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
R^{-1} & =\begin{pmatrix}\cos\alpha & 0 & -\sin\alpha & 0\\
0 & 1 & 0 & 0\\
\sin\alpha & 0 & \cos\alpha & 0\\
0 & 0 & 0 & 1
\end{pmatrix}\\
L^{-1} & =\begin{pmatrix}\gamma & 0 & 0 & \gamma\beta\\
0 & 1 & 0 & 0\\
0 & 0 & 1 & 0\\
\gamma\beta & 0 & 0 & 1
\end{pmatrix}
\end{align*}

\end_inset


\begin_inset Formula 
\[
T^{-1}=\left(R^{-1}L^{-1}\right)=\begin{pmatrix}\cos\alpha & 0 & -\sin\alpha & 0\\
0 & 1 & 0 & 0\\
\sin\alpha & 0 & \cos\alpha & 0\\
0 & 0 & 0 & 1
\end{pmatrix}\begin{pmatrix}\gamma & 0 & 0 & \gamma\beta\\
0 & 1 & 0 & 0\\
0 & 0 & 1 & 0\\
\gamma\beta & 0 & 0 & 1
\end{pmatrix}=\begin{pmatrix}\gamma\cos\alpha & 0 & -\sin\alpha & \gamma\beta\cos\alpha\\
0 & 1 & 0 & 0\\
\gamma\sin\alpha & 0 & \cos\alpha & \gamma\beta\sin\alpha\\
\gamma\beta & 0 & 0 & \gamma
\end{pmatrix}
\]

\end_inset

And so:
\begin_inset Formula 
\begin{equation}
\begin{pmatrix}y\\
z\\
x\\
ct
\end{pmatrix}=\begin{pmatrix}\gamma x^{\prime}\cos\alpha-z^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\cos\alpha\\
y\\
\gamma x^{\prime}\sin\alpha+z^{\prime}\cos\alpha+\gamma\beta ct^{\prime}\sin\alpha\\
\gamma\beta x^{\prime}+\gamma ct^{\prime}
\end{pmatrix}\label{eq:rotation+lorentz transformation}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Describing the wave function and the laser field in the moving frame
\end_layout

\begin_layout Standard
In the rotated and moving lattice's frame this wave function will become
 (Using 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:rotation+lorentz transformation"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
):
\begin_inset Formula 
\[
\psi^{\prime}\left(x^{\prime},y^{\prime},z^{\prime},ct^{\prime}\right)\stackrel{{\color{blue}\eqref{eq:rotation+lorentz transformation}}}{=}\gamma\psi_{x_{0},y_{0}}\left(T^{-1}\left(x^{\prime},y^{\prime},z^{\prime},ct^{\prime}\right)\right)=\gamma\psi_{x_{0},y_{0}}\begin{pmatrix}\gamma x^{\prime}\cos\alpha-z^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\cos\alpha\\
y^{\prime}\\
\gamma x^{\prime}\sin\alpha+z^{\prime}\cos\alpha+\gamma\beta ct^{\prime}\sin\alpha\\
\gamma\beta x^{\prime}+\gamma ct^{\prime}
\end{pmatrix}
\]

\end_inset


\end_layout

\begin_layout Standard
If 
\begin_inset Formula $\psi_{x_{0},y_{0}}$
\end_inset

 had the form:
\begin_inset Formula 
\begin{align*}
\psi_{x_{0},y_{0}}\left(x,y,z,t\right) & =e^{-\frac{\left(\left(x-x_{0}\right)^{2}+\left(y-y_{0}\right)^{2}\right)}{2\sigma^{2}}}e^{ikz}e^{i\omega t}\approx\\
 & {\color{gray}\approx\delta\left(x-x_{0}\right)\delta\left(y-y_{0}\right)e^{ikz}e^{i\omega t}}
\end{align*}

\end_inset

(Alternatively, we could also choose 
\begin_inset Formula $\psi_{x_{0},y_{0}}\left(x,y,z,t\right)=\delta\left(x-x_{0},y-y_{0}\right)e^{ikz}e^{i\omega t}$
\end_inset

)
\end_layout

\begin_layout Standard
Then 
\begin_inset Formula $\psi^{\prime}$
\end_inset

 has the form:
\begin_inset Formula 
\begin{align}
\psi_{x_{0},y_{0}}^{\prime}\left(x^{\prime},y^{\prime},z^{\prime},ct^{\prime}\right) & =e^{-\frac{\left({\color{gray}\overset{x-x_{0}}{\overbrace{{\normalcolor \left(\gamma x^{\prime}\cos\alpha-z^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\cos\alpha-x_{0}\right)^{2}}}}}+\left(y^{\prime}-y_{0}\right)^{2}\right)}{2\sigma^{2}}}e^{ik{\color{gray}\overset{z}{\overbrace{{\normalcolor \left(\gamma x^{\prime}\sin\alpha+z^{\prime}\cos\alpha+\gamma\beta ct^{\prime}\sin\alpha\right)}}}}}e^{i\omega{\color{gray}\overset{t}{\overbrace{{\normalcolor \left(\gamma\beta x^{\prime}+\gamma ct^{\prime}\right)}}}}}\approx\nonumber \\
 & {\color{gray}\approx\delta\left(\gamma x^{\prime}\cos\alpha-z^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\cos\alpha-x_{0}\right)\delta\left(y-y_{0}\right)e^{ik\left(\gamma x^{\prime}\sin\alpha+z^{\prime}\cos\alpha+\gamma\beta ct^{\prime}\sin\alpha\right)}e^{i\omega\left(\gamma\beta x^{\prime}+\gamma ct^{\prime}\right)}}\label{eq:pencil_beam_after_transformation}
\end{align}

\end_inset

And so we see that in the moving-rotated frame the wave function drifts
 to the left over time, and has a different frequency.
\end_layout

\begin_layout Standard
Let us choose the time 
\begin_inset Formula $t=0$
\end_inset

 as the time the gaussian envelope 
\color gray
(The delta function)
\color inherit
 
\series bold
of the wave function
\series default
 is centered around 
\begin_inset Formula $x^{\prime}=y^{\prime}=z^{\prime}=0$
\end_inset

.
\end_layout

\begin_layout Standard
At 
\begin_inset Formula $z^{\prime}=0$
\end_inset

 the wave function will have the form:
\begin_inset Formula 
\begin{equation}
\psi_{x_{0},y_{0}}^{\prime}\left(x^{\prime},y^{\prime},z^{\prime}=0,ct^{\prime}\right)=\gamma\psi_{x_{0},y_{0}}\begin{pmatrix}\gamma x^{\prime}\cos\alpha+\gamma\beta ct^{\prime}\cos\alpha\\
y^{\prime}\\
\gamma x^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\sin\alpha\\
\gamma\beta x^{\prime}+\gamma ct^{\prime}
\end{pmatrix}=\gamma\psi_{x_{0},y_{0}}\begin{pmatrix}\gamma\cos\alpha\left(x^{\prime}+\beta ct^{\prime}\right)\\
y^{\prime}\\
\gamma x^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\sin\alpha\\
\gamma\beta x^{\prime}+\gamma ct^{\prime}
\end{pmatrix}\tag{e\_32}\label{eq:e_32}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
And so:
\begin_inset Formula 
\begin{align}
\psi_{x_{0},y_{0}}\begin{pmatrix}\gamma\cos\alpha\left(x^{\prime}+\beta ct^{\prime}\right)\\
y^{\prime}\\
\gamma x^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\sin\alpha\\
\gamma\beta x^{\prime}+\gamma ct^{\prime}
\end{pmatrix} & =e^{-\frac{\left(\left(\gamma\cos\alpha\left(x^{\prime}+\beta ct^{\prime}\right)-x_{0}\right)^{2}+\left(y^{\prime}-y_{0}\right)^{2}\right)}{2\sigma^{2}}}e^{ik\left(\gamma x^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\sin\alpha\right)}e^{i\omega\left(\gamma\beta x^{\prime}+\gamma ct^{\prime}\right)}\nonumber \\
 & {\color{gray}\approx\delta\left(\gamma\cos\alpha\left(x^{\prime}+\beta ct^{\prime}\right)-x_{0}\right)\delta\left(y^{\prime}-y_{0}\right)e^{ik\left(\gamma x^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\sin\alpha\right)}e^{i\omega\left(\gamma\beta x^{\prime}+\gamma ct^{\prime}\right)}}\label{eq:e_29}
\end{align}

\end_inset

For 
\begin_inset Formula $t^{\prime}=0$
\end_inset

 we will have:
\begin_inset Formula 
\begin{align}
\psi_{x_{0},y_{0}}\begin{pmatrix}\gamma x^{\prime}\cos\alpha\\
y^{\prime}\\
\gamma x^{\prime}\sin\alpha\\
\gamma\beta x^{\prime}
\end{pmatrix} & =e^{-\frac{\left(\left(\gamma x^{\prime}\cos\alpha-x_{0}\right)^{2}+\left(y^{\prime}-y_{0}\right)^{2}\right)}{2\sigma^{2}}}e^{ik\gamma x^{\prime}\sin\alpha}e^{i\omega\gamma\beta x^{\prime}}={\color{gray}\underset{\begin{array}{c}
\text{Streched by a factor}\\
\text{of }\gamma\cos\alpha\text{ in }x
\end{array}}{\underbrace{{\normalcolor {\color{green}e^{-\frac{\left(x^{\prime}-\frac{x_{0}}{\gamma\cos\alpha}\right)^{2}}{2\left(\frac{\sigma}{\gamma\cos\alpha}\right)^{2}}}}}}}}{\color{green}e^{-\frac{\left(y^{\prime}-y_{0}\right)^{2}}{2\sigma^{2}}}}e^{ik\gamma x^{\prime}\sin\alpha}e^{i\omega\gamma\beta x^{\prime}}\nonumber \\
 & {\color{gray}\approx{\color{gray}\underset{\text{Renormalization}}{\underbrace{\gamma\cos\alpha}}}\delta\left(\gamma\cos\alpha\left(x^{\prime}-\frac{x_{0}}{\gamma\cos\alpha}\right)\right)\delta\left(y^{\prime}-y_{0}\right)e^{ik\gamma x^{\prime}\sin\alpha}e^{i\omega\gamma\beta x^{\prime}}}\label{eq:e_30}
\end{align}

\end_inset

And so we see the
\color green
 
\color inherit
pencil beam is a Gaussian 
\color gray
delta function
\color inherit
 centered around 
\begin_inset Formula $\left(\frac{x_{0}}{\gamma\cos\alpha},y_{0}\right)$
\end_inset

 (at 
\begin_inset Formula $z^{\prime}=0$
\end_inset

 and 
\begin_inset Formula $t^{\prime}=0$
\end_inset

).
 Taking the width of the pencil to be very small with respect to the features
 of the laser beam, we can approximate the electric field experienced by
 the electron pencil beam to be the value at it's center (at 
\begin_inset Formula $\left(x_{0},y_{0},z\right)$
\end_inset

).
\end_layout

\begin_layout Standard
Now we recall that in our 2 frequencies cavity there are 2 frequencies.
 In particular, we saw that by choosing 
\begin_inset Formula $\Gamma_{+}E_{1}=\Gamma_{-}E_{2}={\color{teal}E_{0}}$
\end_inset

, we get for a standing wave cavity a wave of the form (all the expressions
 are explained after the equation):
\begin_inset Formula 
\[
E_{\text{laser,lattic'es frame}}\left(x^{\prime},y^{\prime},z^{\prime},t^{\prime}\right)=
\]

\end_inset


\begin_inset Formula 
\[
={\color{teal}E_{0,\text{envelope}}\left(\gamma x^{\prime}+\gamma\beta ct^{\prime},y^{\prime},z^{\prime}\right)}\cdot\left[{\color{red}\frac{\Gamma_{-}}{\Gamma_{+}}e^{i\left(\omega_{-}t^{\prime}-\varphi_{-}\left(x^{\prime}\right)\right)}}+{\color{green}2e^{i\omega t^{\prime}}\cos\left(\varphi\left(x^{\prime}\right)\right)}+{\color{blue}\frac{\Gamma_{+}}{\Gamma_{-}}e^{i\left(\omega_{+}t^{\prime}+\varphi_{+}\left(x^{\prime}\right)\right)}}\right]\tag{{\color{blue}\ref{eq:wave_in_moving_frame}}}
\]

\end_inset


\end_layout

\begin_layout Standard
For:
\begin_inset Formula 
\begin{align}
{\color{teal}E_{0}} & \equiv\Gamma_{+}E_{1}=\Gamma_{-}E_{2}\tag{{\color{blue}\ref{eq:E_0_def}}}\nonumber \\
{\color{gray}\underset{\text{function}}{\underbrace{{\normalcolor {\color{teal}E_{0}\left(x^{\prime},y^{\prime},z^{\prime},t^{\prime}\right)}}}}} & \equiv{\color{gray}\underset{\text{number}}{\underbrace{{\normalcolor {\color{teal}E_{0}}}}}}\cdot\frac{w_{0}}{w\left(\gamma x^{\prime}+\gamma\beta ct^{\prime}\right)}\cdot e^{-\frac{y^{2}+z^{2}}{w^{2}\left(\gamma x^{\prime}+\beta ct^{\prime}\right)}}\label{eq:e_31}\\
\Gamma_{\pm} & \equiv\gamma\left(1\pm\beta\right)\tag{{\color{blue}\ref{eq:capital_gamma_def}}}\nonumber \\
\omega & \equiv\Gamma_{+}\omega_{1}=\Gamma_{-}\omega_{2}\tag{{\color{blue}{\color{blue}\ref{eq:omega_def}}}}\nonumber \\
\omega_{-} & \equiv\Gamma_{-}\omega_{1}\nonumber \\
\omega_{+} & \equiv\Gamma_{+}\omega_{2}\nonumber \\
\varphi_{\pm}\left(x\right) & =k_{\pm}x+k_{\pm}\frac{y^{2}+z^{2}}{2R_{\pm}\left(x\right)}-\psi_{\pm}\left(x\right)\nonumber 
\end{align}

\end_inset


\end_layout

\begin_layout Remark
For a ring cavity we will not have the constant intensities marked in 
\color blue
blue
\color inherit
 and 
\color red
red
\color inherit
:
\begin_inset Formula 
\[
E_{\text{laser,lattic'es frame, ring cavity}}\left(x^{\prime},y^{\prime},z^{\prime},t^{\prime}\right)={\color{teal}E_{0,\text{envelope}}\left(\gamma x^{\prime}+\gamma\beta ct^{\prime},y^{\prime},z^{\prime}\right)}\cdot2e^{i\omega t}\cos\left(\varphi\left(x^{\prime}\right)\right)
\]

\end_inset


\end_layout

\begin_layout Standard
And the intensity is given by equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:moving_intensity"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
:
\begin_inset Formula 
\[
\left\langle I_{\text{laser, lattic'es frame}}\right\rangle \left(x^{\prime},y^{\prime},z^{\prime}\right)={\color{teal}E_{0}^{2}\left(\gamma x^{\prime}+\gamma\beta ct,y^{\prime},z^{\prime}\right)}\left({\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}+{\color{green}2}+{\color{green}2\cos\left(2\varphi\left(x^{\prime}\right)\right)}\right)\tag{{\color{blue}\eqref{eq:moving_intensity}}}
\]

\end_inset


\end_layout

\begin_layout Standard
And for a ring cavity:
\begin_inset Formula 
\[
\left\langle I\right\rangle _{\text{laser, lattic'es frame, ring cavity}}={\color{teal}E_{0}^{2}\left(\gamma x^{\prime}+\gamma\beta ct,y^{\prime},z^{\prime}\right)}\cdot\left({\color{green}2}+{\color{green}2\cos\left(2\varphi\left(x^{\prime}\right)\right)}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
Now we are in a bit of a confusing situation - the envelope is running to
 the left with velocity 
\begin_inset Formula $\beta$
\end_inset

, so which value of the envelope will the electorn's pencil beam feel? We
 have to remember that also the electron beam crosses the 
\begin_inset Formula $z^{\prime}=0$
\end_inset

 plane at different 
\begin_inset Formula $x^{\prime}$
\end_inset

's for different times 
\begin_inset Formula $t^{\prime}$
\end_inset

.
 In particular - from the expression for the pencil beam in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_29"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 we see that the pencil beam also drifts to the left with velocity 
\begin_inset Formula $\beta c$
\end_inset

 and so 
\series bold
experiences a constant envelope value.
\end_layout

\begin_layout Standard
Which value? Since it is constant in time, we can substitute the 
\begin_inset Formula $x^{\prime}$
\end_inset

 value of 
\begin_inset Formula $t=0$
\end_inset

, which would be 
\begin_inset Formula $\frac{x_{0}}{\gamma\cos\alpha}$
\end_inset

 (according to equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_30"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
).
\end_layout

\begin_layout Standard
Substituting it into the envelope expression in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_31"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 and the intensity from 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:moving_intensity"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 we get:
\begin_inset Formula 
\begin{align}
\left\langle I\right\rangle \left(x^{\prime}=\frac{x_{0}}{\gamma\cos\alpha},y^{\prime},z^{\prime},t^{\prime}=0\right) & ={\color{teal}E_{0}^{2}\cdot\frac{w_{0}^{2}}{w^{2}\left(\cancel{\gamma}\frac{x_{0}}{\cancel{\gamma}\cos\alpha}+\cancel{\gamma\beta c\cdot0}\right)}\cdot e^{-\frac{2\left(y^{2}+z^{2}\right)}{w^{2}\left(\cancel{\gamma}\frac{x_{0}}{\cancel{\gamma}\cos\alpha}+\cancel{\gamma\beta c\cdot0}\right)}}}\left({\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}+{\color{green}2}+{\color{green}2\cos\left(2\varphi\left(x^{\prime}\right)\right)}\right)\label{eq:e_36}\\
 & ={\color{teal}E_{0}^{2}\cdot\frac{w_{0}^{2}}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}\cdot e^{-\frac{2\left(y^{2}+z^{2}\right)}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}}}\left({\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}+{\color{green}2}+{\color{green}2\cos\left(2\varphi\left(x^{\prime}\right)\right)}\right)\nonumber 
\end{align}

\end_inset


\end_layout

\begin_layout Remark
And for a ring cavity the average intensity will not have the 
\color blue
blue
\color inherit
 and 
\color red
red
\color inherit
 terms:
\begin_inset Formula 
\[
\left\langle I_{\text{ring cavity}}\right\rangle \left(x^{\prime}=\frac{x_{0}}{\gamma\cos\alpha},y^{\prime},z^{\prime},t^{\prime}=0\right)={\color{teal}E_{0}^{2}\cdot\frac{w_{0}^{2}}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}\cdot e^{-\frac{2\left(y^{2}+z^{2}\right)}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}}}\left({\color{green}2}+{\color{green}2\cos\left(2\varphi\left(x^{\prime}\right)\right)}\right)
\]

\end_inset


\end_layout

\begin_layout Subsection
Calculating the interaction between the electron and the laser intensity
\end_layout

\begin_layout Standard
We saw in equations 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ponderomotive_integral_final_result_standing_wave"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 and 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ponderomotive_integral_final_result_moving_wave"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 how the different intensity factors contribute to the phase of the electron.
\end_layout

\begin_layout Standard
to implement those calculations here, we want to first find the velocity
 of the electron in the moving frame.
\end_layout

\begin_layout Standard
What are 
\begin_inset Formula $\beta_{e}^{\prime},\gamma_{e}^{\prime}$
\end_inset

 in the moving frame?
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
{\color{gray}\underset{\text{Lab's frame}}{\underbrace{{\normalcolor \beta_{e}\hat{z}}}}}\xrightarrow[\text{rotate by }\alpha\text{ in }xy\text{ plane}]{}{\color{gray}\underset{\text{rotated frame}}{\underbrace{{\normalcolor \beta_{e}\hat{z}\cos\alpha-\beta_{e}\sin\alpha\hat{x}}}}}\xrightarrow[\text{lorentz transform in }\hat{x}]{}\frac{\frac{1}{\gamma_{c}}\beta_{e}\cos\alpha}{1-\beta_{e}\sin\alpha\cdot\beta_{c}}\hat{z}+\frac{-\beta_{e}\sin\alpha+\beta_{c}}{1-\beta_{e}\sin\alpha\cdot\beta_{c}}\hat{x}
\]

\end_inset

If we choose now to set 
\begin_inset Formula $-\beta_{e}\sin\alpha+\beta_{c}=0\iff\alpha=\sin^{-1}\left(\frac{\beta_{c}}{\beta_{e}}\right)$
\end_inset

, then the electron will not move in the horizontal axis, and it's trajectory
 will be 
\begin_inset Formula $\boldsymbol{r}^{\prime}\left(t\right)=\begin{pmatrix}x_{0}^{\prime}\\
y_{0}^{\prime}\\
z_{0}^{\prime}+\beta_{e}^{\prime}ct^{\prime}
\end{pmatrix}$
\end_inset

, which is assumed in the derivation of the interaction in section 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "sec:Review-of-Osip's"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
, and in particular in equation 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "eq:ponderomotive_integral_final_result_standing_wave"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
.
 under this choice of 
\begin_inset Formula $\alpha$
\end_inset

 we can write: 
\begin_inset Formula 
\begin{equation}
\boldsymbol{v}_{e}^{\prime}=\beta_{e}^{\prime}\hat{z}=\frac{\frac{1}{\gamma_{c}}\beta_{e}\cos\alpha}{1-\beta_{e}\sin\alpha\cdot\beta_{c}}\hat{z}\label{eq:beta_e_moving_frame}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
In the paper 
\bar under
\color blue

\begin_inset CommandInset href
LatexCommand href
name "Osip's paper"
target "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7357394/"
literal "false"

\end_inset


\bar default
\color inherit
, the envelope of the phase shift acquired is given by integrating the field's
 intensity envelope (only the envelope, without the 
\color green
green
\color inherit
, 
\color blue
blue
\color inherit
, and 
\color red
red
\color inherit
 terms) of the electromagnetic wave over 
\begin_inset Formula $z,t\left(z\right)$
\end_inset

, (equation 
\begin_inset Formula $\left(9\right)$
\end_inset

 in the paper) and so we get:
\begin_inset Formula 
\begin{align}
\phi_{0}\left(x^{\prime}=\frac{x_{0}}{\cos\alpha},y^{\prime}=y_{0}\right) & =\frac{e^{2}}{4mc\beta_{e}^{\prime}\gamma_{e}^{\prime}\hbar}\cdot\intop A_{0}^{2}\left(y,z\right)dz\nonumber \\
 & =\frac{e^{2}}{4mc\beta_{e}^{\prime}\gamma_{e}^{\prime}\hbar}\cdot\intop{\color{teal}E_{0}^{2}\cdot\frac{w_{0}^{2}}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}\cdot e^{-\frac{2\left(y^{2}+z^{2}\right)}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}}}dz\nonumber \\
 & \stackrel{{\color{blue}\eqref{eq:gaussian_beam_potential_total_phase}}}{=}\frac{e^{2}}{\hbar4mc\beta_{e}^{\prime}\gamma_{e}^{\prime}\omega^{2}}\sqrt{\frac{\pi}{2}}\frac{w_{0}^{2}E_{0}^{2}}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}e^{-\frac{2y_{0}^{2}}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}}\label{eq:phi_0_first_time}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
And with the relativistic correction from equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ponderomotive_integral_final_result_standing_wave"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 we know that the 
\begin_inset Formula ${\color{green}2+2\cos\left(2kx^{\prime}\right)}$
\end_inset

 term will end up as 
\begin_inset Formula ${\color{green}2+2\rho\left(\theta,\beta_{e}^{\prime}\right)\cos\left(2kx^{\prime}\right)}$
\end_inset

 but from equation
\color blue
 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ponderomotive_integral_final_result_moving_wave"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 the two constant terms will just stay 
\begin_inset Formula ${\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}$
\end_inset

:
\begin_inset Formula 
\begin{align*}
\phi\left(x_{0},y_{0}\right) & ={\color{gray}\overset{\text{Do not appear in a ring cavity}}{\overbrace{{\normalcolor \phi_{{\color{red}\text{red term}}}\left(x_{0},y_{0}\right)+\phi_{{\color{blue}\text{blue term}}}\left(x_{0},y_{0}\right)}}}}+\phi_{{\color{green}\text{green term}}}\left(x_{0},y_{0}\right)\\
 & =\phi_{0}\left(x_{0},y_{0}\right)\cdot\left[{\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}+{\color{green}2+2\rho\left(\theta,\beta_{e}^{\prime}\right)\cos\left(2kx^{\prime}\right)}\right]
\end{align*}

\end_inset


\end_layout

\begin_layout Remark
I was searching for some time where did we use the smart choice of the cavity
 tilt 
\begin_inset Formula $\alpha$
\end_inset

, that appears in 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "sec:alpha_cavity_derivation"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
.
 The answer is here on the last equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi_0_first_time"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
.
 Why? This equation assumes the electron propagates in the 
\begin_inset Formula $z$
\end_inset

 direction (in particular, it comes from an integration over 
\begin_inset Formula $t,z\left(t\right)$
\end_inset

 where 
\begin_inset Formula $z\left(t\right)=z_{0}+\beta ct$
\end_inset

).
\end_layout

\begin_layout Remark
We choose 
\begin_inset Formula $\alpha$
\end_inset

 such that in this frame this is indeed the path of the electron.
 Looking at the expression for the wave function from equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:pencil_beam_after_transformation"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
, it is not obvious that this is the direction of flow of the electron.
 However, examining a single wave-packet (instead of a full 
\begin_inset Quotes eld
\end_inset

pencil
\begin_inset Quotes erd
\end_inset

), and using the derivation from 
\bar under
\color blue

\begin_inset CommandInset ref
LatexCommand nameref
reference "sec:alpha_cavity_derivation"
plural "false"
caps "false"
noprefix "false"

\end_inset


\bar default
\color inherit
, we see that a single packet of electron that moved in the 
\begin_inset Formula $z$
\end_inset

 direction in the microscope coordinates, would move in the tilted-moving
 lattice also in the tilted 
\begin_inset Formula $\hat{z}$
\end_inset

 direction.
\end_layout

\begin_layout Standard
Adding it as a phase to the wave function 
\begin_inset Formula $\psi^{\prime}$
\end_inset

 from equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_32"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
, we get:
\begin_inset Formula 
\[
\psi^{\prime}\left(x^{\prime},y^{\prime},z^{\prime}=0,ct^{\prime}=0\right)\stackrel{{\color{blue}\eqref{eq:e_32}}}{=}\gamma\psi_{x_{0},y_{0}}\begin{pmatrix}\gamma\cos\alpha\left(x^{\prime}+\beta ct^{\prime}\right)\\
y^{\prime}\\
\gamma x^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\sin\alpha\\
\gamma\beta x^{\prime}+\gamma ct^{\prime}
\end{pmatrix}\cdot e^{i\phi_{0}\left(\frac{x_{0}}{\cos\theta},y_{0}\right)\left({\color{green}2+2\rho\left(\theta,\beta_{e}^{\prime}\right)\cos\left(2kx^{\prime}\right)}+{\color{gray}\underset{\text{Not in ring cavity}}{\underbrace{{\normalcolor {\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}}}}}\right)}
\]

\end_inset


\end_layout

\begin_layout Subsection
Going back to the lab's frame:
\end_layout

\begin_layout Standard
Doing the Lorentz transform and rotation back, we get:
\begin_inset Formula 
\[
x^{\prime}\rightarrow\gamma\left(x\cos\alpha+z\sin\alpha\right)-\gamma\beta ct\Rightarrow
\]

\end_inset


\begin_inset Formula 
\[
\cos\left(2\varphi\left(x^{\prime}\right)\right)=\cos\left(2\varphi\left(\gamma\left(x\cos\alpha+z\sin\alpha\right)-\gamma\beta ct\right)\right)
\]

\end_inset

And so after transforming back to the lab's frame the phase will be:
\begin_inset Formula 
\begin{align*}
{\normalcolor {\color{gray}\overset{\text{Lattice's frame}}{\overbrace{{\normalcolor \gamma\psi_{x_{0},y_{0}}\begin{pmatrix}\gamma x^{\prime}\cos\alpha-z^{\prime}\sin\alpha+\gamma\beta ct^{\prime}\cos\alpha\\
y^{\prime}\\
\gamma x^{\prime}\sin\alpha+z^{\prime}\cos\alpha+\gamma\beta ct^{\prime}\sin\alpha\\
\gamma\beta x^{\prime}+\gamma ct^{\prime}
\end{pmatrix}\cdot e^{i\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\left({\color{green}2+2\rho\left(\theta,\beta_{e}^{\prime}\right)\cos\left(2kx^{\prime}\right)}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}+{\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}\right)}}}}}} & \xrightarrow[\text{Lorentz transform and rotation}]{}\\
{\color{gray}\underset{\text{Lab's frame}}{\underbrace{{\normalcolor \psi_{x_{0},y_{0}}\begin{pmatrix}x\\
y\\
z\\
t
\end{pmatrix}\cdot e^{i\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\left({\color{green}2+2\rho\left(\theta,\beta_{e}^{\prime}\right)\cos\left(2k\left(\gamma\left(x\cos\alpha+z\sin\alpha\right)-\gamma\beta ct\right)\right)}+{\color{blue}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}}+{\color{red}\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}\right)}}}}}
\end{align*}

\end_inset

Approximating again the wave function to be non-zero only at around 
\begin_inset Formula $x=x_{0}$
\end_inset

, we can substitute 
\begin_inset Formula $x=x_{0}$
\end_inset

 in the phase and get:
\begin_inset Formula 
\begin{equation}
\psi_{x_{0},y_{0}}\begin{pmatrix}x\\
y\\
z\\
t
\end{pmatrix}\cdot e^{i\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\left(2+2\rho\left(\theta,\beta_{e}^{\prime}\right)\cos\left(2\gamma k_{l}\left[\left(x_{0}\cos\alpha+z\sin\alpha\right)-\beta ct\right]\right)+{\color{gray}\underset{\text{Not in ring cavity}}{\underbrace{{\normalcolor \left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}+\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}}}}\right)}\label{eq:analytical cavity effect - total modulation}
\end{equation}

\end_inset

And the middle band will be:
\begin_inset Formula 
\[
e^{i\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\left(\cos\left(2\gamma k_{l}\left[\left(x_{0}\cos\alpha+z\sin\alpha\right)-\beta ct\right]\right)+\text{Const}\right)}={\color{gray}\underset{\text{No t dependance}}{\underbrace{{\color{brown}e^{i\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\left(2+\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}+\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}\right)}}}}}\cdot{\color{teal}e^{i\rho\left(\theta,\beta_{e}^{\prime}\right)\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\left(2\sin\left(2\gamma k_{l}\beta c\left(-t+\frac{\pi}{2\gamma k_{l}\beta c}\right)+2\gamma k_{l}\left(x_{0}\cos\alpha+z\sin\alpha\right)\right)\right)}}=
\]

\end_inset

Using the identity:
\begin_inset Formula 
\[
e^{i\left[{\color{brown}A_{0}}+{\color{teal}A\sin\left(\omega t\right)}\right]}={\color{brown}e^{iA_{0}}}\cdot{\color{teal}\sum_{q}J_{q}\left(A\right)e^{iq\omega t}}
\]

\end_inset

We get:
\begin_inset Formula 
\[
={\color{brown}e^{i\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\left(2+{\color{gray}\underset{\text{Not in ring cavity}}{\underbrace{{\normalcolor {\color{brown}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}+\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}}}}}\right)}}\cdot{\color{teal}\sum_{q=-\infty}^{\infty}J_{q}\left(2\rho\left(\theta,\beta_{e}^{\prime}\right)\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\right)e^{iq\left(2\gamma k_{l}\beta c\left(-t+\frac{\pi}{4\gamma k_{l}\beta c}\right)+2\gamma k_{l}\left(x_{0}\cos\alpha+z\sin\alpha\right)\right)}}\Rightarrow
\]

\end_inset

And after the energy filter that will keep only the 
\begin_inset Formula $0$
\end_inset

'th order:
\begin_inset Formula 
\begin{equation}
\psi_{x_{0},y_{0}}\begin{pmatrix}x\\
y\\
z\\
t
\end{pmatrix}\xrightarrow{\text{Passing through the cavity}}\psi_{x_{0},y_{0}}\begin{pmatrix}x\\
y\\
z\\
t
\end{pmatrix}\cdot{\color{brown}e^{i\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\left(2+{\color{gray}\underset{\text{Not in ring cavity}}{\underbrace{{\normalcolor {\color{brown}\left(\frac{\Gamma_{+}}{\Gamma_{-}}\right)^{2}+\left(\frac{\Gamma_{-}}{\Gamma_{+}}\right)^{2}}}}}}\right)}}\cdot{\color{teal}J_{0}\left(2\rho\left(\theta,\beta_{e}^{\prime}\right)\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\right)}\tag{e\_35}\label{eq:e_35}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
And for a ring cavity:
\begin_inset Formula 
\begin{equation}
\psi_{x_{0},y_{0}}\begin{pmatrix}x\\
y\\
z\\
t
\end{pmatrix}\xrightarrow{\text{Passing through the cavity}}\psi_{x_{0},y_{0}}\begin{pmatrix}x\\
y\\
z\\
t
\end{pmatrix}\cdot{\color{brown}e^{i2\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)}}\cdot{\color{teal}J_{0}\left(2\rho\left(\theta,\beta_{e}^{\prime}\right)\phi_{0}\left(\frac{x_{0}}{\cos\alpha},y_{0}\right)\right)}\tag{e\_36}\label{eq:e_38}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
for 
\begin_inset Formula 
\begin{equation}
\phi_{0}\left(x^{\prime}=\frac{x_{0}}{\cos\alpha},y^{\prime}=y_{0}\right)=\frac{e^{2}}{\hbar4mc\beta_{e}\gamma_{e}}\sqrt{\frac{\pi}{2}}\frac{E_{0}^{2}w_{0}^{2}}{w\left(\frac{x_{0}}{\cos\alpha}\right)}e^{-\frac{2y_{0}^{2}}{w^{2}\left(\frac{x_{0}}{\cos\alpha}\right)}}\tag{e\_11}\label{eq:e_11}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
Side calculations
\end_layout

\begin_layout Subsection
The integral over the intensity envelope of the gaussian beam:
\end_layout

\begin_layout Standard
The intensity envelope:
\begin_inset Formula 
\[
I\left(x,y,z\right)=E_{0}^{2}\frac{w_{0}^{2}}{w^{2}\left(x\right)}e^{-\frac{2\left(y^{2}+z^{2}\right)}{w^{2}\left(x\right)}}=\frac{\pi}{2}E_{0}^{2}w_{0}^{2}\cdot\frac{1}{\sqrt{2\pi}\cdot\frac{1}{2}w\left(x\right)}e^{-\frac{z^{2}}{2\left(\frac{w\left(x\right)}{2}\right)^{2}}}\cdot\frac{1}{\sqrt{2\pi}\cdot\frac{1}{2}w\left(x\right)}e^{-\frac{y^{2}}{2\left(\frac{w\left(x\right)}{2}\right)^{2}}}
\]

\end_inset

The integral over the 
\begin_inset Formula $z$
\end_inset

 axis will be:
\begin_inset Formula 
\[
\intop_{-\infty}^{\infty}\frac{\pi}{2}E_{0}^{2}w_{0}^{2}\cdot\frac{1}{\sqrt{2\pi}\cdot\frac{1}{2}w\left(x\right)}e^{-\frac{{\color{green}y}^{2}}{2\left(\frac{w\left(x\right)}{2}\right)^{2}}}\cdot\frac{1}{\sqrt{2\pi}\cdot\frac{1}{2}w\left(x\right)}e^{-\frac{{\color{red}z}^{2}}{2\left(\frac{w\left(x\right)}{2}\right)^{2}}}dz=\frac{\pi}{2}E_{0}^{2}w_{0}^{2}\frac{1}{\sqrt{2\pi}\cdot\frac{1}{2}w\left(x\right)}e^{-\frac{{\color{green}y}^{2}}{2\left(\frac{w\left(x\right)}{2}\right)^{2}}}{\color{gray}\underset{1}{\underbrace{{\normalcolor \cancel{\intop_{-\infty}^{\infty}\cdot\frac{1}{\sqrt{2\pi}\cdot\frac{1}{2}w\left(x\right)}e^{-\frac{{\color{red}z}^{2}}{2\left(\frac{w\left(x\right)}{2}\right)^{2}}}\cdot dz}}}}}=
\]

\end_inset


\begin_inset Formula 
\begin{align*}
\intop_{z}I\left(y,z\right)dz & =\frac{\pi}{2}E_{0}^{2}w_{0}^{2}\frac{1}{\sqrt{2\pi}\cdot\frac{1}{2}w\left(x\right)}e^{-\frac{y^{2}}{2\left(\frac{w\left(x\right)}{2}\right)^{2}}}\\
 & =\sqrt{\frac{\pi}{2}}\frac{E_{0}^{2}w_{0}^{2}}{w\left(x\right)}e^{-\frac{2y^{2}}{w^{2}\left(x\right)}}
\end{align*}

\end_inset

Adding the constants of the ponderomotive potential from 
\bar under

\begin_inset CommandInset href
LatexCommand href
name "ponderomotive potential article"
target "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7357394/"
literal "false"

\end_inset


\bar default
 for the final phase (and also adding 
\begin_inset Formula $\frac{1}{\omega^{2}}$
\end_inset

 factor because 
\begin_inset Formula $\phi$
\end_inset

 is integration of 
\begin_inset Formula $A^{2}$
\end_inset

 which is 
\begin_inset Formula $\frac{E^{2}}{\omega^{2}}$
\end_inset

):
\begin_inset Formula 
\begin{equation}
\boxed{\phi_{0}\left(x,y\right)=\frac{e^{2}}{\hbar4mc\beta\gamma\omega^{2}}\sqrt{\frac{\pi}{2}}\frac{E_{0}^{2}w_{0}^{2}}{w\left(x\right)}e^{-\frac{2y^{2}}{w^{2}\left(x\right)}}}\tag{e\_1}\label{eq:gaussian_beam_potential_total_phase}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Using the relation 
\begin_inset Formula $\boldsymbol{p}=\gamma mv=\gamma m\beta c=\hbar k$
\end_inset

 we can also write:
\begin_inset Formula 
\[
\frac{e^{2}}{\hbar4mc\beta\gamma}=\frac{e^{2}}{4\hbar^{2}k_{\text{electron}}}
\]

\end_inset

Which is more like Kirkland's notation.
\end_layout

\begin_layout Subsection
Relation between wavelengths and numerical aperture in a fixed cavity 
\begin_inset CommandInset label
LatexCommand label
name "sec:NA_ratio"

\end_inset


\end_layout

\begin_layout Standard
Suppose we have two wavelengths, 
\begin_inset Formula $\lambda_{1}$
\end_inset

 and 
\begin_inset Formula $\lambda_{2}$
\end_inset

 in a symmetric cavity, with radius of curvature 
\begin_inset Formula $R$
\end_inset

, length 
\begin_inset Formula $L$
\end_inset

, and unconcentricity 
\begin_inset Formula $u=R-\frac{L}{2}$
\end_inset

.
\end_layout

\begin_layout Standard
We know that:
\begin_inset Formula 
\begin{equation}
\begin{split}u & \equiv{\color{green}R}-\frac{L}{2}\\
 & ={\color{green}\frac{L}{2}\left(\cancel{1}+\frac{4z^{2}}{L^{2}}\right)}-\cancel{\frac{L}{2}}\\
 & =\frac{2z_{R}^{2}}{L}\\
 & =\frac{2\pi^{2}\cdot w_{0}^{2}}{\lambda^{2}\cdot L}\\
 & =\frac{2\pi^{2}\cdot w_{0}^{2}}{\lambda^{2}\cdot L}\cdot\frac{\pi^{2}}{\lambda^{2}}\cdot\frac{\lambda^{2}}{\pi^{2}}\\
 & =\frac{2{\color{teal}\pi^{4}\cdot w_{0}^{4}}}{{\color{teal}\lambda^{2}}\cdot L}\cdot\frac{\lambda^{2}}{\pi^{2}}\\
 & =\frac{2\lambda^{2}}{{\color{teal}\kaliNA^{4}}\cdot L\cdot\pi^{2}}{\color{lightgray}\ \backslash\cdot\frac{\kaliNA^{4}}{u}}
\end{split}
\end{equation}

\end_inset


\begin_inset Formula 
\[
{\color{teal}\kaliNA^{4}}=\frac{2\lambda^{2}}{L\pi^{2}u}\Rightarrow
\]

\end_inset


\begin_inset Formula 
\[
\kaliNA^{4}\propto\lambda^{2}{\color{lightgray}\ \backslash\sqrt[4]{}}
\]

\end_inset


\begin_inset Formula 
\[
\kaliNA\propto\sqrt{\lambda}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\kaliNA_{2}=\kaliNA_{1}\cdot\sqrt{\frac{\lambda_{2}}{\lambda_{1}}}\tag{NA ratios}\label{eq:e_34}
\end{equation}

\end_inset

Thus if we have 
\begin_inset Formula $\lambda_{1}=1064\unit{nm}$
\end_inset

 and 
\begin_inset Formula $\lambda_{2}=532\unit{nm}$
\end_inset

, and 
\begin_inset Formula $\kaliNA_{1}=0.1$
\end_inset

 then 
\begin_inset Formula $\kaliNA_{2}=0.1\cdot\frac{1}{\sqrt{2}}$
\end_inset


\end_layout

\begin_layout Subsection
The relation between 
\begin_inset Formula $\beta_{\text{electron}},\beta_{\text{lattice}},\alpha,\lambda_{1},\lambda_{2}$
\end_inset

:
\begin_inset CommandInset label
LatexCommand label
name "sec:alpha_cavity_derivation"

\end_inset


\end_layout

\begin_layout Standard
In equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_36"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 and in the paragraph before, we demand that 
\end_layout

\begin_layout Standard
We saw that the velocity of the standing lattice, calculated in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:beta_lattice"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 is 
\begin_inset Formula $\beta_{\text{lattice}}=\frac{1-\frac{\omega_{1}}{\omega_{2}}}{1+\frac{\omega_{1}}{\omega_{2}}}=\frac{1-\frac{\lambda_{2}}{\lambda_{1}}}{1+\frac{\lambda_{2}}{\lambda_{1}}}=\frac{\lambda_{1}-\lambda_{2}}{\lambda_{1}+\lambda_{2}}$
\end_inset

.
\end_layout

\begin_layout Standard
In the next figure we can see that for the electron to experience a constant
 intensity 
\begin_inset Formula $\alpha$
\end_inset

 satisfies the relation:
\begin_inset Formula 
\begin{equation}
\sin\alpha=\frac{\beta_{\text{lattice}}}{\beta_{\text{electron}}}\label{eq:alpha_cavity_definitio}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
tikzset{every picture/.style={line width=0.75pt}} %set default line width
 to 0.75pt        
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
\end_layout

\begin_layout Plain Layout

%uncomment if require: 
\backslash
path (0,300); %set diagram left start at 0, and has height of 300
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da7125554558598697] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1
 ]   (281.37,19.75) -- (281.37,286.25) ;
\end_layout

\begin_layout Plain Layout


\backslash
draw [shift={(281.37,288.25)}, rotate = 270] [color={rgb, 255:red, 245; green,
 166; blue, 35 }  ,draw opacity=1 ][line width=0.75]    (10.93,-3.29) ..
 controls (6.95,-1.4) and (3.31,-0.3) ..
 (0,0) ..
 controls (3.31,0.3) and (6.95,1.4) ..
 (10.93,3.29)   ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da283048712404145] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]
   (304.92,98.71) -- (211.33,240.92) ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da5379795064664468] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]
   (364.17,137.33) -- (270.58,279.54) ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da3402466039047296] 
\end_layout

\begin_layout Plain Layout


\backslash
draw    (223,223.86) -- (281.37,262.11) ;
\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp23146508624084605] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (281.87,171.17) ..
 controls (281.7,171.18) and (281.54,171.18) ..
 (281.37,171.18) ..
 controls (274.03,171.18) and (267.31,168.54) ..
 (262.09,164.16) -- (281.37,141.18) -- cycle ; 
\backslash
draw   (281.87,171.17) ..
 controls (281.7,171.18) and (281.54,171.18) ..
 (281.37,171.18) ..
 controls (274.03,171.18) and (267.31,168.54) ..
 (262.09,164.16) ;  
\end_layout

\begin_layout Plain Layout

%Shape: Rectangle [id:dp6779957002194004] 
\end_layout

\begin_layout Plain Layout


\backslash
draw   (25.97,57) -- (205,57) -- (205,168.75) -- (25.97,168.75) -- cycle ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da9230280803605642] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1
 ]   (39.87,63.75) -- (39.87,78.75) ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da47524783033269813] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]
   (45.5,125.75) -- (39.75,131.5) -- (34.83,136.42) ;
\end_layout

\begin_layout Plain Layout

%Shape: Circle [id:dp7702389007744006] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0 ][fill={rgb,
 255:red, 65; green, 117; blue, 5 }  ,fill opacity=1 ] (277.5,136.3) ..
 controls (277.5,134.16) and (279.23,132.43) ..
 (281.37,132.43) ..
 controls (283.51,132.43) and (285.25,134.16) ..
 (285.25,136.3) ..
 controls (285.25,138.44) and (283.51,140.18) ..
 (281.37,140.18) ..
 controls (279.23,140.18) and (277.5,138.44) ..
 (277.5,136.3) -- cycle ;
\end_layout

\begin_layout Plain Layout

%Shape: Circle [id:dp21600996519787752] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0 ][fill={rgb,
 255:red, 65; green, 117; blue, 5 }  ,fill opacity=1 ] (277.5,262.11) ..
 controls (277.5,259.97) and (279.23,258.23) ..
 (281.37,258.23) ..
 controls (283.51,258.23) and (285.25,259.97) ..
 (285.25,262.11) ..
 controls (285.25,264.25) and (283.51,265.98) ..
 (281.37,265.98) ..
 controls (279.23,265.98) and (277.5,264.25) ..
 (277.5,262.11) -- cycle ;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (282,175.9) node [anchor=north west][inner sep=0.75pt]    {$
\backslash
beta _{e} 
\backslash
Delta t$};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (227,243.9) node [anchor=north west][inner sep=0.75pt]    {$
\backslash
beta _{l} 
\backslash
Delta t$};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (270,150) node [anchor=north west][inner sep=0.75pt]    {$
\backslash
alpha $};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (48.5,62) node [anchor=north west][inner sep=0.75pt]   [align=left] {Electron
's trajectory};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (50.5,106) node [anchor=north west][inner sep=0.75pt]   [align=left]
 {Lattice's intensity
\backslash

\backslash
wavefront at different
\backslash

\backslash
times};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (288,126.4) node [anchor=north west][inner sep=0.75pt]    {$t_{1}$};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (288,257.4) node [anchor=north west][inner sep=0.75pt]    {$t_{2}$};
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
end{tikzpicture}
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Part
Numerics
\end_layout

\begin_layout Standard
In this part I will present small derivations that are required mainly when
 one comes to implement the calculations in real code, such as complexity
 and the derivation of small mathematical expressions.
\end_layout

\begin_layout Subsection
The integral to calculate 
\begin_inset Formula $G$
\end_inset

:
\end_layout

\begin_layout Standard
Let us calculate the exact expression we want to calculate when calculating
 the gauge function 
\begin_inset Formula $G$
\end_inset

:
\end_layout

\begin_layout Standard
Assume a gaussian beam's electromagnetic potential that is aligned with
 
\begin_inset Formula $\tilde{x}$
\end_inset

 axis is 
\begin_inset Formula $\tilde{A}\left(x,y,z,t\right)$
\end_inset

.
\end_layout

\begin_layout Standard
If 
\begin_inset Formula $\tilde{x}$
\end_inset

 is tilted by an angle 
\begin_inset Formula $\alpha$
\end_inset

 with the cavity (such that the positive 
\begin_inset Formula $\tilde{x}$
\end_inset

 is tilted towards the positive 
\begin_inset Formula $\tilde{z}$
\end_inset

 direction) then the potential in the lab's frame will be:
\begin_inset Formula 
\begin{equation}
\boldsymbol{A}\left(x,y,z,t\right)=\begin{pmatrix}\tilde{A}_{x}\cos\alpha+\tilde{A}_{z}\sin\alpha\\
A_{y}\\
-\tilde{A}_{x}\sin\alpha+\tilde{A}_{z}\cos\alpha
\end{pmatrix}\left(x\cos\alpha-z\sin\alpha,y,x\sin\alpha+z\cos\alpha\right)\tag{e\_37}\label{eq:e_37}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Therefore the integrand to calculate 
\begin_inset Formula $G$
\end_inset

 will be:
\begin_inset Formula 
\[
\text{Integrand}\left(x,y,z,t,T\right)=A_{z}\left(x,y,z-\beta c\left(t-T\right),T\right)=\left[-\tilde{A}_{x}\sin\alpha+A_{z}\cos\alpha\right]{\color{gray}\underset{\text{This is the argument of the function A, not a multiplication factor}}{\underbrace{{\normalcolor \left(x\cos\alpha-\left(z-\beta c\left(t-T\right)\right)\sin\alpha,y,x\sin\alpha+\left(z-\beta c\left(t-T\right)\right)\cos\alpha,T\right)}}}}
\]

\end_inset

Since we choose a gauge where 
\begin_inset Formula $\tilde{A_{x}}=0$
\end_inset

 then we are left with:
\begin_inset Formula 
\[
\cos\alpha\cdot\tilde{A}_{z}\left(x\cos\alpha-\left(z-\beta c\left(t-T\right)\right)\sin\alpha,y,x\sin\alpha+\left(z-\beta c\left(t-T\right)\right)\cos\alpha,T\right)=
\]

\end_inset


\end_layout

\begin_layout Standard
integral over 
\begin_inset Formula $T$
\end_inset

 will be:
\begin_inset Formula 
\begin{equation}
G=\cos\alpha\beta c\intop_{-\infty}^{T}\tilde{A}_{z}\left(x\cos\alpha-\left(z-\beta c\left(t-T\right)\right)\sin\alpha,y,x\sin\alpha+\left(z-\beta c\left(t-T\right)\right)\cos\alpha,T\right)dT\label{eq:A_for_G}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
Z & =z-\beta c\left(t-T\right) & \frac{1}{\beta c}dZ & =dT & T=t & \iff Z=z\\
T & =\frac{Z-z}{\beta c}+t
\end{align*}

\end_inset

And so the integral becomes:
\begin_inset Formula 
\begin{equation}
\boxed{G=\cos\alpha\intop_{-\infty}^{z}\tilde{A}_{z}\left(x\cos\alpha-Z\sin\alpha,y,x\sin\alpha+Z\cos\alpha,\frac{Z-z}{\beta c}+t\right)dZ\tag{e\_25}}\label{eq:e_25}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\begin{align*}
{\color{gray}\tilde{A}_{z}\left(x\cos\alpha-Z\sin\alpha,y,x\sin\alpha+Z\cos\alpha,\frac{Z-z}{\beta c}+t\right)} & {\color{gray}=\frac{w_{0}}{w\left(x\cos\alpha-Z\sin\alpha\right)}e^{\frac{-z^{2}}{w^{2}\left(x\cos\alpha-Z\sin\alpha\right)}}\cos\left(\frac{Z-z}{\beta c}+t\right)}\\
 & {\color{gray}=\frac{w_{0}}{w\left(x\cos\alpha-Z\sin\alpha\right)}e^{\frac{-z^{2}}{w^{2}\left(x\cos\alpha-Z\sin\alpha\right)}}\cos\left(\frac{Z}{\beta c}+\left(t-\frac{z}{\beta c}\right)\right)}
\end{align*}

\end_inset


\end_layout

\end_inset

Which is more comfortable in my eyes then integration over 
\begin_inset Formula $t$
\end_inset

.
\end_layout

\begin_layout Standard

\series bold
\color teal
If you search for the polarization term 
\begin_inset Formula $\cos\theta$
\end_inset

 - it is inside 
\begin_inset Formula $\tilde{A}_{z}$
\end_inset

.
\end_layout

\begin_layout Standard
This function appears in 
\end_layout

\begin_layout Subsubsection
The discrete interval 
\begin_inset Formula $dz$
\end_inset

 required for an accurate integration of 
\begin_inset Formula $A_{z}\left(z,t\left(z\right)\right)$
\end_inset

:
\end_layout

\begin_layout Standard
Let us calculate the typical rate of change (as a function of 
\begin_inset Formula $z$
\end_inset

) for a standing wave 
\begin_inset Formula $A$
\end_inset

 of the form:
\begin_inset Formula 
\[
A\left(z,t\right)=\cos\left(kx\right)\cos\left(\omega t\right)
\]

\end_inset

And for and electron passing in it in a velocity 
\begin_inset Formula $\beta c$
\end_inset


\end_layout

\begin_layout Standard
The time as a function of 
\begin_inset Formula $z$
\end_inset

, 
\begin_inset Formula $t\left(z\right)$
\end_inset

 is given by 
\begin_inset Formula $t\left(z\right)=\frac{z}{\beta c}$
\end_inset

.
\end_layout

\begin_layout Standard
And so 
\begin_inset Formula $A\left(z,t\left(z\right)\right)$
\end_inset

 is:
\begin_inset Formula 
\begin{align*}
A\left(z,t\left(z\right)\right) & =\cos\left(kz\right)\cos\left(\omega t\left(z\right)\right)\\
 & =\cos\left(kz\right)\cos\left({\color{green}\omega}\frac{z}{\beta{\color{green}c}}\right)\\
 & =\cos\left(kz\right)\cos\left(\frac{{\color{green}k}}{\beta}z\right)\\
 & =\frac{1}{2}\left[\cos\left(\left(1+\frac{1}{\beta}\right)kz\right)+\cos\left(\left(1-\frac{1}{\beta}\right)kz\right)\right]
\end{align*}

\end_inset

And so we see that for a monochromatic light the greatest wavelength experienced
 by the electron is 
\begin_inset Formula $k_{\text{eff}}=\left(1+\frac{1}{\beta}\right)k\Rightarrow\lambda_{\text{eff}}=\frac{\lambda}{1+\frac{1}{\beta}}$
\end_inset

.
\end_layout

\begin_layout Standard
Given this, we know 
\begin_inset Formula $dz$
\end_inset

 should be around:
\begin_inset Formula 
\begin{equation}
dz<\lambda_{\text{eff}}<\frac{\lambda}{1+\frac{1}{\beta}}\tag{e\_40}\label{eq:e_40}
\end{equation}

\end_inset

in practice, playing with it, I found that 
\begin_inset Formula $dz=\frac{\lambda}{3\left(1+\frac{1}{\beta}\right)}$
\end_inset

 is enough, and smaller 
\begin_inset Formula $dz$
\end_inset

 does not produce much different results.
\end_layout

\begin_layout Subsubsection
The derivative of 
\begin_inset Formula $G$
\end_inset

 with respect to 
\begin_inset Formula $z$
\end_inset

:
\end_layout

\begin_layout Standard
The definition of 
\begin_inset Formula $G$
\end_inset

:
\begin_inset Formula 
\[
G\left(z,t\right)=\intop_{-\infty}^{z}A_{z}\left(Z,t-\frac{z-Z}{\beta c}\right)dZ
\]

\end_inset


\end_layout

\begin_layout Standard
We have this 
\color blue
blue
\color red
 
\color inherit
term in the integral of the phase:
\begin_inset Formula 
\[
\phi=\intop_{-\infty}^{\infty}\left(A\left(z,t\left(z\right)\right)-{\color{blue}\nabla G\left(z,t\left(z\right)\right)}\right)^{2}\ldots dz
\]

\end_inset


\end_layout

\begin_layout Standard
Where 
\begin_inset Formula $t\left(z\right)={\color{gray}\underset{t\text{ at }z=0}{\underbrace{{\normalcolor t_{0}}}}}+\frac{z}{\beta c}$
\end_inset


\end_layout

\begin_layout Standard
note how the 
\begin_inset Formula $z$
\end_inset

'th component of the gradient is:
\begin_inset Formula 
\[
\lim_{dz\rightarrow0}\frac{G\left(z+dz,t\left(z\right)\right)-G\left(z,t\left(z\right)\right)}{dz}
\]

\end_inset


\series bold
And not:
\series default

\begin_inset Formula 
\[
\lim_{dz\rightarrow0}\frac{G\left(z+dz,t\left(z{\color{red}+dz}\right)\right)-G\left(z,t\left(z\right)\right)}{dz}
\]

\end_inset


\end_layout

\begin_layout Standard
Therefore:
\begin_inset Formula 
\begin{align}
G\left(z+dz,t\left(z\right)\right) & =\intop_{-\infty}^{z+dz}A_{z}\left(Z,t\left(z\right)-\frac{z+dz-Z}{\beta c}\right)dZ\nonumber \\
 & =\intop_{-\infty}^{z+dz}A_{z}\left(Z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)-\frac{z-Z}{\beta c}\right)\nonumber \\
 & =\intop_{-\infty}^{{\color{red}z}}A_{z}\left(Z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)-\frac{z-Z}{\beta c}\right)dZ+{\color{gray}\underset{\xrightarrow[dz\rightarrow0]{}A_{z}\left(z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)-\cancel{\frac{z-z}{\beta c}}\right)\cdot dz}{\underbrace{{\normalcolor \intop_{{\color{red}z}}^{z+dz}A_{z}\left(Z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)-\frac{z-Z}{\beta c}\right)}}}}\nonumber \\
 & =\intop_{-\infty}^{{\color{red}z}}A_{z}\left(Z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)-\frac{z-Z}{\beta c}\right)dZ+A_{z}\left(z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)\right)\cdot dz\nonumber \\
 & =G\left(z,t\left(z\right)-\frac{dz}{\beta c}\right)+A_{z}\left(z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)\right)\cdot dz\tag{e\_26}\label{eq:e_26}
\end{align}

\end_inset

And the derivative is:
\begin_inset Formula 
\begin{align}
\frac{\partial G}{\partial z} & =\lim_{dz\rightarrow0}\left[\frac{G\left(z,t\left(z\right)-\frac{dz}{\beta c}\right)+A_{z}\left(z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)\right)\cdot dz-G\left(z,t\left(z\right)\right)}{dz}\right]\nonumber \\
 & =\lim_{dz\rightarrow0}\left[\frac{G\left(z,t\left(z\right)-\frac{dz}{\beta c}\right)-G\left(z,t\left(z\right)\right)}{dz}\right]+A_{z}\left(z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)\right)\nonumber \\
\frac{\partial G}{\partial z} & =-\frac{1}{\beta c}\frac{\partial G}{\partial t}+A_{z}\left(z,\left(t\left(z\right)-\frac{dz}{\beta c}\right)\right)\label{eq:e_39}
\end{align}

\end_inset


\end_layout

\begin_layout Subsection
Addressing the complexity problem:
\begin_inset CommandInset label
LatexCommand label
name "subsec:Addressing the complexity problem"

\end_inset


\end_layout

\begin_layout Problem
We note that in the total phase acquired term 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_18"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 we have 
\begin_inset Formula $\intop_{z}\ldots\partial_{x}G\left(x,y,z,t\right)$
\end_inset

 where 
\begin_inset Formula $G$
\end_inset

 itself is an integral over 
\begin_inset Formula $\intop_{Z}A_{z}\left(x,y,Z,\frac{Z-z}{\beta c}+t\right)dZ$
\end_inset

.
\end_layout

\begin_layout Problem
It means that we have an integral inside a derivative inside an integral
 - which we need to calculate to a grid of 
\begin_inset Formula $n_{x}\times n_{y}$
\end_inset

 for many 
\begin_inset Formula $t$
\end_inset

's.
 since every integral calls it's integrand many times - it means that the
 inner most function 
\begin_inset Formula $A_{z}\left(x,y,z,t\right)$
\end_inset

 might be called (say, 
\begin_inset Formula $1000$
\end_inset

 times per integral and 
\begin_inset Formula $\left(1+3\right)$
\end_inset

 times for gradient): 
\begin_inset Formula $1000\cdot1000\cdot n_{x}\cdot n_{y}\cdot n_{t}\cdot4$
\end_inset

 which is a lot (for 
\begin_inset Formula $n_{x}\times n_{y}=1000\times1000$
\end_inset

).
\end_layout

\begin_layout Solution
However, we notice that when calculating 
\begin_inset Formula $G$
\end_inset

, the term 
\begin_inset Formula ${\color{teal}A_{z}\left(x,y,z_{1},t_{1}\right)}$
\end_inset

 is calculated many times: once in 
\begin_inset Formula $G\left(x,y,z_{2},t_{1}-\frac{z_{1}-z_{2}}{\beta c}\right)$
\end_inset

 (because when we run the integral over 
\begin_inset Formula $Z$
\end_inset

 and we get to 
\begin_inset Formula $Z=z_{1}$
\end_inset

 then the integrand is 
\begin_inset Formula 
\[
A_{z}\left(x,y,Z,t-\frac{z-Z}{\beta c}\right)=A_{z}\left(x,y,z_{1},t_{1}-\cancel{\frac{z_{1}-z_{2}}{\beta c}}-\cancel{\frac{z_{2}-z_{1}}{\beta c}}\right)={\color{teal}A_{z}\left(x,y,z_{1},t_{1}\right)}
\]

\end_inset

) and once again in 
\begin_inset Formula $G\left(x,y,z_{3},t_{1}-\frac{z_{1}-z_{3}}{\beta c}\right)$
\end_inset

, because also then for 
\begin_inset Formula $Z=z_{1}$
\end_inset

 we get::
\begin_inset Formula 
\[
A_{z}\left(x,y,Z,t-\frac{z-Z}{\beta c}\right)=A_{z}\left(x,y,z_{1},t_{1}-\cancel{\frac{z_{1}-z_{3}}{\beta c}}-\cancel{\frac{z_{3}-z_{1}}{\beta c}}\right)={\color{teal}A_{z}\left(x,y,z_{1},t_{1}\right)}
\]

\end_inset

So, in principle, we can calculate it once, and then use the same value
 repetitively for all integrals of the form 
\begin_inset Formula $G\left(x,y,z,t-\frac{z_{1}-z}{\beta c}\right)$
\end_inset

.
\end_layout

\begin_layout Solution
We can initiate a large array of 
\begin_inset Formula $A_{z}\left(x,y,z_{j},t_{k}\right)$
\end_inset

, and estimate the value of 
\begin_inset Formula $G$
\end_inset

 at:
\begin_inset Formula 
\[
G\left(x,y,z_{j},t_{k}\right)=\sum_{i=0}^{j}A_{z}\left(x,y,z_{i},t_{k}-\frac{z_{j}-{\color{gray}\overset{\equiv"Z"}{\overbrace{{\normalcolor z_{i}}}}}}{\beta c}\right)
\]

\end_inset

Defining a time-dimensional position 
\begin_inset Formula $\tilde{z}=\frac{z}{\beta c}$
\end_inset

, we can rewrite it as:
\begin_inset Formula 
\[
G\left(x,y,z_{j},t_{k}\right)=\sum_{i=0}^{j}A_{z}\left(x,y,z_{i},t_{k}-\left(\tilde{z}_{j}-\tilde{z}_{i}\right)\right)=\sum_{i=0}^{j}A_{z}\left(x,y,z_{i},\tilde{z}_{i}+t_{k}-\tilde{z}_{j}\right)
\]

\end_inset

If we choose the spacing in 
\begin_inset Formula $z$
\end_inset

 of the grid to be 
\begin_inset Formula $dz$
\end_inset

 and the spacing in 
\begin_inset Formula $t$
\end_inset

 of 
\begin_inset Formula $t$
\end_inset

 to be 
\begin_inset Formula $\beta c\cdot dz$
\end_inset

 then this translates to:
\begin_inset Formula 
\[
G\left(x,y,z_{j},t_{k}\right)=\sum_{i=0}^{j}A_{z}\left(x,y,z_{i},t_{i+\left(k-j\right)}\right)
\]

\end_inset


\end_layout

\begin_layout Solution
In matrix form, this equals summing the 
\begin_inset Formula $\left(k-j\right)$
\end_inset

-offset diagonal from the first row and until the 
\begin_inset Formula $j$
\end_inset

'th row:
\end_layout

\begin_layout Solution
For example, in 
\begin_inset Formula ${\color{red}j}={\color{red}4}$
\end_inset

 and 
\begin_inset Formula $k=6$
\end_inset

 (and in particular 
\begin_inset Formula $\left({\color{brown}k-j}={\color{brown}2}\right)$
\end_inset

) this is equal to summing all the blue elements:
\begin_inset Formula 
\[
{\color{green}G\left(z_{{\color{brown}3}},t_{{\color{brown}4}}\right)},{\color{blue}G\left(z_{{\color{red}4}}t_{{\color{red}6}}\right)}\Rightarrow
\]

\end_inset


\begin_inset Formula 
\[
\begin{array}{c|cccccccc}
 & t_{0} & t_{{\color{brown}1}} & t_{{\color{brown}{\color{red}2}}} & t_{3} & t_{4} & t_{5} & t_{6} & t_{7}\\
\hline z_{0} & A_{00} & {\color{green}A_{0{\color{brown}1}}} & {\color{blue}A_{0{\color{red}2}}} & A_{03}\\
z_{1} & A_{10} & A_{11} & {\color{green}A_{12}} & {\color{blue}A_{13}} & A_{14}\\
z_{2} &  &  &  & {\color{green}A_{23}} & {\color{blue}A_{24}} & A_{25}\\
z_{{\color{brown}3}} &  &  &  &  & {\color{green}A_{3{\color{brown}4}}} & {\color{blue}A_{35}} & A_{36}\\
z_{{\color{red}4}} &  &  &  &  &  & A_{45} & {\color{blue}A_{{\color{red}46}}} & A_{47}\\
z_{5} &  &  &  &  &  &  & A_{56} & A_{57}\\
z_{6}\\
z_{7}
\end{array}
\]

\end_inset

If the last array is achieved by evaluation 
\begin_inset Formula $A$
\end_inset

 on the arrays:
\begin_inset Formula 
\begin{align*}
A\left(Z,T\right) & \text{for:} & Z= & \begin{array}{cccc}
z_{0} & z_{0} & z_{0} & z_{0}\\
z_{1} & z_{1} & z_{1} & z_{1}\\
z_{2} & z_{2} & z_{2} & z_{2}\\
z_{3} & z_{3} & z_{3} & z_{3}
\end{array} & T= & \begin{array}{cccc}
t_{0} & t_{1} & t_{2} & t_{3}\\
t_{0} & t_{1} & t_{2} & t_{3}\\
t_{0} & t_{1} & t_{2} & t_{3}\\
t_{0} & t_{1} & t_{2} & t_{3}
\end{array}
\end{align*}

\end_inset

Therefore, we can 
\begin_inset Quotes eld
\end_inset

skew
\begin_inset Quotes erd
\end_inset

 this 
\begin_inset Formula $A$
\end_inset

 array by replacing the 
\begin_inset Formula $T$
\end_inset

 matrix like so:
\begin_inset Formula 
\[
T\rightarrow T^{\prime}=T+\frac{Z}{\beta c}
\]

\end_inset


\begin_inset Formula 
\[
\begin{array}{cccc}
t_{0} & t_{1} & t_{2} & t_{3}\\
t_{0} & t_{1} & t_{2} & t_{3}\\
t_{0} & t_{1} & t_{2} & t_{3}\\
t_{0} & t_{1} & t_{2} & t_{3}
\end{array}\rightarrow\begin{array}{cccc}
t_{0}+\frac{z_{0}}{\beta c} & t_{1}+\frac{z_{0}}{\beta c} & t_{2}+\frac{z_{0}}{\beta c} & t_{3}+\frac{z_{0}}{\beta c}\\
t_{0}+\frac{z_{1}}{\beta c} & t_{1}+\frac{z_{1}}{\beta c} & t_{2}+\frac{z_{1}}{\beta c} & t_{3}+\frac{z_{1}}{\beta c}\\
t_{0}+\frac{z_{2}}{\beta c} & t_{1}+\frac{z_{2}}{\beta c} & t_{2}+\frac{z_{2}}{\beta c} & t_{3}+\frac{z_{2}}{\beta c}\\
t_{0}+\frac{z_{3}}{\beta c} & t_{1}+\frac{z_{3}}{\beta c} & t_{2}+\frac{z_{3}}{\beta c} & t_{3}+\frac{z_{3}}{\beta c}
\end{array}=\begin{array}{cccc}
t_{0} & t_{1} & t_{2} & t_{3}\\
t_{0} & t_{2} & t_{3} & t_{4}\\
t_{0} & t_{3} & t_{4} & t_{5}\\
t_{0} & t_{4} & t_{5} & t_{6}
\end{array}
\]

\end_inset

While keeping the 
\begin_inset Formula $z$
\end_inset

 matrix as:
\begin_inset Formula 
\[
Z\rightarrow Z
\]

\end_inset

Then evaluating 
\begin_inset Formula $A$
\end_inset

 on the new array 
\begin_inset Formula $T$
\end_inset

 like so:
\begin_inset Formula 
\[
A\left(Z,T^{\prime}\right)
\]

\end_inset

will result in a skewed 
\begin_inset Formula $A$
\end_inset

 like so:
\begin_inset Formula 
\[
A\left(Z,T^{\prime}\right)=\begin{array}{c|ccccc}
 & t_{0}+\frac{Z}{\beta c} & t_{{\color{brown}1}}+\frac{Z}{\beta c} & t_{{\color{red}2}}+\frac{Z}{\beta c} & t_{3}+\frac{Z}{\beta c} & t_{4}+\frac{Z}{\beta c}\\
\hline z_{0} & A_{00} & {\color{green}A_{0{\color{brown}1}}} & {\color{blue}A_{0{\color{red}2}}} & A_{03}\\
z_{1} & A_{11} & {\color{green}A_{12}} & {\color{blue}A_{13}} & A_{14}\\
z_{2} & A_{22} & {\color{green}A_{23}} & {\color{blue}A_{24}} & A_{25}\\
z_{{\color{brown}3}} & A_{33} & {\color{green}A_{{\color{brown}34}}} & {\color{blue}A_{35}} & A_{36}\\
z_{{\color{red}4}} & A_{44} & A_{45} & {\color{blue}A_{{\color{red}46}}} & A_{47}\\
z_{5}\\
z_{6}\\
z_{7}
\end{array}
\]

\end_inset

And now the value of 
\begin_inset Formula $G$
\end_inset

 can be achieved by simply taking the cumulative integral:
\begin_inset Formula 
\[
G=\texttt{np.cumsum(A(Z,T'),axis=0)}=\begin{array}{c|ccccc}
 & t_{0}+\frac{Z}{\beta c} & t_{1}+\frac{Z}{\beta c} & t_{2}+\frac{Z}{\beta c} & t_{3}+\frac{Z}{\beta c} & t_{4}+\frac{Z}{\beta c}\\
\hline z_{0} & G_{00} & G_{01} & G_{02} & G_{03}\\
z_{1} & G_{11} & G_{12} & G_{13} & G_{14}\\
z_{2} & G_{22} & G_{23} & G_{24} & G_{25}\\
z_{3} & G_{33} & {\color{green}G_{{\color{brown}34}}} & G_{35} & G_{36}\\
z_{4} & G_{44} & G_{45} & {\color{blue}G_{{\color{red}46}}} & G_{47}\\
z_{5}\\
z_{6}\\
z_{7}
\end{array}
\]

\end_inset

In particular the 
\family typewriter
np.cumsum
\family default
 command will give us in each column the values of 
\begin_inset Formula $G\left(z,t\left(z\right)\right)$
\end_inset

 as required for the final integral of 
\begin_inset Formula $\phi$
\end_inset

.
\end_layout

\begin_layout Subsubsection
Shift and scale of the 
\begin_inset Formula $z$
\end_inset

 axis along which we integrate:
\end_layout

\begin_layout Standard
Since the laser has a gaussian intensity profile, we wish to integrate mostly
 around the center of the intensity.
 Since the width of the intensity varies for different 
\begin_inset Formula $x$
\end_inset

 values, we wish to adjust the interval 
\begin_inset Formula $\left[z_{\min},z_{\max}\right]$
\end_inset

 for different 
\begin_inset Formula $x$
\end_inset

 values.
\end_layout

\begin_layout Standard
Additionaly, we want to shift is to always be centered around the center
 of the spot, which is not always at 
\begin_inset Formula $z=0$
\end_inset

, since the cavity is tilted.
\end_layout

\begin_layout Standard
The intensity width goes like 
\begin_inset Formula $w\left(x\right)$
\end_inset

 in the cavity's axis, and therefore in the lab's axis (with respect to
 which the cavity's axes are rotated by an angle 
\begin_inset Formula $\alpha$
\end_inset

), the width will be approximately 
\begin_inset Formula $\frac{w\left(x\right)}{\cos\left(\alpha\right)}$
\end_inset

.
\end_layout

\begin_layout Standard
If we wish to integrate along 
\begin_inset Formula $\pm5\sigma$
\end_inset

 of the intensity, then we get in total that the formula is (and a drawing
 to emphasize it right afterwards):
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\left[z_{\min},z_{\max}\right]\left(x_{\text{lab}}\right)=\left[{\color{brown}z_{\text{center}}\left(x\right)}-{\color{teal}5w_{\text{lab}}\left(x\right)},{\color{brown}z_{\text{center}}\left(x\right)}+{\color{teal}5w_{\text{lab}}\left(x\right)}\right]=\left[{\color{brown}x\tan\left(\alpha\right)}-{\color{teal}5\frac{w\left(\frac{x}{\cos\alpha}\right)}{\cos\alpha}},{\color{brown}x\tan\left(\alpha\right)}+{\color{teal}5\frac{w\left(\frac{x}{\cos\alpha}\right)}{\cos\alpha}}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
Those claculation take part in 
\family typewriter
CavityNumericalPropagator.generate_z_vector
\family default
 and
\begin_inset Newline newline
\end_inset


\family typewriter
CavityNumericalPropagator
\family default
.
\family typewriter
generate_coordinates_lattice
\family default
.
\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
tikzset{every picture/.style={line width=0.75pt}} %set default line width
 to 0.75pt        
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
\end_layout

\begin_layout Plain Layout

%uncomment if require: 
\backslash
path (0,1283); %set diagram left start at 0, and has height of 1283
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp4706962850885832] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (88.95,1016.06) ..
 controls (93.43,977.8) and (106.16,939.89) ..
 (127.79,904.98) ..
 controls (147.94,872.44) and (173.86,845.64) ..
 (203.41,825.11) -- (358.33,1047.76) -- cycle ; 
\backslash
draw  [color={rgb, 255:red, 80; green, 110; blue, 146 }  ,draw opacity=0.65
 ] (88.95,1016.06) ..
 controls (93.43,977.8) and (106.16,939.89) ..
 (127.79,904.98) ..
 controls (147.94,872.44) and (173.86,845.64) ..
 (203.41,825.11) ;  
\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp7511853212311856] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (488.94,1265.46) ..
 controls (521.19,1244.4) and (549.46,1216.11) ..
 (571.08,1181.19) ..
 controls (591.23,1148.65) and (603.67,1113.51) ..
 (608.89,1077.9) -- (340.53,1038.42) -- cycle ; 
\backslash
draw  [color={rgb, 255:red, 80; green, 110; blue, 146 }  ,draw opacity=0.65
 ] (488.94,1265.46) ..
 controls (521.19,1244.4) and (549.46,1216.11) ..
 (571.08,1181.19) ..
 controls (591.23,1148.65) and (603.67,1113.51) ..
 (608.89,1077.9) ;  
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp486517813017733] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (605.19,1100.01) ..
 controls (526.89,1083.07) and (450.1,1052.69) ..
 (378.1,1008.1) ..
 controls (302.67,961.38) and (238.85,903.01) ..
 (187.54,836.75) -- (757.72,395.11) -- cycle ; 
\backslash
draw  [color={rgb, 255:red, 212; green, 109; blue, 121 }  ,draw opacity=1
 ] (605.19,1100.01) ..
 controls (526.89,1083.07) and (450.1,1052.69) ..
 (378.1,1008.1) ..
 controls (302.67,961.38) and (238.85,903.01) ..
 (187.54,836.75) ;  
\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp6153354127841617] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (515.91,1246.91) ..
 controls (465.85,1184.36) and (404.44,1129.15) ..
 (332.44,1084.56) ..
 controls (257,1037.85) and (176.31,1006.73) ..
 (94.13,990.32) -- (-47.19,1697.55) -- cycle ; 
\backslash
draw  [color={rgb, 255:red, 212; green, 109; blue, 121 }  ,draw opacity=1
 ] (515.91,1246.91) ..
 controls (465.85,1184.36) and (404.44,1129.15) ..
 (332.44,1084.56) ..
 controls (257,1037.85) and (176.31,1006.73) ..
 (94.13,990.32) ;  
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da4665721156143676] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 56; green, 154; blue, 119 }  ,draw opacity=1
 ]   (335.88,957.28) -- (335.88,1112.4) ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da8884817206656099] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 56; green, 154; blue, 119 }  ,draw opacity=1
 ]   (253.2,870) -- (253.2,1093.73) ;
\end_layout

\begin_layout Plain Layout

%Curve Lines [id:da1005169813179072] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 128; green, 128; blue, 128 }  ,draw opacity=1
 ]   (245.31,1093.48) ..
 controls (220.05,1093.17) and (205.59,1010.64) ..
 (222.16,988.5) ..
 controls (222.16,988.5) and (206.03,975.36) ..
 (206.03,975.36) ..
 controls (206.03,975.36) and (222.47,963.8) ..
 (222.47,963.8) ..
 controls (206.46,940.07) and (223.63,869.7) ..
 (248.08,870) ;
\end_layout

\begin_layout Plain Layout

%Curve Lines [id:da9797867537049694] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 128; green, 128; blue, 128 }  ,draw opacity=1
 ]   (341.23,1110.35) ..
 controls (358.44,1110.14) and (368.29,1053.92) ..
 (357,1038.83) ..
 controls (357,1038.83) and (367.99,1029.88) ..
 (367.99,1029.88) ..
 controls (367.99,1029.88) and (356.79,1022) ..
 (356.79,1022) ..
 controls (367.69,1005.84) and (355.99,957.9) ..
 (339.34,958.1) ;
\end_layout

\begin_layout Plain Layout

%Shape: Ellipse [id:dp2850907647879364] 
\end_layout

\begin_layout Plain Layout


\backslash
draw (333.97,1036.11) node(x){}  [color={rgb, 255:red, 65; green, 117; blue,
 5 }  ,draw opacity=1 ][fill={rgb, 255:red, 65; green, 117; blue, 5 }  ,fill
 opacity=1 ] (333.97,1036.11) ..
 controls (333.97,1034.67) and (335.14,1033.5) ..
 (336.58,1033.5) ..
 controls (338.02,1033.5) and (339.19,1034.67) ..
 (339.19,1036.11) ..
 controls (339.19,1037.55) and (338.02,1038.71) ..
 (336.58,1038.71) ..
 controls (335.14,1038.71) and (333.97,1037.55) ..
 (333.97,1036.11) -- cycle ;
\end_layout

\begin_layout Plain Layout

%Shape: Ellipse [id:dp8806257636025729] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 65; green, 117; blue, 5 }  ,draw opacity=1 ][fill={rg
b, 255:red, 65; green, 117; blue, 5 }  ,fill opacity=1 ] (251.37,984.97) ..
 controls (251.37,983.61) and (252.48,982.5) ..
 (253.85,982.5) ..
 controls (255.21,982.5) and (256.32,983.61) ..
 (256.32,984.97) ..
 controls (256.32,986.34) and (255.21,987.44) ..
 (253.85,987.44) ..
 controls (252.48,987.44) and (251.37,986.34) ..
 (251.37,984.97) -- cycle ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da19191212610614783] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0.19 ] 
  (127.41,905.4) -- (251.85,982.97) -- (336.27,1035.6) -- (570.99,1181.94) ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da4608470972960743] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0.19 ] 
  (x.east) -- +(0:5cm) ;  % (x.east) + (100,0)(664,1082)
\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp28653026255979386] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (457.37,1082.39) ..
 controls (457.29,1090.61) and (454.73,1098.27) ..
 (450.37,1104.7) -- (414.01,1082) -- cycle ;
\end_layout

\begin_layout Plain Layout


\backslash
draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0.19 ]
 (380,1036.83) ..
 controls (379.92,1045.06) and (377.36,1052.71) ..
 (373,1059.14) ;  
\end_layout

\begin_layout Plain Layout

%Shape: Rectangle [id:dp620931617323325] 
\end_layout

\begin_layout Plain Layout


\backslash
draw   (406.33,805.94) -- (642.58,805.94) -- (642.58,940.94) -- (406.33,940.94)
 -- cycle ;
\end_layout

\begin_layout Plain Layout

%Straight Lines [id:da5446122042604924] 
\end_layout

\begin_layout Plain Layout


\backslash
draw [color={rgb, 255:red, 56; green, 154; blue, 119 }  ,draw opacity=1
 ]   (419,825.28) -- (419,853.28) ;
\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp18666544293171095] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (425.94,889.51) ..
 controls (418.8,886.67) and (413,881.17) ..
 (409.78,874.23) -- (437,861.61) -- cycle ; 
\backslash
draw  [color={rgb, 255:red, 212; green, 109; blue, 121 }  ,draw opacity=1
 ] (425.94,889.51) ..
 controls (418.8,886.67) and (413,881.17) ..
 (409.78,874.23) ;  
\end_layout

\begin_layout Plain Layout

%Shape: Arc [id:dp7033357697936864] 
\end_layout

\begin_layout Plain Layout


\backslash
draw  [draw opacity=0] (410.44,927.22) ..
 controls (413.27,920.07) and (418.77,914.28) ..
 (425.71,911.05) -- (438.33,938.28) -- cycle ; 
\backslash
draw  [color={rgb, 255:red, 80; green, 110; blue, 146 }  ,draw opacity=0.65
 ] (410.44,927.22) ..
 controls (413.27,920.07) and (418.77,914.28) ..
 (425.71,911.05) ;  
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (435.33,820.28) node [anchor=north west][inner sep=0.75pt]  [xscale=1,yscale=1
] [align=left] {curves along which we do
\backslash

\backslash
the integration};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (434.67,879.61) node [anchor=north west][inner sep=0.75pt]  [xscale=1,yscale=1
] [align=left] {Laser intensity profile};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (434.67,913.28) node [anchor=north west][inner sep=0.75pt]  [xscale=1,yscale=1
] [align=left] {Mirrors};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (370.98,1015) node [anchor=north west][inner sep=0.75pt]  [font=
\backslash
normalsize,xscale=1,yscale=1]  {$
\backslash
frac{10
\backslash
cdot w(
\backslash
frac{x_{1}}{
\backslash
cos
\backslash
alpha})}{
\backslash
cos( 
\backslash
alpha )}$};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (261.84,975.92) node [anchor=north west][inner sep=0.75pt]  [font=
\backslash
normalsize,xscale=1,yscale=1]  {$x_{2}
\backslash
tan
\backslash
left(
\backslash
alpha
\backslash
right)$};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (273,1025.71) node [anchor=north west][inner sep=0.75pt]  [font=
\backslash
normalsize,xscale=1,yscale=1]  {$x_{1}
\backslash
tan
\backslash
left(
\backslash
alpha
\backslash
right)$};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (x)+(10:0.7cm) node [anchor=north west][inner sep=0.75pt]  [font=
\backslash
normalsize,xscale=1,yscale=1]  {$
\backslash
alpha $};
\end_layout

\begin_layout Plain Layout

% Text Node
\end_layout

\begin_layout Plain Layout


\backslash
draw (150,960) node [anchor=north west][inner sep=0.75pt]  [font=
\backslash
normalsize,xscale=1,yscale=1]  {$
\backslash
frac{10
\backslash
cdot w(
\backslash
frac{x_{2}}{
\backslash
cos
\backslash
alpha})}{
\backslash
cos( 
\backslash
alpha )}$};
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout


\backslash
end{tikzpicture}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Calculating the zero'th energy amplitude with just 3 points in time:
\begin_inset CommandInset label
LatexCommand label
name "subsec:Calculating-the-zero'th energy amplitude"

\end_inset


\end_layout

\begin_layout Standard
We have a phase of the form:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\phi\left(x,y,t\right)=\phi_{\text{const}}\left(x,y\right)+C\left(x,y\right)\cdot\sin\left(\Delta\omega t+\varphi\left(x,y\right)\right)
\]

\end_inset

Since 
\begin_inset Formula $x,y$
\end_inset

 do not play a role in this equation, and we are going to do the calculation
 to all pairs of 
\begin_inset Formula $x,y$
\end_inset

 separately, then we can omit them for abbreviation: 
\begin_inset Formula $C\left(x,y\right)\rightarrow C,\ \ \phi_{\text{const}}\left(x,y\right)\rightarrow\phi_{\text{const}}$
\end_inset

 
\begin_inset Formula 
\[
\phi\left(t\right)=\phi_{\text{const}}+C\cdot\sin\left(\Delta\omega t+\varphi\right)
\]

\end_inset

We can evaluate the function in three different points in time:
\begin_inset Formula 
\begin{align*}
t_{0} & =0\\
t_{1} & =\frac{\pi}{2\Delta\omega}\\
t_{2} & =\frac{\pi}{\Delta\omega}
\end{align*}

\end_inset

So that:
\begin_inset Formula 
\begin{alignat*}{2}
\phi\left(t_{0}\right) & =\phi_{\text{const}}+C\sin\left(0+\varphi\right) & =\phi_{\text{const}}+C\sin\left(\varphi\right)\\
\phi\left(t_{1}\right) & =\phi_{\text{const}}+C\sin\left(\frac{\pi}{2\cancel{\Delta\omega}}\cancel{\Delta\omega}+\varphi\right) & =\phi_{\text{const}}+C\cos\left(\varphi\right)\\
\phi\left(t_{2}\right) & =\phi_{\text{const}}+C\sin\left(\frac{\pi}{\cancel{\Delta\omega}}\cancel{\Delta\omega}+\varphi\right) & =\phi_{\text{const}}-C\sin\left(\varphi\right)
\end{alignat*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\phi\left(t_{0}\right) & =\phi_{\text{const}}+\cancel{C\sin\left(\varphi\right)}\\
\phi\left(t_{2}\right) & =\phi_{\text{const}}-\cancel{C\sin\left(\varphi\right)}{\color{gray}\ \backslash+}
\end{align*}

\end_inset


\begin_inset Formula 
\[
\boxed{\phi_{\text{const}}=\frac{\phi\left(t_{0}\right)+\phi\left(t_{2}\right)}{2}}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
\phi\left(t_{0}\right) & =\phi_{\text{const}}+C\sin\left(\varphi\right){\color{gray}\ \backslash-\phi_{\text{const}}}\\
\phi\left(t_{1}\right) & =\phi_{\text{const}}+C\cos\left(\varphi\right){\color{gray}\ \backslash-\phi_{\text{const}}}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\phi\left(t_{0}\right)-\phi_{\text{const}} & =\cancel{C}\sin\left(\varphi\right)\\
\phi\left(t_{1}\right)-\phi_{\text{const}} & =\cancel{C}\cos\left(\varphi\right){\color{gray}\ \backslash:}
\end{align*}

\end_inset


\begin_inset Formula 
\[
\tan\left(\varphi\right)=\frac{\phi\left(t_{0}\right)-\phi_{\text{const}}}{\phi\left(t_{1}\right)-\phi_{\text{const}}}{\color{gray}\ \backslash\tan^{-1}}
\]

\end_inset


\begin_inset Formula 
\[
\boxed{\varphi=\tan^{-1}\left(\frac{\phi\left(t_{0}\right)-\phi_{\text{const}}}{\phi\left(t_{1}\right)-\phi_{\text{const}}}\right)}
\]

\end_inset

And now if 
\begin_inset Formula $\varphi$
\end_inset

 is very close to 
\begin_inset Formula $0$
\end_inset

 or 
\begin_inset Formula $\pi$
\end_inset

 we substitute it in the equation for 
\begin_inset Formula $\phi\left(t_{1}\right)$
\end_inset

:
\begin_inset Formula 
\begin{equation}
\boxed{C={\color{gray}\underset{\text{All are known by this point}}{\underbrace{{\normalcolor \frac{\phi\left(t_{1}\right)-\phi_{\text{const}}}{\cos\left(\varphi\right)}}}}}}\tag{e\_27}\label{eq:e_27}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
And otherwise we can substitute it in the equation for
\begin_inset Formula $\phi\left(t_{0}\right)$
\end_inset

 and get:
\begin_inset Formula 
\[
\boxed{C={\color{gray}\underset{\text{All are known by this point}}{\underbrace{{\normalcolor \frac{\phi\left(t_{0}\right)-\phi_{\text{const}}}{\sin\left(\varphi\right)}}}}}}
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Extracting 
\begin_inset Formula $C$
\end_inset

 and 
\begin_inset Formula $\phi_{\text{const}}$
\end_inset

 of another amplitude from previous calculation
\end_layout

\begin_layout Standard
Suppose we once calculated 
\begin_inset Formula $\phi_{\text{const}}$
\end_inset

 and 
\begin_inset Formula $C$
\end_inset

 from the previous section for some 
\begin_inset Formula $E_{1}$
\end_inset

, and now we wish to do the same calculation for the same setup but with
 a different 
\begin_inset Formula $E_{1}$
\end_inset

.
\end_layout

\begin_layout Standard
From equation 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_3"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 we see that the total phase shift is given by an expression of the form:
\begin_inset Formula 
\[
\phi\left(x,y,z,t_{0}\right)=\intop\left|I\left(x,y,z,t_{0}\right)\right|^{2}dx
\]

\end_inset

Since this term is a sum of two lasers, each one contributing to the integrand
 an expression of the form 
\begin_inset Formula $I_{1,2}\left(t_{0},z\right)e^{i\omega_{1,2}t_{0}}$
\end_inset

, we get:
\begin_inset Formula 
\begin{align*}
\intop\left|I\left(t_{0},z\right)\right|^{2}dz & =\intop\left|I_{1}\left(t_{0},z\right)e^{i\omega_{1}t_{0}}+I_{2}\left(t_{0},z\right)e^{i\omega_{1}t_{0}}\right|^{2}dz\\
 & =\intop\left|I_{1}^{2}\right|\left(t_{0},z\right)+\left|I_{2}^{2}\right|\left(t_{0},z\right)+2\cos\left(\Delta\omega t_{0}\right)\cdot\left|I_{1}\left(t_{0},z\right)I_{2}\left(t_{0},z\right)\right|dz
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
And if 
\begin_inset Formula $I_{1,2}^{2}$
\end_inset

 go like some 
\begin_inset Formula $E_{0}^{2}$
\end_inset

 (for both 
\begin_inset Formula $_{1}$
\end_inset

 and 
\begin_inset Formula $_{2}$
\end_inset

, as in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:E_0_def"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
) so it is of the form:
\begin_inset Formula 
\[
I_{i}^{2}=\hat{I}_{i}^{2}\cdot E_{0}^{2}
\]

\end_inset

then we can express the integral as:
\begin_inset Formula 
\[
\intop\left|I\left(t_{0}+\Delta t,z\right)\right|^{2}dz=E_{0}^{2}\intop_{z}\left|I_{1}^{2}\right|\left(t_{0},z\right)+\left|I_{2}^{2}\right|\left(t_{0},z\right)dz+E_{0}^{2}2\cos\left(\Delta\omega t_{0}\right)\intop_{z}\left|I_{1}\left(t_{0},z\right)I_{2}\left(t_{0},z\right)\right|dz
\]

\end_inset

And therefore we see that under increase of 
\begin_inset Formula $E_{0}\rightarrow E_{0}^{\prime}$
\end_inset

 we will have separate increase of:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left\{ \phi_{\text{const}}\left(E\right),C\left(E_{0}\right)\right\} \xrightarrow[E_{0}\rightarrow E_{0}^{\prime}]{}\left\{ \phi_{\text{const}}\left(E_{0}\right)\cdot\left(\frac{E_{0}^{\prime}}{E_{0}}\right)^{2},C\left(E_{0}\right)\cdot\left(\frac{E_{0}^{\prime}}{E_{0}}\right)^{2}\right\} \tag{e\_42}\label{eq:e_42}
\end{equation}

\end_inset

Checking the difference between the extrapolated value according to 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_42"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
 and the actual value achieved by calculating everything again, for amplitudes
 save in a 
\family typewriter
:.5g
\family default
 accuracy, resulted in relative errors of around 
\begin_inset Formula $10^{-4}$
\end_inset

 (between the value calculated again and the value achieved by extrapolation).
\end_layout

\begin_layout Subsection
Extracting the amplitude required for a given phase shift based on one sample
\end_layout

\begin_layout Standard
Suppose the phase shift given to the electron as a function of the amplitude
 is:
\begin_inset Formula 
\[
\phi=aE^{2}
\]

\end_inset

For some unknown 
\begin_inset Formula $a$
\end_inset

.
\end_layout

\begin_layout Standard
If we evaluate the function once, we get:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\phi_{1}=aE_{1}^{2}{\color{lightgray}\ \backslash:E_{1}^{2}}
\]

\end_inset

Isolating 
\begin_inset Formula $a$
\end_inset

, we get:
\begin_inset Formula 
\[
a=\frac{\phi_{1}}{E_{1}^{2}}
\]

\end_inset

Now, we are interesting in the amplitude that will result in 
\begin_inset Formula $\phi_{2}=\frac{\pi}{2}$
\end_inset

 phase shift:
\begin_inset Formula 
\[
\frac{\pi}{2}=\phi_{2}=aE_{2}^{2}=\frac{\phi_{1}}{E_{1}^{2}}E_{2}^{2}{\color{lightgray}\ \backslash:\frac{\phi_{1}}{E_{1}^{2}}}
\]

\end_inset

Isolate 
\begin_inset Formula $E_{2}$
\end_inset

:
\begin_inset Formula 
\[
\frac{E_{1}^{2}}{\phi_{1}}\phi_{2}=E_{2}^{2}{\color{lightgray}\ \backslash\sqrt{}}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\boxed{E_{2}=E_{1}\sqrt{\frac{\phi_{2}}{\phi_{1}}}}\tag{e\_41}\label{eq:e_41}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Power to amplitude relation
\end_layout

\begin_layout Standard
If the gaussian beam has the shape:
\begin_inset Formula 
\[
E=E_{0}\cdot\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}+z^{2}}{w^{2}\left(x\right)}}\cdot e^{i\varphi\left(x,y,z\right)}
\]

\end_inset


\end_layout

\begin_layout Standard
Then the field squared has the form:
\begin_inset Formula 
\[
\left|E\right|^{2}=E_{0}^{2}\cdot\frac{w_{0}^{2}}{w^{2}\left(x\right)}e^{-2\frac{y^{2}+z^{2}}{w^{2}\left(x\right)}}=E_{0}^{2}\cdot\frac{w_{0}^{2}}{w^{2}\left(x\right)}e^{-\frac{y^{2}+z^{2}}{2\left(\frac{w\left(x\right)}{2}\right)^{2}}}
\]

\end_inset

And for 
\begin_inset Formula $x=0$
\end_inset

 we have: (using the Intensity definition from 
\bar under
\color blue

\begin_inset CommandInset href
LatexCommand href
name "wikipedia"
target "https://en.wikipedia.org/wiki/Intensity_(physics)"
literal "false"

\end_inset


\bar default
\color inherit
)
\begin_inset Formula 
\[
I\left(0,y,z\right)=\frac{c\varepsilon_{0}}{2}\cdot\left|E\right|^{2}=\frac{c\varepsilon_{0}}{2}E_{0}^{2}\cancel{\frac{w_{0}^{2}}{w_{0}^{2}}}e^{-\frac{y^{2}+z^{2}}{2\left(\frac{w_{0}}{2}\right)^{2}}}=\frac{c\varepsilon_{0}}{2}E_{0}^{2}e^{-\frac{y^{2}+z^{2}}{2\left(\frac{w_{0}}{2}\right)^{2}}}={\color{green}\left(\sqrt{2\pi}\cdot\frac{w_{0}}{2}\right)^{2}}\frac{c\varepsilon_{0}}{2}E_{0}^{2}\frac{1}{{\color{green}\sqrt{2\pi}\cdot\frac{w_{0}}{2}}}e^{-\frac{y^{2}}{2\left(\frac{w_{0}}{2}\right)^{2}}}\cdot\frac{1}{{\color{green}\sqrt{2\pi}\cdot\frac{w_{0}}{2}}}e^{-\frac{z^{2}}{2\left(\frac{w_{0}}{2}\right)^{2}}}=
\]

\end_inset

Integrating over 
\begin_inset Formula $dy,dz$
\end_inset

 we get:
\begin_inset Formula 
\[
P=\intop_{y,z}I\left(0,y,z\right)dydz=\intop_{{\color{brown}y},{\color{teal}z}}\left(\sqrt{2\pi}\cdot\frac{w_{0}}{2}\right)^{2}\frac{c\varepsilon_{0}}{2}E_{0}^{2}{\color{brown}\frac{1}{\sqrt{2\pi}\cdot\frac{w_{0}}{2}}e^{-\frac{y^{2}}{2\left(\frac{w_{0}}{2}\right)^{2}}}}\cdot{\color{teal}\frac{1}{\sqrt{2\pi}\cdot\frac{w_{0}}{2}}e^{-\frac{z^{2}}{2\left(\frac{w_{0}}{2}\right)^{2}}}}{\color{brown}dy}{\color{teal}dz}=
\]

\end_inset


\begin_inset Formula 
\[
=\left(\sqrt{2\pi}\cdot\frac{w_{0}}{2}\right)^{2}E_{0}^{2}\frac{c\varepsilon_{0}}{2}{\color{gray}\underset{=1}{\underbrace{{\normalcolor {\color{brown}\intop_{y}\frac{1}{\sqrt{2\pi}\cdot\frac{w_{0}}{2}}e^{-\frac{y^{2}}{2\left(\frac{w_{0}}{2}\right)^{2}}}dy}}}}}\cdot{\color{gray}\underset{=1}{\underbrace{{\normalcolor {\color{teal}\intop_{z}\frac{1}{\sqrt{2\pi}\cdot\frac{w_{0}}{2}}e^{-\frac{z^{2}}{2\left(\frac{w_{0}}{2}\right)^{2}}}dz}}}}}=
\]

\end_inset


\begin_inset Formula 
\[
=\left(\sqrt{2\pi}\cdot\frac{w_{0}}{2}\right)^{2}\frac{c\varepsilon_{0}}{2}E_{0}^{2}=
\]

\end_inset


\begin_inset Formula 
\begin{equation}
P=\frac{\pi c\varepsilon_{0}w_{0}^{2}}{4}E_{0}^{2}\iff\frac{4}{\pi c\varepsilon_{0}w_{0}^{2}}P=E_{0}^{2}\label{eq:e_44}
\end{equation}

\end_inset

If, alternatively, we have a standing wave of the form:
\begin_inset Formula 
\[
E=E_{0}\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}+z^{2}}{w_{0}^{2}}}\cos\left(\varphi\left(x,y,z\right)\right)=\frac{1}{2}E_{0}\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}+z^{2}}{w_{0}^{2}}}e^{i\varphi\left(x,y,z\right)}+\frac{1}{2}E_{0}\frac{w_{0}}{w\left(x\right)}e^{-\frac{y^{2}+z^{2}}{w_{0}^{2}}}e^{-i\varphi\left(x,y,z\right)}
\]

\end_inset

Then the power of each one of the moving wave will be:
\begin_inset Formula 
\begin{equation}
P=\frac{\pi c\varepsilon_{0}w_{0}^{2}}{4}\left(\frac{E_{0}}{2}\right)^{2}=\frac{1}{4}\cdot\frac{\pi c\varepsilon_{0}w_{0}^{2}}{4}E_{0}^{2}\iff4\cdot\frac{4}{\pi c\varepsilon_{0}w_{0}^{2}}\cdot P=E_{0}^{2}\label{eq:e_45}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Or Also:
\begin_inset Formula 
\begin{align*}
P & =\intop_{y,z}I\left(0,y,z\right)dydz\\
= & \intop_{y,z}\frac{c\varepsilon_{0}}{2}E_{0}^{2}e^{-\frac{y^{2}+z^{2}}{\frac{1}{2}w_{0}^{2}}}dydz\\
=\frac{c\varepsilon_{0}}{2}E_{0}^{2} & \intop_{\theta}\intop_{r}e^{-\frac{r^{2}}{\left(\frac{w_{0}}{\sqrt{2}}\right)^{2}}}drrd\theta\\
= & 2\pi\frac{c\varepsilon_{0}}{2}E_{0}^{2}\intop_{\tilde{r}}re^{-\left(\frac{r}{\left(\frac{w_{0}}{\sqrt{2}}\right)}\right)^{2}}dr\\
\stackrel{r\rightarrow\tilde{r}=\frac{r}{\left(\frac{w_{0}}{\sqrt{2}}\right)}}{=} & 2\pi\left(\frac{w_{0}}{\sqrt{2}}\right)^{2}\frac{c\varepsilon_{0}}{2}E_{0}^{2}\intop_{\tilde{r}}\tilde{r}e^{-\tilde{r}^{2}}d\tilde{r}\\
\stackrel{\tilde{r}^{2}\rightarrow s,ds=\frac{1}{2}\tilde{r}d\tilde{r}}{=} & 2\pi\left(\frac{w_{0}}{\sqrt{2}}\right)^{2}\frac{c\varepsilon_{0}}{2}E_{0}^{2}\intop_{s}\frac{1}{2}e^{-s}ds\\
= & 2\pi\left(\frac{w_{0}}{\sqrt{2}}\right)^{2}\frac{c\varepsilon_{0}}{2}E_{0}^{2}\left.\frac{1}{2}e^{-s}\right|_{\infty}^{0}\\
 & =2\pi\frac{w_{0}^{2}}{4}\frac{c\varepsilon_{0}}{2}E_{0}^{2}
\end{align*}

\end_inset


\begin_inset Formula 
\[
P=\frac{\pi c\varepsilon_{0}w_{0}^{2}}{4}E_{0}^{2}
\]

\end_inset


\end_layout

\end_inset

Using 
\begin_inset Formula $w_{0}=\frac{\lambda}{\pi\cdot\kaliNA}$
\end_inset

, we can also write:
\begin_inset Formula 
\[
P=\frac{\pi c\varepsilon_{0}{\color{purple}w_{0}^{2}}}{4}E_{0}^{2}=\frac{\pi c\varepsilon_{0}}{4}{\color{purple}\left(\frac{\lambda}{\pi\cdot\kaliNA}\right)^{2}}E_{0}^{2}=\frac{c\varepsilon_{0}\lambda^{2}}{4\pi\cdot\kaliNA^{2}}E_{0}^{2}
\]

\end_inset

Or alternatively:
\begin_inset Formula 
\[
\frac{P\cdot4\pi\cdot\kaliNA^{2}}{c\varepsilon_{0}\lambda^{2}}=E_{0}^{2}{\color{lightgray}\ \backslash\sqrt{}}
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\boxed{E_{0}=\frac{2\kaliNA}{\lambda}\sqrt{\frac{\pi P}{c\varepsilon_{0}}}}\tag{e\_43}\label{eq:e_43}
\end{equation}

\end_inset

And if there is a standing wave then then we replace 
\begin_inset Formula $P$
\end_inset

 by 
\begin_inset Formula $4P$
\end_inset

 as we did in 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e_45"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
:
\begin_inset Formula 
\[
E_{0,\text{standing}}=\frac{4\kaliNA}{\lambda}\sqrt{\frac{\pi P}{c\varepsilon_{0}}}
\]

\end_inset


\end_layout

\begin_layout Standard
Calculating 
\begin_inset Formula $\phi_{0}$
\end_inset

 (from 
\color blue

\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi_0_first_time"
plural "false"
caps "false"
noprefix "false"

\end_inset


\color inherit
)
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\phi_{0}\left(0,y\right)=\frac{e^{2}}{4m\gamma\beta c\hbar}\intop_{z}A_{\text{envelope}}^{2}\left(0,y,z\right)dz & =\frac{e^{2}}{4m\gamma\beta c\hbar}\intop_{z}A_{0}^{2}\cdot e^{-2\frac{y^{2}+z^{2}}{w_{0}^{2}}}dz\\
 & =\frac{e^{2}}{4m\gamma\beta c\hbar}\frac{{\color{blue}E_{0}^{2}}}{{\color{green}\omega^{2}}}e^{-\frac{2y^{2}}{w_{0}^{2}}}{\color{brown}\intop_{z}\cdot e^{-\frac{2z^{2}}{w_{0}^{2}}}dz}\\
 & \stackrel{{\color{blue}\eqref{eq:e_45}}}{=}\frac{e^{2}}{\cancel{4}m\gamma\beta c\hbar}\frac{{\color{blue}4\cdot\frac{\cancel{4}}{\pi c\varepsilon_{0}w_{0}^{2}}P}}{{\color{green}\left(c\cdot\frac{2\pi}{\lambda}\right)^{2}}}e^{-\frac{2y^{2}}{w_{0}^{2}}}{\color{brown}\sqrt{\frac{\pi}{\nicefrac{2}{w_{0}^{2}}}}}\\
 & =\frac{e^{2}{\color{green}\lambda^{2}}{\color{brown}\sqrt{\pi}\cancel{w_{0}}}}{{\color{brown}\sqrt{2}}{\color{green}4}\pi^{{\color{green}3}}m\gamma\beta c^{{\color{green}4}}\hbar}{\color{blue}\frac{4}{\varepsilon_{0}w_{0}^{\cancel{2}}}P}e^{-\frac{2y^{2}}{w_{0}^{2}}}\\
 & =\frac{4{\color{purple}e^{2}}\lambda^{2}}{\sqrt{2}{\color{purple}4}\pi^{{\color{purple}2}}\sqrt{\pi}m\gamma\beta{\color{purple}c}c^{3}{\color{purple}\hbar}{\color{purple}\varepsilon_{0}}w_{0}}Pe^{-\frac{2y^{2}}{w_{0}^{2}}}\\
 & =\frac{\sqrt{8}\lambda^{2}{\color{purple}\alpha}}{\sqrt{\pi^{3}}m\gamma\beta c^{3}w_{0}}Pe^{-\frac{2y^{2}}{w_{0}^{2}}}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset listings
lstparams "language=Python"
inline false
status open

\begin_layout Plain Layout
\align center

np.diagonal(G, offset=k) = np.cumsum(np.diagonal(A, offset=k))
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
And if we wish to have 
\begin_inset Formula $G\left(\boldsymbol{z},t_{k}\right),\boldsymbol{z}=\left(z_{0},z_{1},z_{2},\ldots,n_{z}\right)$
\end_inset

 (
\begin_inset Formula $G$
\end_inset

 for a constant 
\begin_inset Formula $t_{k}$
\end_inset

 and for all values of 
\begin_inset Formula $z$
\end_inset

) , each of those values 
\begin_inset Formula $G\left(z_{j},t_{k}\right)$
\end_inset

 will be achieved from the 
\begin_inset Formula $\left(k-j\right)$
\end_inset

-offset diagonal of 
\begin_inset Formula $A$
\end_inset

, and so the first term (for 
\begin_inset Formula $z_{0}$
\end_inset

) will be achieved from the 
\begin_inset Formula $k$
\end_inset

-diagonal of 
\begin_inset Formula $A$
\end_inset

, and the last one will be achieved from the 
\begin_inset Formula $k+n_{z}$
\end_inset

 diagonal of 
\begin_inset Formula $A$
\end_inset

.
 The 
\begin_inset Formula $k+n_{z}$
\end_inset

 diagonal of 
\begin_inset Formula $n_{z}$
\end_inset

, with length 
\begin_inset Formula $n_{z}$
\end_inset

, extends all the way to the 
\begin_inset Formula $A_{n_{z},k+2n_{z}}$
\end_inset

 element of 
\begin_inset Formula $A$
\end_inset

, thus for one column in 
\begin_inset Formula $G\left(\boldsymbol{z},t_{k}\right)$
\end_inset

 we need to initialize a matrix that extends from 
\begin_inset Formula $A_{0,k}$
\end_inset

 all the way to 
\begin_inset Formula $A_{n_{z},k+2n_{z}}$
\end_inset

.
\end_layout

\begin_layout Plain Layout
But - it is 
\series bold
not
\series default
 
\begin_inset Formula $n_{z}\cdot k+2n_{z}$
\end_inset

 elements 
\series bold
per
\series default
 vector 
\begin_inset Formula $G\left(\boldsymbol{z},t_{k}\right)$
\end_inset

.
 if we are interested in the two vectors 
\begin_inset Formula $G\left(\boldsymbol{z},t_{k}\right),G\left(\boldsymbol{z},t_{k+1}\right)$
\end_inset

, then we need only one more column - we need 
\begin_inset Formula $A$
\end_inset

 to range between 
\begin_inset Formula $A_{0,k}$
\end_inset

 downwards and rightwards to 
\begin_inset Formula $A_{n_{z},k+2n_{z}+1}$
\end_inset

, and in general for 
\begin_inset Formula $G$
\end_inset

 that has 
\begin_inset Formula $n_{z}\times k_{f}$
\end_inset

 terms we need to have a total of 
\begin_inset Formula $\left(n_{z}\times\left(2n_{z}+n_{t}\right)\right)$
\end_inset

 terms.
\end_layout

\begin_layout Plain Layout
For example, if we want 
\begin_inset Formula $\left(\boldsymbol{z},t_{k}\right),\boldsymbol{z}=\begin{pmatrix}z_{0}\\
\vdots\\
z_{n_{z}}
\end{pmatrix},\boldsymbol{t}=\begin{pmatrix}t_{0}\\
\vdots\\
t_{n_{t}}
\end{pmatrix}$
\end_inset

 then we need to initiate 
\begin_inset Formula $A_{00}\ldots A_{n_{z},\left(2n_{z}+n_{t}\right)}$
\end_inset

 matrix.
\end_layout

\begin_layout Plain Layout
Recalling that we do everything per coordinate 
\begin_inset Formula $x,y$
\end_inset

 then we need to generate 
\begin_inset Formula $A$
\end_inset

 in the range: 
\begin_inset Formula $A_{0000}\ldots A_{n_{x},n_{y},n_{z},\left(2n_{z}+n_{t}\right)}$
\end_inset

 which
\end_layout

\end_inset


\end_layout

\end_body
\end_document
